<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://firebasestorage.googleapis.com/v0/b/authentication-app-21e51.appspot.com/o/assets%2FlogoSmall.png?alt=media&token=6075f9a0-c511-4534-938a-a97515bf01dc" type="image/png">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css"/>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css"/>
   
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  
    <!-- Bootstrap JS -->
    <script src="js/bootstrap.min.js"></script>
	
		<!-- Include Quill stylesheet -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

<!-- Include Quill library -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Sharp:opsz,wght,FILL,GRAD@24,300,0,0" />



    <!-- Slick JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script> 

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/default.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>

    <title>Pager</title>
	<style>
 
        body {
          visibility: hidden;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            display: flex;
			flex-wrap: wrap;
      font-size: 1.4vw;
      /*background-color: #171b70 !important; */
        }
		
.navbar{
			height: 10vh;
			margin-bottom: 0px;
      border-radius: 0px;
      min-height: 0;
		} 

    .column {
          position: relative; /* Add this line */
          height: 90vh;
          width: 43%;
            overflow-y: auto;
            overflow-x: hidden;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
			scrollbar-width: none;
    }

    .two-columns {
      position: relative; /* Add this line */
          height: 90vh;
          width: 86%;
            overflow-y: auto;
            overflow-x: hidden;
            box-sizing: border-box;
            display: flex;
            flex-direction: row;
			scrollbar-width: none;
    }

    /* Media query for mobile screens */
@media (max-width: 520px) {
    .two-columns {
        flex-direction: column; /* Change to column for mobile screens */
        width:100% !important;
        height: auto !important;
    }

    #buttonsAndStorage {
      width: 100% !important; /* Ensure each column takes full width on mobile */
      height: auto !important;
      display: flex;
      padding-left: 2% !important;
      background: linear-gradient(90deg, #171b70, #a70050); /* Your gradient background */
    }

    #tools, #toolsIcon, #newTemplateButton, #addTemplateIcon, #library, #libraryIcon, #storage, #storageIcon {
      font-size: 5vw !important;
    }

    #storageIndicator {
      font-size: 2vw !important;
    }

    .selected-template-button, .template-button {
      font-size: 3vw !important;
      padding: 1.5vw 1vw !important;
    }

    .dropdown-content {
      width: fit-content !important;
      padding: 2vw 1vw !important;
      /*min-width: 140px !important; */
    }

    div.dropdown-content * {
      font-size: 2vw !important;
    }

    .column {
      height: auto;
    }
    
    .columnOne {
        width: 100% !important; /* Ensure each column takes full width on mobile */
        min-height: 200px;
    }

    .template-container {
      display: flex;
      max-width: 50%;    
    }

    .file-storage-content, .image-storage-content, .video-storage-content, .audio-storage-content {
      width: 100% !important;
      min-height: 0 !important;
      border-width: 0.2vw 0 0 0 !important;
    }

    #storageFiles, #storageVideos {
      font-size: 3vw !important;
    }

    #storageIconSmall {
      font-size: 3vw !important;
    }

    #videosInFiles, #audiosInFiles, #imagesInFiles {
      font-size: 3vw !important;
    }

    .storage-file-item-container {
      font-size: 2vw !important;
    }

    #mobileIcon {
      font-size: 3vw !important;
    }

    .image-file-item, .video-file-item, .audio-file-item {
      font-size: 2vw !important;
    }

    .fa-edit {
      padding: 0 1vw !important;
      background-color: transparent !important;
    }

    .fa-trash {
      background-color: transparent !important;
    }

    .fa-arrow-down, .fa-arrow-up {
      margin-top: -0.6vw !important;
    }

    .placeholderImage, .placeholderAudio, .placeholderVideo {
      padding: 0 0 4vw 0 !important;
    }

    .placeholderImage span, .placeholderAudio span, .placeholderVideo span {
      font-size: 5vw !important;
    }

    .ql-toolbar.ql-snow {
      padding: 0.7vw;
    }

    #optionCheckbox1, #optionCheckbox2, #optionCheckbox3, #optionCheckbox4 {
      width: 10% !important;
      max-width: 3% !important;
    }

    #option1, #option2, #option3, #option4 {
      min-width: 40% !important;
    }

    .add-textarea-pair-btn, .add-another-question-btn{
      font-size: 3vw !important;
      padding-left: 1vw !important;
      padding-right: 1vw !important;
    }

    .add-another-question-btn { 
      margin-top: 1.2vw !important;
    }

    .colorSelectButtonClassCardfront, .colorSelectButtonClassCardback {
      font-size: 3vw !important;
      width: 27% !important;
    }

    .colorSelectButtonClassCardfront img, .colorSelectButtonClassCardback img{
      max-width: 3.5vw !important;
    max-height: 3.5vw !important;
    }

    #button-save, #copyTemplate {
      width: auto !important;
      padding: 0.5vw 1vw 0 1vw !important;
      font-size: 3vw !important;
    }

    #cloudDone, #cloudSync {
      font-size: 4.5vw !important;
      padding-top: 1vw !important;
    padding-right: 1vw !important;
    }

    .modal-content {
      margin: 50% auto !important;
      padding: 6vw !important;
      width: 60% !important;
      font-size: 3vw !important;
    }

    #newTemplateName {
      font-size: 2vw !important;
      width: 50% !important;
    }

    #confirmRename, #cancelRename {
      height: auto !important;
      width: 22% !important;
      font-size: 2vw !important;
    }

    #confirmDelete, #cancelDelete {
      font-size: 2vw !important;
    width: 25% !important;
    height: auto !important;
    }

    .close {
      font-size: 4vw !important;
  margin: -3vw -3vw 0 0;
    }

    .storageAll {
      padding-top: 4vw !important;
      padding-bottom: 2vw !important;
    }

    #addPage {
      padding: 3vw 0 3vw 1vw !important;
    }

    #userEmail{
      height: 6vw !important;
      font-size: 2vw !important;
      width: 60vw !important;
    }
    #deleteAccount{
      height: 6vw !important;
      font-size: 2vw !important;
      width: 60vw !important;
    }

}

    #left-column {
      background-color: #eee;
			padding: 10px;
    }

    #right-column {
			background-color: #ffffff;
			align-items: left;
			justify-content: flex-start;
			overflow-y: auto;
		}

    #buttonsAndStorage {
      display: flex;
      background-color: #171b70;
      color:#ffffff; width: 14%;
      overflow-y: auto;
      box-sizing: border-box;
      flex-direction: column;
      scrollbar-width: none;
      padding-top: 10px;
		}

    #buttonsAndStorage > .storageAll{
            margin-top: auto;
            padding-left: 1vw;
            padding-top: 2vw;
        }

.shape {
    margin-left: 10px;
    display: flex;
    align-items: left;
    justify-content: left;
    flex-direction: column;
}

.circle {
    font-size: 18pt;
    color: #ffffff;
    background-color: rgb(23, 27, 112);
}

/*.imageUpload {
  padding: 10px;
}

.videoUpload {
  padding: 10px;
}

.audioUpload {
  padding: 10px;
} */

.placeholderRedCircle {
    font-size: 18pt;
    color: #ffffff;
    word-wrap: break-word; /* Ensure text wraps inside the div */
}

		.square-blue {
			color: #ffffff;
		}

        .square-green {
            width: 100px;
            height: 100px;
            min-height: 100px;
            font-size: 16pt;
            font-family: 'Verdana', sans-serif;
            color: #ffffff; /* White text for better readability on the green background */
            background-color: #008000;
            margin-left: 10px;
        }
.placeholderImage {
    width: 100%; /* Responsive width */
    display: flex; /* Use flexbox for centering */
    justify-content: center; /* Center content horizontally */
    align-items: center; /* Center content vertically */
    word-wrap: break-word; /* Ensure text wraps inside the div */
    font-family: 'Spectral', serif;
}

.placeholderImage img {
    max-width: 100%; /* Prevent the image from being larger than its original size */
    height: auto; /* Keep the aspect ratio */
    display: block; /* Ensure the image is a block-level element */
    transition: max-width 0.3s ease;
    align-content: center;
}

.placeholderVideo {
    width: 100%; /* Responsive width */
    display: flex; /* Use flexbox for centering */
    justify-content: center; /* Center content horizontally */
    align-items: center; /* Center content vertically */
    word-wrap: break-word; /* Ensure text wraps inside the div */
    font-family: 'Spectral', serif;
}

.placeholderVideo video {
    max-width: 100%; /* Prevent the image from being larger than its original size */
    height: auto; /* Keep the aspect ratio */
    display: block; /* Ensure the image is a block-level element */
}

.placeholderAudio{
    width: 100%; /* Responsive width */
    display: flex; /* Use flexbox for centering */
    justify-content: center; /* Center content horizontally */
    align-items: center; /* Center content vertically */
    word-wrap: break-word; /* Ensure text wraps inside the div */
    font-family: 'Spectral', serif;
}

.placeholderAudio audio {
    max-width: 100%; /* Prevent the image from being larger than its original size */
    display: block; /* Ensure the image is a block-level element */
}

.textarea-container-three {
    position: relative; /* This sets the positioning context for the absolute elements inside */
    padding-top: 10px; /* This padding-top ensures that there's space for the buttons to overflow the <p> element */
    font-family: 'Arial', sans-serif;
	/* border-left: 5px solid white; Adds a white bottom border with 5px width */
}

/* Hide the actual file input visually but remain accessible */
.hidden-file-input-image {
    width: 0.1px;
    height: 0.1px;
    opacity: 0;
    overflow: hidden;
    position: absolute;
    z-index: -1;
}

.hidden-file-input-video {
    width: 0.1px;
    height: 0.1px;
    opacity: 0;
    overflow: hidden;
    position: absolute;
    z-index: -1;
}

.hidden-file-input-audio {
    width: 0.1px;
    height: 0.1px;
    opacity: 0;
    overflow: hidden;
    position: absolute;
    z-index: -1;
}
	
		.textarea-container {
            position: relative;
			display: block; 
			margin-top: 20px;
        }
.delete-button, .down-button, .up-button {
    position: absolute;
    width: 20px; /* Your desired width */
    height: 20px; /* Your desired height */
    cursor: pointer;
    border: none;
    background-color: transparent; /* Or any color you want */
    z-index: 100; /* This ensures the buttons will be on top of other content */
}

/* Position each button at the top right, with specific adjustments if needed */
.delete-button {
    top: 7px; /* Position the button at the top edge of the container */
    right: 0;
    /* Icon-specific styles */
}

.down-button {
    top: 10px; /* Position the button at the top edge of the container */
    right: 25px; /* Adjust the spacing between the buttons */
    /* Icon-specific styles */
}

.up-button {
    top: 10px; /* Position the button at the top edge of the container */
    right: 50px; /* Adjust the spacing between the buttons */
    /* Icon-specific styles */
}

        textarea, #secondtextarea, #thirdtextarea {
            width: 100%;
            box-sizing: border-box;
            margin-top: 10px;
			resize: vertical;
        }
		
		input {
			width: 50%;
		}

.button {
    position: relative;
    border: none;
    border-radius: 4px;
    color: rgb(50, 50, 50);
    font-family: 'Arial', sans-serif;
    text-align: left;
    text-decoration: none;
    display: inline-block;
    font-size: 1vw;
    cursor: pointer;
    overflow: hidden; /* Ensure the pseudo-element doesn't exceed the button boundaries */
    transition: box-shadow 0.3s ease; /* Transition for the shadow */
    z-index: 1; /* Ensure the button is above the pseudo-element */
}
#button-save, #copyTemplate {
  position: relative;
  border: none;
  border-radius: 0px;
  color: white;
  background: linear-gradient(45deg, blue, #a70050);
  font-family: 'Arial', sans-serif;
  text-decoration: none;
  display: inline-block;
  font-size: 0.8vw;
  cursor: pointer;
  overflow: hidden;
  transition: box-shadow 0.3s ease;
  z-index: 1;
  margin-top: 0px;
  width: 10vw;
  align-self: flex-end;
  text-align: center;
  padding: 0.2vw 0;
  width: 10vw;
}

#button-save::before, #copyTemplate::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgb(181, 0, 36);
  opacity: 0;
  transition: opacity 0.3s ease;
  z-index: -1;
}

#button-save:hover::before, #copyTemplate:hover::before {
  opacity: 1;
}

#toolsButton {
  position: relative;
    border: none;
    border-radius: 4px;
    color: rgb(255, 255, 255);
    font-family: 'Arial', sans-serif;
    text-align: left;
    text-decoration: none;
    display: inline-block;
    font-size: 1vw;
    cursor: pointer;
    overflow: hidden; /* Ensure the pseudo-element doesn't exceed the button boundaries */
    transition: none; /* Transition for the shadow */
    z-index: 1; /* Ensure the button is above the pseudo-element */
}

.button::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, blue, #a70050);
    opacity: 0;
    border-radius: inherit; /* Match the border radius of the button */
    z-index: -1; /* Place it behind the button's text */
}

.button:hover::before {
    opacity: 1;
}

.button:hover {  
  color: rgb(255, 255, 255);
}

.tool-button-container {
    display: flex; /* Use flexbox to layout buttons */
    justify-content: space-evenly; /* Align buttons to the start of the container */
    gap: 10px; /* Space between buttons */
    width: 50%;
    height: 10vh;
    padding: 10px 0 10px 0px;
    border-bottom: 1px solid #ccc;
    background-color:#fff;
    align-content: center;
}

.tool-button-group {
    display: flex; /* Use flexbox for the layout */
    flex-direction: column; /* Stack buttons vertically */
    border-right: 1px solid #ccc; /* Add a vertical line to separate groups */
    padding-right: 1px; /* Add some padding to the right of the border */
    width: 25%;
    justify-content: center;
}

.tool-button-group:last-child {
    /* border-right: none; */
}

#newTemplateButton {
  background: none; /* Removes the background */
        color: inherit; /* Inherits the text color from the parent element */
        border: none; /* Removes the border */
        padding: 0; /* Removes padding */
        margin: 0; /* Removes margin */
        box-shadow: none; /* Removes box shadow */
        text-shadow: none; /* Removes text shadow */
        font: inherit;
        margin-left: 0 !important;
        padding-left: 0 !important;
        text-align: left !important;
        padding-block: 0 !important;
        padding-inline: 0 !important;
}

#newTemplateButton:hover {
        background-color: transparent; /* Example hover background color */
    }

#newTemplateButton2 {
    position: relative;
    background: linear-gradient(45deg, blue, #a70050);
    border-left: solid;
    border-width: 3px;
    border-color: white;
    border-radius: 0px;
    color: white;
    font-family: 'Arial', sans-serif;
    padding: 5px 10px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 1vw;
    margin: 4px 2px;
    cursor: pointer;
    overflow: hidden; /* Ensure the pseudo-element doesn't exceed the button boundaries */
    transition: box-shadow 0.3s ease; /* Transition for the shadow */
    z-index: 1; /* Ensure the button is above the pseudo-element */
}

#newTemplateButton2::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, #a70050, blue);
    opacity: 0;
    border-radius: inherit; /* Match the border radius of the button */
    transition: opacity 1s ease; /* Transition for the background */
    z-index: -1; /* Place it behind the button's text */
   
}

#newTemplateButton2:hover::before {
    opacity: 1;
}

.button-container {
    display: flex;
    flex-wrap: wrap;
    /* Changed to 'center' to ensure buttons are centered and margins are consistent */
    justify-content: center;
	margin-bottom: 20px;
}

.button-container .button {
    /* Using 'flex: none' to disable the flex grow/shrink properties */
    flex: none;
    /* Fixed width for three-column layout */
    width: 90%;
    /* Fixed margin for consistency */
    margin: 5px;
}

/* This media query will stack buttons into one column on smaller screens */
@media (max-width: 768px) {
    .button-container .button {
        /* Full width for the button */
        width: 90%;
        /* Reset margins for a single column layout */
        margin: 5px 0;
    }
}

.template-container {
  display: flex;
  justify-content: space-between; /* Space between the template button and the trash icon */
  margin-bottom: 0.3vw; /* Margin between template items */
  align-items: center;
  padding: 0 0.7vw 0 0.7vw;
}

.template-button {
	flex-grow: 1; /* Allow the button to grow and fill the space */
	text-overflow: ellipsis; /* Add ellipsis for overflowed text */
	overflow: hidden; /* Hide overflow */
	white-space: nowrap; /* Prevent wrapping to a new line */
	position: relative;
  background-color: #33388b;
    border: none;
    border-left: solid;
    border-width: 3px;
    border-color: white;
    border-radius: 0px;
    color: white;
    font-family: 'Arial', sans-serif;
    padding: 0.5vw 1vw;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 1vw;
    margin: 1px 2px;
    cursor: pointer;
    overflow: hidden; /* Ensure the pseudo-element doesn't exceed the button boundaries */
    transition: box-shadow 0.3s ease; /* Transition for the shadow */
    z-index: 1; /* Ensure the button is above the pseudo-element */
}
.selected-template-button {
	flex-grow: 1; /* Allow the button to grow and fill the space */
    position: relative;
    background: linear-gradient(45deg, #a70050, rgb(216, 65, 28));
    border: none;
    border-left: solid;
    border-width: 3px;
    border-color: white;
    border-radius: 0px;
    color: white;
    font-family: 'Arial', sans-serif;
    padding: 0.5vw 1vw;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 1vw;
    margin: 1px 2px;
    cursor: pointer;
    overflow: hidden; /* Ensure the pseudo-element doesn't exceed the button boundaries */
    transition: box-shadow 0.3s ease; /* Transition for the shadow */
    z-index: 1; /* Ensure the button is above the pseudo-element */
}

.fas.fa-edit {
  padding: 0.5vw 0.2vw; /* Padding around the trash icon */
  margin-left: 0.2vw; /* Space between button and trash icon */
}

.fas.fa-trash {
  padding: 0.5vw 0.2vw; /* Padding around the trash icon */
  margin-left: 0.3vw; /* Space between button and trash icon */
}

       /* Existing styles */
		body::-webkit-scrollbar {
    display: none;
}

/* Hide scrollbar for IE, Edge and Firefox */
body {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
}

.loading-overlay {
    position: absolute;
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgba(255, 255, 255, 0.7);
    z-index: 10;
}

		.ql-container {
			max-height: 80px; /* Ensures the editor has a default height */
			margin-bottom: 40px;
			background-color: #fff;
      font-size: 1.2vw;
		}
		
.ql-toolbar .ql-size.ql-picker {
    width: 55px; /* or whatever width you desire */
}





.ql-toolbar .ql-size.ql-picker .ql-picker-options {
    width: 55px; /* Make sure this matches the width of the .ql-picker */

}

.ql-toolbar .ql-font.ql-picker {
    width: 100px; /* or whatever width you desire */
    margin-right: -5px;
}

.ql-toolbar .ql-font.ql-picker .ql-picker-label {
    padding-right: 10px; /* Add padding if the dropdown arrow is hidden */
}

.ql-toolbar .ql-font.ql-picker .ql-picker-options {
    width: 125px; /* Make sure this matches the width of the .ql-picker */
}

/* Custom styles for Arial and Times New Roman */

.ql-editor {
  font-family: 'Times New Roman', Times, serif;
    }

.ql-snow .ql-picker.ql-font .ql-picker-label[data-value="arial"]::before,
.ql-snow .ql-picker.ql-font .ql-picker-item[data-value="arial"]::before {
  content: 'Arial';
  font-family: Arial, sans-serif;
  width: 100% !important;
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}

.ql-font-arial {
  font-family: Arial, sans-serif;
}

.ql-snow .ql-picker.ql-font .ql-picker-label[data-value="times-new-roman"]::before,
.ql-snow .ql-picker.ql-font .ql-picker-item[data-value="times-new-roman"]::before {
  content: 'Times New Roman';
  font-family: 'Times New Roman', Times, serif;
  width: 100% !important; /* Adjust the width as needed, could be a fixed width like 200px */
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}

.ql-font-times-new-roman {
  font-family: 'Times New Roman', Times, serif;
}

.ql-snow .ql-picker.ql-font .ql-picker-label[data-value="georgia"]::before,
.ql-snow .ql-picker.ql-font .ql-picker-item[data-value="georgia"]::before {
  content: 'Georgia';
  font-family: 'Georgia', sans-serif;
}

.ql-font-georgia {
  font-family: 'Georgia', sans-serif;
}

.ql-snow .ql-picker.ql-font .ql-picker-label[data-value="calibri"]::before,
.ql-snow .ql-picker.ql-font .ql-picker-item[data-value="calibri"]::before {
  content: 'Calibri';
  font-family: Calibri, sans-serif;
  width: 100% !important;
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}

.ql-font-calibri {
  font-family: Calibri, sans-serif;
}

.ql-snow .ql-picker.ql-font .ql-picker-label[data-value="helvetica"]::before,
.ql-snow .ql-picker.ql-font .ql-picker-item[data-value="helvetica"]::before {
  content: 'Helvetica';
  font-family: 'Helvetica', sans-serif;
  width: 100% !important;
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}

.ql-font-helvetica {
  font-family: 'Helvetica', sans-serif;
}

.ql-snow .ql-picker.ql-font .ql-picker-label[data-value="verdana"]::before,
.ql-snow .ql-picker.ql-font .ql-picker-item[data-value="verdana"]::before {
  content: 'Verdana';
  font-family: 'Verdana', sans-serif;
  width: 100% !important;
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}

.ql-font-verdana {
  font-family: 'Verdana', sans-serif;
}

.ql-snow .ql-picker.ql-font .ql-picker-label[data-value="tahoma"]::before,
.ql-snow .ql-picker.ql-font .ql-picker-item[data-value="tahoma"]::before {
  content: 'Tahoma';
  font-family: 'Tahoma', sans-serif;
  width: 100% !important;
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}

.ql-font-tahoma {
  font-family: 'Tahoma', sans-serif;
}

/* Spectral */
.ql-snow .ql-picker.ql-font .ql-picker-label[data-value="spectral"]::before,
.ql-snow .ql-picker.ql-font .ql-picker-item[data-value="spectral"]::before {
  content: 'Spectral';
  font-family: 'Spectral', serif;
}

.ql-font-spectral {
  font-family: 'Spectral', serif;
}

/* Inter */
.ql-snow .ql-picker.ql-font .ql-picker-label[data-value="inter"]::before,
.ql-snow .ql-picker.ql-font .ql-picker-item[data-value="inter"]::before {
  content: 'Inter';
  font-family: 'Inter', sans-serif;
}

.ql-font-inter {
  font-family: 'Inter', sans-serif;
}

.ql-snow .ql-picker.ql-font .ql-picker-label::before {
    content: 'Font-family';
}

.ql-snow .ql-picker.ql-size .ql-picker-label[data-value="1vw"]::before,
.ql-snow .ql-picker.ql-size .ql-picker-item[data-value="1vw"]::before {
    content: '10px';
}

.ql-snow .ql-picker.ql-size .ql-picker-label[data-value="1.2vw"]::before,
.ql-snow .ql-picker.ql-size .ql-picker-item[data-value="1.2vw"]::before {
    content: '12px';
}

.ql-snow .ql-picker.ql-size .ql-picker-label[data-value="1.4vw"]::before,
.ql-snow .ql-picker.ql-size .ql-picker-item[data-value="1.4vw"]::before {
    content: '14px';
}

.ql-snow .ql-picker.ql-size .ql-picker-label[data-value="1.6vw"]::before,
.ql-snow .ql-picker.ql-size .ql-picker-item[data-value="1.6vw"]::before {
    content: '16px';
}

.ql-snow .ql-picker.ql-size .ql-picker-label[data-value="1.8vw"]::before,
.ql-snow .ql-picker.ql-size .ql-picker-item[data-value="1.8vw"]::before {
    content: '18px';
}

.ql-snow .ql-picker.ql-size .ql-picker-label[data-value="2.2vw"]::before,
.ql-snow .ql-picker.ql-size .ql-picker-item[data-value="2.2vw"]::before {
    content: '22px';
}

.ql-snow .ql-picker.ql-size .ql-picker-label[data-value="2.6vw"]::before,
.ql-snow .ql-picker.ql-size .ql-picker-item[data-value="2.6vw"]::before {
    content: '26px';
}

.ql-snow .ql-picker.ql-size .ql-picker-label[data-value="3.2vw"]::before,
.ql-snow .ql-picker.ql-size .ql-picker-item[data-value="3.2vw"]::before {
    content: '32px';
}

.ql-snow .ql-picker.ql-size .ql-picker-label[data-value="3.6vw"]::before,
.ql-snow .ql-picker.ql-size .ql-picker-item[data-value="3.6vw"]::before {
    content: '36px';
}

.ql-formats {
  margin-right: 2px !important;
}

.textarea-container-three .ql-tooltip {
  left: 0!important; /* Align left edge of tooltip with the left edge of the container */
}

.rich-editor-placeholder {
  width: 100%; /* Ensures the div takes the full width of its parent */
  max-width: 100%; /* Prevents the div from extending beyond its parent's width */
  min-height: 20px;
  padding: 10px 20px 10px 10px;
  overflow-wrap: break-word; /* Ensures long words do not overflow the div */
  word-wrap: break-word; /* Deprecated version of overflow-wrap for older browsers */
  overflow: hidden; /* Hides overflowed content, alternatively use 'auto' to provide scrollbars */
  height: auto; /* Adjusts height based on content, you might want to set a fixed height or max-height */
  font-family: 'Times New Roman', Times, serif;
}

.rich-editor-placeholder p {
  margin: 0px;
}

.file-name-display {
    font-family: 'Inter';
    text-align: left;
    width: 100%;
    padding-left: 1vw;
}

.file-name-display-audio, .file-name-display-video {
    font-family: 'Inter';
    text-align: left;
    width: 100%;
    padding-left: 0vw;
}

details > summary {
    display: list-item; /* To restore the default indicator of accordion*/
}

.accordionDetails {
overflow-wrap: break-word; /* Ensures long words do not overflow the div */
  word-wrap: break-word; /* Deprecated version of overflow-wrap for older browsers */
  overflow: hidden;
}

/* Styles for Slick Slider */
        .slick-slider {
            width: 90%;
            margin: 1.5vw auto 1vw auto;
    hyphens: auto;
    overflow-wrap: break-word;
        }

        .slick-slide img {
            width: 100%;
            height: auto;
            display: block;
        }
		
		.slick-slide {
			hyphens: auto;
			overflow-wrap: break-word;
        }
		
		/* Set all slides to be invisible */
.slick-slide,
.slick-slide .flashcard-container {
  opacity: 0;
}

/* Specifically make only the active slide and its container visible */
.slick-slide.slick-current.slick-active,
.slick-slide.slick-current.slick-active .flashcard-container {
  opacity: 1;
}
		
		.slick-prev.slick-arrow {
		z-index: 100;
		}
		
		.slick-prev:before,
		.slick-next:before {
			color:#171b70; 
		}

    .flashcard-slider .slick-next {
    /*right: -4.5vw;*/
}
.flashcard-slider .slick-prev {
    /*left: -4.5vw; */
}
		
        .banner-placeholder {
            width: 100%;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-top: 0px;
        }
		
.flashcardStack {
	width: 90%;
    margin-left: auto;
    margin-right: auto;
}

.flashcard-slider {
	width: 85%;
  padding: 1vw 1vw;
}

.slick-list {
	overflow: visible;
}

/* Container for the flashcard to apply perspective */
.flashcard-container {
  perspective: 1000px; /* Adjust as needed for the depth effect */
	position: relative;
    width: 100%; /* Example width, adjust as needed */
    aspect-ratio: 16 / 9; /* Adjust this value based on your desired aspect ratio */
	hyphens: auto;
	overflow-wrap: break-word;
  display: flex;
  flex-direction: column;
}

.flashcard-front {
  aspect-ratio: 16 / 9; /* Adjust this value based on your desired aspect ratio */
    backface-visibility: hidden; /* Hide the back of the card when it's flipped */
    transition: transform 0.6s ease; /* Smooth flip animation */
    position: absolute;
    padding: 3vw 1vw; /* Adjust the values as needed */
	display: flex;
    width: 100%;
	border: 0.8vw solid;
	border-radius: 3.5vw; /* Rounded corners */
    font-size: 2vw; /* Bigger font size */
    text-transform: uppercase; /* All caps */
	align-items: center; /* Vertically center the text */
    justify-content: center; /* Horizontally center the text */
    text-align: center; /* Center text lines relative to each other */
    white-space: normal; /* Override any non-wrapping settings */
    hyphens: auto;
	overflow: hidden; 
  overflow-wrap: anywhere;
    box-sizing: border-box;
}

@media (max-width: 600px) {
    .flashcard-front {
        padding: 10px 5px;
    }
}

.flashcard-quiz {
  aspect-ratio: 16 / 9;
    backface-visibility: hidden;
    transition: transform 0.6s ease;
    /* position: absolute; */
    display: flex;
    width: 100%;
    border: 0;
    border-radius: 0;
    /* font-size: 1.5vw; */
    justify-content: center;
    text-align: left;
    white-space: normal;
    hyphens: auto;
    overflow: hidden;
    overflow-wrap: anywhere;
    box-sizing: border-box;
    font-weight: bold;
    line-height: 1.2;
    align-content: flex-start;
    flex-direction: column;
    align-items: center;
    color: #2f2f2f;
}

.flashcard-quiz > :first-child {
  margin-top: 1vw;
}



.flashcard-back {
    backface-visibility: hidden; /* Hide the back of the card when it's flipped */
    transition: transform 0.6s ease; /* Smooth flip animation */
    position: absolute;
	display: flex;
    width: 100%;
    aspect-ratio: 16 / 9; /* Adjust this value based on your desired aspect ratio */
    background: #f9f9f9;
    transform: rotateY(180deg);
	border: 0.8vw solid;
	border-radius: 3.5vw; /* Rounded corners */
    font-size: 1.5vw; /* Bigger font size */
  border-color: #39b2b3;
  padding: 3vw 1vw; /* Adjust the values as needed */
	align-items: center; /* Vertically center the text */
    justify-content: center; /* Horizontally center the text */
    text-align: center; /* Center text lines relative to each other */
    white-space: normal; /* Override any non-wrapping settings */
    hyphens: auto;
	overflow: hidden; 
  overflow-wrap: anywhere;
}

.flashcard-container.flipped .flashcard-front {
    transform: rotateY(-180deg);
}

.flashcard-container.flipped .flashcard-back {
    transform: rotateY(0deg);
    z-index: 3;
}

.add-textarea-pair-btn{
  position: relative;
    background: #171b70;
    border: none;
    border-radius: 0.2vw;
    color: white;
    font-family: 'Arial', sans-serif;
    padding: 0.2vw 0.5vw 0.2vw 0.5vw;
    margin-right: 4px;
    margin-bottom: 1px;
    text-align: left;
    text-decoration: none;
    display: inline-block;
    font-size: 1vw;
    cursor: pointer;
    overflow: hidden;
    z-index: 1;
}

input, textarea {
    border-radius: 0; /* Removes rounded corners */
    border: 1px solid #171b70; /* Changes border color */
    background-color: #ffffff; /* Sets the background color */
    color: #333 !important; /* Sets the text color */
    padding: 8px; /* Adds some padding inside the inputs */
    outline: none; /* Removes the outline on focus */
}

input:focus, textarea:focus {
    border-color: #0066ff; /* Changes border color on focus */
    box-shadow: 0 0 3px #0066ff; /* Adds a subtle shadow on focus for better visibility */
}

input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {
    color: #171b70; /* Chrome/Opera/Safari */
    text-transform: uppercase;
    font-size: 12px; /* Adjusts the font size, change as needed */
}

input::-moz-placeholder, textarea::-moz-placeholder {
    color: #171b70; /* Firefox 19+ */
    opacity: 1; /* Firefox has a lower opacity on placeholder text by default */
    text-transform: uppercase;
    font-size: 12px; /* Adjusts the font size, change as needed */
}

input:-ms-input-placeholder, textarea:-ms-input-placeholder {
    color: #171b70; /* Internet Explorer 10-11 */
    text-transform: uppercase;
    font-size: 12px; /* Adjusts the font size, change as needed */
}

input::-ms-input-placeholder, textarea::-ms-input-placeholder {
    color: #171b70; /* Microsoft Edge */
    text-transform: uppercase;
    font-size: 12px; /* Adjusts the font size, change as needed */
}

input::placeholder, textarea::placeholder {
    color: #171b70; /* Standard syntax */
    text-transform: uppercase;
    font-size: 12px; /* Adjusts the font size, change as needed */
}

.color-popup, .color-popup2, .color-popup3, .image-popup, .image-popup2, .image-popup3, .color-popup-section, .color-popup-title, .color-popup-accordion, .color-popup-cardfront, .color-popup-cardback {
  position: absolute;
  max-width: 72%;
  background-color: #171b70;
  border: 1px solid #ddd;
  padding: 10px;
  border-radius: 5px;
  flex-wrap: wrap;
  justify-content: center;
  z-index: 100; /* Ensure it's above other elements */
  top: -20%; /* Move it above the button */
  right: 6%; /* Move it above the button */
  left: 22%; /* Move it above the button */
  display: none; /* Initially hidden */
  flex-wrap: wrap;
  justify-content: center; /* Centers the squares in the popup */
  align-items: center; /* Vertically align items in the center */
  position: absolute;
  z-index: 1000;
}

.color-popup-cardfront, .color-popup-cardback {
  top: 100%;
}

.colorElement, .colorElementTwo, .colorElementThree, .colorElementSection, .colorElementTitle, .colorElementAccordion, .colorElementCardfront, .colorElementCardback {
  width: 30px; /* Adjust size as needed */
  height: 30px; /* Adjust size as needed */
  margin: 4px;
  cursor: pointer;
}

.popup-image, .popup-image2, .popup-image3 {
  margin: 5px;  
  max-width: 19px;
  max-height: 19px;
  cursor: pointer;
  transition: transform 0.2s; /* Smooth scaling on hover */
}

.colorElement:hover, .colorElementTwo:hover, .popup-image:hover, .popup-image2:hover, .colorElementThree:hover, .popup-image3:hover, .colorElementSection:hover, .colorElementTitle:hover, .colorElementAccordion:hover, .colorElementCardfront:hover, .colorElementCardback:hover {
  transform: scale(1.1);
}

.colorSelectButtonClass, .colorSelectButtonClass2, .colorSelectButtonClass3, .imageSelectButtonClass, .imageSelectButtonClass2, .imageSelectButtonClass3, .colorSelectButtonClassSection, .colorSelectButtonClassTitle, .colorSelectButtonClassAccordion, .colorSelectButtonClassCardfront, .colorSelectButtonClassCardback {
  width: 10%;
  padding: 8px 2px;
  border: 1px solid #171b70;
  line-height: 1.42857;
  outline: none;
  color: #fff;
  border-right-color: #eee;
  border-right-width: 1.5px;
  margin-bottom: 5px;
  background-color: #171b70;
}

.colorSelectButtonClassCardfront, .colorSelectButtonClassCardback {
  width: 20%;
    min-width: 10vw;
    margin-right: 4px;
    margin-bottom: 1px;
    margin-top: 0;
    border: none;
    border-radius: 0.2vw;
    color: white;
    font-family: 'Arial', sans-serif;
    padding: 0.2vw 0.5vw 0.2vw 0.5vw;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 1vw;
    cursor: pointer;
    overflow: hidden;
  }

.welcome-message1 {
  display: flex;
  align-items: center; /* Vertically center */
  justify-content: center; /* Horizontally center */
  height: 100%; /* Take full height of the container */
  text-align: center;
  font-size: 1.5vw; /* Example font size, adjust as needed */
  color: rgb(23, 27, 112);
  font-weight: bold; 
}

.welcome-message2 {
  display: flex;
  align-items: center; /* Vertically center */
  justify-content: center; /* Horizontally center */
  height: 100%; /* Take full height of the container */
  text-align: center;
  font-size: 1.5vw; /* Example font size, adjust as needed */
  color: rgb(23, 27, 112);
  font-weight: bold; 
}

.welcome-container {
  position: absolute;
  top: 60%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.ghost{
  display: block;
  width: auto;
  animation: float 3s ease-out infinite;
  width: 80px;
}

@keyframes float {
  50% {
     transform: translate(0, 20px);
  }
}
.shadowFrame {
  display: block;
  width: auto;
  margin-top: 15px;
}
.shadow {
  animation: shrink 3s ease-out infinite;
  transform-origin: center center;
  ellipse {
    transform-origin: center center;
  }
}

@keyframes shrink {
  0% {
    width: 90%;
    margin: 0 5%;
  }
  50% {
    width: 60%;
    margin: 0 18%;
  }
  100% {
    width: 90%;
    margin: 0 5%;
  }
}

.tempLoadingAnimation {
    text-align: center;
    flex: 1 1 auto;
    display: flex;
    justify-content: space-around;
    align-items: center;
    flex-direction: column;
    width: 100%;
    margin: 50px 0 50px 0;
  }
  
  .tempLoadingAnimation .circles {
    position: relative;
    width: 100%;
    animation: move-2 3s linear infinite;
    animation-delay: -400ms;
  }
  
  .tempLoadingAnimation .circleColorOne,
  .tempLoadingAnimation .circleColorTwo {
    display: inline-block;
    border-radius: 50%;
    width: 1rem;
    height: 1rem;
    background: #171b70;
    animation: move 3s cubic-bezier(.1, .8, .9, .1) infinite;
  }
  
  .tempLoadingAnimation .circleColorOne:nth-of-type(2),
  .tempLoadingAnimation .circleColorTwo:nth-of-type(2) {
    animation-delay: -100ms;
  }
  
  .tempLoadingAnimation .circleColorOne:nth-of-type(3),
  .tempLoadingAnimation .circleColorTwo:nth-of-type(3) {
    animation-delay: -200ms;
  }
  
  .tempLoadingAnimation .circleColorOne:nth-of-type(4),
  .tempLoadingAnimation .circleColorTwo:nth-of-type(4) {
    animation-delay: -300ms;
  }
  
  .tempLoadingAnimation .circleColorOne:nth-of-type(5),
  .tempLoadingAnimation .circleColorTwo:nth-of-type(5) {
    animation-delay: -400ms;
  }
  
  .tempLoadingAnimation .circleColorTwo {
    background: #a70050;
  }
  
  @keyframes move {
    0% {
      transform: translateX(-10em);
      opacity: 0;
    }
    10%, 70% {
      opacity: .9;
    }
    80%, 100% {
      transform: translateX(10em);
      opacity: 0;
    }
  }
  
  @keyframes move-2 {
    0% {
      transform: translateX(4em);
    }
    100% {
      transform: translateX(-4em);
    }
  }

  .slick-next-button {
    padding: 2% 3% 2% 3%;
    margin-top: 2%;
    border: none;
    background-color: #171b70;
    color: white;
    cursor: pointer;
    font-weight: 500;
    border-radius: 0.3vw;
    display: block;
    font-family:'Arial', sans-serif;
    justify-self: center;
}

.quizRadioButton { 
  width: 1vw;
  z-index: 50000;
  padding-top: 0 !important;
}

input[type="radio"].quizRadioButton {
  margin: 0 0.5vw 0 0;
  vertical-align: top !important;
  line-height: 1;
  max-height: 1.5vw;
}

input[type="radio"].quizRadioButton:focus {
    outline: none;
    box-shadow: none;
    border-color: transparent;
}

.quizLabel {
  display: flex;
  z-index: 50000;
  font-weight: normal !important;
  margin-bottom: 0.2vw;
  align-items: center;
  align-self: self-start;
}

.quizOption {
  width: 44%;
  margin-bottom: 0.5vw;
}

input[type="radio"].quizOptionCheckbox {
  width: 4%;
  margin: -2% 1% 0 1%;
  max-width: 1vw;
}

@media (max-width: 900px) {
    input[type="radio"].quizOptionCheckbox {
      max-width: 1.4vw;
    }
}

input[type="radio"].quizOptionCheckbox:focus {
    outline: none;
    box-shadow: none;
    border-color: transparent;
}

.add-another-question-btn{
    position: relative;
    background: #171b70;
    border: none;
    border-radius: 0.2vw;
    color: white;
    font-family: 'Arial', sans-serif;
    margin-top: 0;
    padding: 0.2vw 0.5vw;
    margin-bottom: 0.1vw;
    text-align: left;
    text-decoration: none;
    display: block;
    font-size: 1vw;
    cursor: pointer;
    overflow: hidden; /* Ensure the pseudo-element doesn't exceed the button boundaries */
    z-index: 1; /* Ensure the button is above the pseudo-element */
}

.optionInputsContainerClass{
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
}

.quizClass {
	width: 90%;
    margin-left: auto;
    margin-right: auto;
}

.toolsDropdown {
  position: relative;
  display: inline-block;
  width: 100%;
  z-index: 5;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #ffffff;
  z-index: 100000;
  width: 100%;
  min-width: 100px;
  padding: 3vh 1vh 3vh 1vh;
}

.dropdown-content button {
  color: black;
  padding: 2px 2px;
  text-decoration: none;
  display: block;
  z-index: 100000;
  width: 100%;
  background-color: #ffffff;
  border-radius: 0;
}

.toolsDropdown:hover .dropdown-content {
    display: block; /* Displays the dropdown content on hover */
}

.video-storage-content, .audio-storage-content, .image-storage-content, .file-storage-content {
  display: none;
  position: absolute;
  background-color: #171b70;
  z-index: 100000;
  width: 50%;
  height: auto;
  min-height: 100vh;
  padding: 3vw;
  color: white;
  border-width: 0 0 0 0.2vw;
    border-left-color: white;
    border-style: solid;
}

.video-file-item-container, .audio-file-item-container, .image-file-item-container, .storage-file-item-container {
  cursor: pointer;
  font-size: 1vw;
  margin-bottom: 1vw;
  display: flex;
  align-items: center;
  transition: box-shadow 0.3s ease, color 0.3s ease; /* Added transition for color */
}

.video-file-item-container:hover, .audio-file-item-container:hover, .image-file-item-container:hover {
  color: rgba(255, 255, 0, 0.799);
}

.video-close-storage, .audio-close-storage, .image-close-storage, .file-close-storage {
  float:right;
  font-size: 3vw;
  color: #eee;
  cursor: pointer;
  transition: box-shadow 0.3s ease, color 0.3s ease; /* Added transition for color */
}

.video-close-storage:hover, .audio-close-storage:hover, .image-close-storage:hover, .file-close-storage:hover {
  color: rgba(255, 255, 0, 0.799);
}

.upload-button {
  display: block;
    border: 2px dashed #171b70; /* Dashed border */
    padding: 10px;
    text-align: center;
    cursor: pointer;
    background-color: #f8f8f8;
    color: #171b70;
    margin-bottom: 5px; /* Space after the button */
    width: 100%; /* Take full width of the container */
    box-sizing: border-box; /* Include padding and border in the width */
    /*  float: left;  */
}

.video-upload-storage-button, .audio-upload-storage-button, .image-upload-storage-button {
  display: block;
    border: 2px dashed #171b70; /* Dashed border */
    padding: 10px;
    text-align: center;
    cursor: pointer;
    background-color: #f8f8f8;
    color: #171b70;
    margin-bottom: 5px; /* Space after the button */
    width: 100%; /* Take full width of the container */
    box-sizing: border-box; /* Include padding and border in the width */
    font-weight: bold;
}

.image-upload-storage-button {
  margin-bottom: 0; /* Space after the button */
}

.minusplus { 
  float: left;
    color: #171b70;
    display: flex;
}

#cursorDiv {
  cursor: pointer;
  user-select: none; /* Standard syntax */
    -webkit-user-select: none; /* Safari and Chrome, Opera */
    -moz-user-select: none; /* Firefox */
    -ms-user-select: none; /* Internet Explorer/Edge */
}


.modal {
  display: none;
  position: fixed;
  z-index: 1000000 !important;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.6);
}

.modal-content {
  background-color: #171b70;
  margin: 15% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 30%;
}

.close {
  float: right;
  font-size: 3vw;
  font-weight: bold;
  color:#171b70;
  margin: -1.5vw -1vw 0 0;
}

.close:hover,
.close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}

button:hover {
  opacity: 0.8;
}

.plusminusLabel {
  display: flex;
    width: auto;
    align-items: center;
    margin-top: 1vw;
}

a.video-file-item, a.audio-file-item, a.image-file-item {
  color: white !important;
}

a.video-file-item:hover, a.audio-file-item:hover, a.image-file-item:hover {
  color: rgba(255, 255, 0, 0.799) !important;
} 

.ajs-dialog {
  width: 50% !important;
}

#overlay {
    position: fixed;
    display: none;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, #a70050, blue);
    color: white; /* White text */
    z-index: 1000;
    text-align: center;
    justify-content: center;
    align-items: center;
  }

  #overlay .message {
    color: white; /* White text */
    font-size: 2vw;
    margin: 0 20%;
    font-weight: bold;
    font-family: 'Trebuchet MS';
  }
/* Styles for the account overlay */
#accountOverlay {
  display: none;
    margin-top: 10vh;
    justify-content: flex-end;
    align-items: flex-start;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    flex-direction: column;
    justify-content: flex-start;
    align-items: flex-end;
        }

        /* Styles for the delete account div */
        #deleteAccount {
          background-color: white;
    padding: 10px 48px 15px 10px;
    cursor: pointer;
    width: 40vw;
    font-size: 1.2vw;
    height: 4vw;
        }
        #userEmail{
          background-color: white;
    padding: 10px 48px 10px 10px;
    cursor: pointer;
    height: 4vw;
    width: 40vw;
    font-size: 1.2vw;
    cursor: default;
        }

  #account{
    cursor: pointer;
  }

  #deleteAccount:hover {
    color: red;
}

#deleteAccount:active {
    color: red;
}
</style>
<link rel="stylesheet" href="css/bootstrap.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

<script type="module">

  // Import the necessary functions from Firebase SDK
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut, deleteUser as firebaseDeleteUser, reauthenticateWithCredential, EmailAuthProvider  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, doc, setDoc, updateDoc, collection, deleteDoc} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  import { getDoc, getDocs} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  import { getStorage, ref as storageRef, uploadBytes, getDownloadURL, listAll, getMetadata, deleteObject} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";
  

  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyDDaU-zKXNTQUHsL8PQOduxeQcOuYql9Zs",
    authDomain: "authentication-app-21e51.firebaseapp.com",
    databaseURL: "https://authentication-app-21e51-default-rtdb.firebaseio.com",
    projectId: "authentication-app-21e51",
    storageBucket: "authentication-app-21e51.appspot.com",
    messagingSenderId: "247019866345",
    appId: "1:247019866345:web:2c3e0873cd40ce42084878"
  };



// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();
const storage = getStorage();

function redirectToLogin() {
  window.location.href = 'https://www.sergeimedvedev.com/login';
}

function checkAuthState() {
  onAuthStateChanged(auth, user => {
    if (!user) {
      redirectToLogin();
    } else {
      document.getElementById('userEmail').innerText = user.email;
    }
  });
}


async function deleteUserFolderInStorage(userId) {
  const userFolderRef = storageRef(storage, `users/${userId}`);
  try {
    const listResults = await listAll(userFolderRef);
    await Promise.all(listResults.items.map(itemRef => deleteObject(itemRef)));
    console.log(`Deleted files in folder users/${userId} from storage.`);

    // Check for and delete any subdirectories
    await Promise.all(listResults.prefixes.map(async folderRef => {
      const nestedListResults = await listAll(folderRef);
      await Promise.all(nestedListResults.items.map(itemRef => deleteObject(itemRef)));
      console.log(`Deleted files in subdirectory ${folderRef.fullPath} from storage.`);
    }));

    console.log(`Deleted folder users/${userId} from storage.`);
  } catch (error) {
    console.error(`Failed to delete folder users/${userId} from storage: `, error);
    throw error; // Re-throw the error to abort the process
  }
}

async function deleteUserFolderInFirestore(userId) {
  const userDocRef = doc(db, 'users', userId);
  try {
    // Get all subcollections and delete them
    const subcollections = await getDocs(collection(userDocRef, 'templates'));
    await Promise.all(subcollections.docs.map(async doc => {
      await deleteDoc(doc.ref);
      console.log(`Deleted subdocument ${doc.id} in collection templates.`);
    }));

    // Delete the main document
    await deleteDoc(userDocRef);
    console.log(`Deleted document users/${userId} from Firestore.`);
  } catch (error) {
    console.error(`Failed to delete document users/${userId} from Firestore: `, error);
    throw error; // Re-throw the error to abort the process
  }
}

async function reauthenticateUser(user) {
  return new Promise((resolve, reject) => {
    alertify.prompt("Re-authenticate", "Please enter your password to confirm:", "",
      function(evt, value) {
        if (!value) {
          alertify.error("Password is required for re-authentication.");
          resolve(false); // Resolve with false to indicate re-authentication did not proceed
          return;
        }
        const credential = EmailAuthProvider.credential(user.email, value);
        reauthenticateWithCredential(user, credential).then(() => {
          resolve(true); // Resolve with true to indicate successful re-authentication
        }).catch(error => {
          if (error.code === 'auth/wrong-password') {
            alertify.error("Incorrect password. Please try again.");
          } else if (error.code === 'auth/invalid-credential') {
            alertify.error("Invalid credentials. Please try again.");
          } else {
            alertify.error("Failed to re-authenticate. Please try again.");
          }
          resolve(false); // Resolve with false to indicate re-authentication failed
        });
      },
      function() {
        alertify.error("Re-authentication canceled.");
        resolve(false); // Resolve with false to indicate re-authentication was canceled
      }).set('type', 'password');
  });
}


// Set default options for AlertifyJS
alertify.defaults.glossary.title = 'Confirmation'; // Default title
// alertify.defaults.glossary.ok = 'Confirm'; // OK button label
alertify.defaults.glossary.cancel = 'Cancel'; // Cancel button label


// Function to handle account deletion
async function handleDeleteAccount() {
  const user = auth.currentUser;
  if (!user) {
    alertify.error("No user is signed in.");
    return;
  }
  const userId = user.uid;

  try {
    // Step 3: Show customized alertify confirmation popup
    alertify.confirm(
      "Delete Account",
      "Are you sure you want to delete your account?",
      async function () {
        try {
          // Re-authenticate the user
          const reauthenticated = await reauthenticateUser(user);
          if (!reauthenticated) {
            // If re-authentication did not proceed, do not continue with deletion
            return;
          }

          // Show overlay message
          const overlay = document.getElementById('overlay');
          overlay.style.display = 'flex';

          // Step 1: Delete user's folder in Firebase Storage
          await deleteUserFolderInStorage(userId);

          // Step 2: Delete user's folder in Firestore
          await deleteUserFolderInFirestore(userId);

          // Step 4: Delete user account
          await firebaseDeleteUser(user);
          console.log("User account deleted.");
                    
            redirectToLogin();
        } catch (error) {
          alertify.error("Failed to delete user account.");
          // Hide the overlay in case of error
          document.getElementById('overlay').style.display = 'none';
        }
      },
      function () {
        alertify.error("User canceled account deletion.");
      }
    ).setHeader('Delete Account Confirmation'); // Custom header text

  } catch (error) {
    alertify.error("Error during account deletion process.");
  }
}


// Add event listener to the delete account button
document.getElementById("deleteAccount").addEventListener("click", handleDeleteAccount);





  function setupVisibilityChangeListener() {
    document.addEventListener("visibilitychange", () => {
      if (document.visibilityState === 'visible') {
        checkAuthState();
      }
    });
  }

  function preventBackNavigation() {
    window.history.pushState(null, "", window.location.href);
    window.addEventListener('popstate', function() {
      window.history.pushState(null, "", window.location.href);
      checkAuthState();
    });
  }

  // Initial checks and setup
  checkAuthState();
  setupVisibilityChangeListener();
  preventBackNavigation();

function debounce(func, wait) {
  let timeout;

  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };

    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
};

let currentTemplateId;

// Function to load the most recent template or create a new one
const loadMostRecentTemplate = async () => {
  if (auth.currentUser) {
    const templatesRef = collection(db, "users", auth.currentUser.uid, "templates");
    const querySnapshot = await getDocs(templatesRef);

    let mostRecentTemplate = null;
    let latestTimestamp = 0;
    querySnapshot.docs.forEach(doc => {
      const templateData = doc.data();
      if (templateData.createdAt && templateData.createdAt > latestTimestamp) {
        latestTimestamp = templateData.createdAt;
        mostRecentTemplate = { id: doc.id, ...templateData };
      }
    });

    if (mostRecentTemplate) {
      // Load the most recent template
      currentTemplateId = mostRecentTemplate.id;
      document.getElementById("left-column").innerHTML = mostRecentTemplate.leftColumn || '';
      document.getElementById("right-column").innerHTML = mostRecentTemplate.rightColumn || '';
      reinitializeInteractiveElements();

      // Update the style of the selected template button
      updateSelectedTemplateButtonStyle(mostRecentTemplate.id);
    } else {
      // Create a new page if no templates exist
      await createAndSaveNewTemplate();
    }
  }
};

const createAndSaveNewTemplate = async () => {
  currentTemplateId = generateTemplateId();
  document.getElementById("left-column").innerHTML = '<div id="welcomeMessageLeft" class="welcome-message1">ADD TOOLS FROM THE BLUE COLUMN</div>'; // Set default content if necessary
  document.getElementById("right-column").innerHTML = '<div id="welcomeMessageRight" class="welcome-message2">SEE RESULT HERE</div>'; // Set default content if necessary

  // Save the new template to Firestore
  const templateDocRef = doc(db, "users", auth.currentUser.uid, "templates", currentTemplateId);
  try {
    await setDoc(templateDocRef, {
      name: 'New Page', // Default name for new templates
      leftColumn: '',
      rightColumn: '',
      createdAt: Date.now() // Add the current timestamp here
    });

    // Create a button for the new template in the UI
    const newTemplateButton = createTemplateItem(currentTemplateId, 'New Page');
    const buttonsColumn = document.getElementById('buttons-column');
    if (buttonsColumn) {
      buttonsColumn.appendChild(newTemplateButton);
    } else {
      console.error("Error: 'buttons-column' element not found in the DOM.");
    }
  } catch (error) {
    console.error("Error saving new template: ", error);
  }

  // Update the style of the selected template button
  updateSelectedTemplateButtonStyle(currentTemplateId);
};

    const generateTemplateId = () => {
    // Ensure that this function generates a valid Firestore document ID
    return doc(collection(db, 'users', auth.currentUser.uid, 'templates')).id;
	};

const saveTemplate = async (templateName = "New Page") => {
  if (auth.currentUser && currentTemplateId && !isDeleting) {
    // Fetch current template name from the corresponding button in the UI
    const templateButton = document.querySelector(`[data-template-id="${currentTemplateId}"]`);
    const currentTemplateName = templateButton ? templateButton.textContent : 'New Page';

    // Update value attributes before saving innerHTML for inputs and textareas
    const inputs = document.getElementById("left-column").querySelectorAll("input[type='text']");
    inputs.forEach(input => {
      input.setAttribute('value', input.value);
    });

    const textareas = document.getElementById("left-column").querySelectorAll("textarea");
    textareas.forEach(textarea => {
      textarea.textContent = textarea.value;
    });

    // Now capture the innerHTML
    const leftColumnHtml = document.getElementById("left-column").innerHTML;
    const rightColumnHtml = document.getElementById("right-column").innerHTML;

    const templateDocRef = doc(db, "users", auth.currentUser.uid, "templates", currentTemplateId);
    try {
      await setDoc(templateDocRef, {
        name: currentTemplateName, // Save the template name
        leftColumn: leftColumnHtml,
        rightColumn: rightColumnHtml,
        createdAt: Date.now() // Add the current timestamp here
      });
    } catch (error) {
      console.error("Error saving template: ", error);
    }
  }
};

  
const renameTemplate = async (templateId, templateButton) => {
  const modal = document.getElementById('renameModal');
  const newNameInput = document.getElementById('newTemplateName');
  const confirmRename = document.getElementById('confirmRename');
  const cancelRename = document.getElementById('cancelRename');
  const close = document.getElementsByClassName('close')[1]; // If it's the second modal in your HTML

  newNameInput.value = templateButton.textContent; // Pre-fill with current name
  modal.style.display = 'block';

  close.onclick = function() {
    modal.style.display = 'none';
  };

  cancelRename.onclick = function() {
    modal.style.display = 'none';
  };

  confirmRename.onclick = async function() {
    const newName = newNameInput.value;
    if (newName) {
      templateButton.textContent = newName; // Update button text

      // Save new name to Firestore
      const templateRef = doc(db, "users", auth.currentUser.uid, "templates", templateId);
      try {
        await updateDoc(templateRef, { name: newName });
        console.log("Template name updated successfully");
      } catch (error) {
        console.error("Error updating template name: ", error);
      }
      modal.style.display = 'none';
    }
  };

  window.onclick = function(event) {
    if (event.target == modal) {
      modal.style.display = 'none';
    }
  };
};


// Function to delete template both from Firestore and the UI
let isDeleting = false;
const deleteTemplate = async (templateId, templateContainer) => {
  isDeleting = true;
  const isCurrentTemplate = templateId === currentTemplateId;

  const templateRef = doc(db, "users", auth.currentUser.uid, "templates", templateId);
  try {
    await deleteDoc(templateRef);
    templateContainer.remove();
    console.log("Template deleted successfully");

    if (isCurrentTemplate) {
      // Fetch the remaining templates and find the most recent one
      const templatesRef = collection(db, "users", auth.currentUser.uid, "templates");
      const querySnapshot = await getDocs(templatesRef);

      let mostRecentTemplate = null;
      let latestTimestamp = 0;
      querySnapshot.docs.forEach(doc => {
        const templateData = doc.data();
        if (templateData.createdAt && templateData.createdAt > latestTimestamp) {
          latestTimestamp = templateData.createdAt;
          mostRecentTemplate = { id: doc.id, ...templateData };
        }
      });

      // Load the most recent template if it exists
      if (mostRecentTemplate) {
        currentTemplateId = mostRecentTemplate.id;
        document.getElementById("left-column").innerHTML = mostRecentTemplate.leftColumn || '';
        document.getElementById("right-column").innerHTML = mostRecentTemplate.rightColumn || '';
        reinitializeInteractiveElements();
        updateSelectedTemplateButtonStyle(mostRecentTemplate.id);
      } else {
        // If no templates are left, clear the UI and create a new page
        document.getElementById("right-column").innerHTML = '';
        document.getElementById("left-column").innerHTML = '';
        currentTemplateId = null;
        await createAndSaveNewTemplate();
      }
    } else {
      // Fetch and display the remaining templates
      await fetchAndDisplayTemplates();

      // Update the style of the most recent template button
      const firstTemplateButton = document.querySelector(".template-button");
      if (firstTemplateButton) {
        const mostRecentTemplateId = firstTemplateButton.dataset.templateId;
        updateSelectedTemplateButtonStyle(mostRecentTemplateId);
      }
    }
  } catch (error) {
    console.error("Error deleting template: ", error);
  } finally {
    isDeleting = false;  // Reset isDeleting to false once everything is complete
  }
};

const updateSelectedTemplateButtonStyle = (selectedTemplateId) => {
  const templateButtons = document.querySelectorAll('.template-button');
  templateButtons.forEach(button => {
    if (button.dataset.templateId === selectedTemplateId) {
      button.classList.add('selected-template-button');
    } else {
      button.classList.remove('selected-template-button');
    }
  });
};


// Function to create a template button with a kebab menu
function createTemplateItem(templateId, templateName) {
  const templateContainer = document.createElement("div");
  templateContainer.className = "template-container";

  const templateButton = document.createElement("button");
  templateButton.textContent = templateName;
  templateButton.className = "template-button";
  templateButton.dataset.templateId = templateId;
  templateButton.addEventListener("click", () => {
    if (templateId !== currentTemplateId) {
      addLoadingOverlay(templateButton);
      debouncedLoadTemplate(templateId);

      // Update the style of the selected template button
      updateSelectedTemplateButtonStyle(templateId);
    }
  });

  const editButton = document.createElement("button");
  editButton.className = "fas fa-edit";
  editButton.style.backgroundColor = "#171b70";
  editButton.style.border = "none";
  editButton.addEventListener("click", () => renameTemplate(templateId, templateButton));

  const deleteButton = document.createElement("button");
  deleteButton.className = "fas fa-trash";
  deleteButton.style.backgroundColor = "#171b70";
  deleteButton.style.border = "none";
  document.body.appendChild(deleteButton);

  deleteButton.addEventListener("click", () => {
    const modal = document.getElementById('myModal');
    const close = document.getElementsByClassName('close')[0];
    const confirmDelete = document.getElementById('confirmDelete');
    const cancelDelete = document.getElementById('cancelDelete');

    modal.style.display = 'block';

    close.onclick = function() {
      modal.style.display = 'none';
    };

    cancelDelete.onclick = function() {
      modal.style.display = 'none';
    };

    confirmDelete.onclick = function() {
      deleteTemplate(templateId, templateContainer);
      modal.style.display = 'none';
    };

    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = 'none';
      }
    };
  });

  templateContainer.appendChild(templateButton);
  templateContainer.appendChild(editButton);
  templateContainer.appendChild(deleteButton); // Append the trash icon button

  return templateContainer;
}

// Function to add a loading overlay to the clicked button
  function addLoadingOverlay(button) {
    const overlay = document.createElement("div");
    overlay.className = "loading-overlay";
    overlay.innerHTML = '<i class="fas fa-spinner fa-spin"></i>'; // Font Awesome spinner icon

    // Match the overlay size and position to the button
    const buttonRect = button.getBoundingClientRect();
    overlay.style.width = `${buttonRect.width}px`;
    overlay.style.height = `${buttonRect.height}px`;
    overlay.style.position = 'absolute';
    overlay.style.top = `${button.offsetTop}px`;
    overlay.style.left = `${button.offsetLeft}px`;

    button.parentElement.appendChild(overlay);
  }
  
// Function to append a new page item to the buttons column
function appendNewTemplateItem(templateId, templateName) {
  const buttonsColumn = document.getElementById("buttons-column");
  const templateItem = createTemplateItem(templateId, templateName);
  const firstTemplateContainer = buttonsColumn.querySelector(".template-container");
  
  if (firstTemplateContainer) {
    buttonsColumn.insertBefore(templateItem, firstTemplateContainer);
  } else {
    // If there is no .template-container, append to the end
    buttonsColumn.appendChild(templateItem);
  }
}


// Function to clear only the template buttons from the UI
function clearTemplateButtons() {
  const existingTemplateContainers = document.querySelectorAll('.template-container');
  existingTemplateContainers.forEach(container => container.remove());
}

// Fetch and display user's templates in descending order of creation time
const fetchAndDisplayTemplates = async () => {
  if (auth.currentUser) {
    const templatesRef = collection(db, "users", auth.currentUser.uid, "templates");
    const querySnapshot = await getDocs(templatesRef);
    
    // Convert querySnapshot to an array and sort by createdAt timestamp
    const templates = querySnapshot.docs
      .map(doc => ({ id: doc.id, ...doc.data() }))
      .sort((a, b) => a.createdAt - b.createdAt); // Sort in descending order

    const buttonsColumn = document.getElementById("buttons-column");
    clearTemplateButtons(); // Clear existing template buttons before adding new ones
    
    // Append each sorted template item
    templates.forEach(template => {
      appendNewTemplateItem(template.id, template.name || 'New Page');
    });
  }
};

const loadTemplate = async (templateId) => {
  // Check if the selected template is already active
  if (templateId === currentTemplateId) {
    console.log("This template is already active.");
    return; // Exit the function if the template is already active
  }

  // IMPORTANT!!! Save the current template before loading another one
  if (currentTemplateId) {
    await saveTemplate();
    hasChanges = false;
    console.log('hasChanges is set to FALSE by loadTemplate function');

     // Function to update the status div TO SAVED
function updateSaveStatusToYes() {
    const statusDiv = document.getElementById("saveReport");
    statusDiv.innerHTML = '<span id="cloudDone" class="material-symbols-sharp" style="font-size: 1.2vw; padding-top: 0.1vw;">cloud_done</span>';    
}
updateSaveStatusToYes();

  }

  // Clear current content
  document.getElementById("right-column").innerHTML = '';
  document.getElementById("left-column").innerHTML = '';

  // Load selected template
  const templateRef = doc(db, "users", auth.currentUser.uid, "templates", templateId);
  const docSnap = await getDoc(templateRef);

  if (docSnap.exists()) {
    const templateData = docSnap.data();
    document.getElementById("left-column").innerHTML = templateData.leftColumn;
    document.getElementById("right-column").innerHTML = templateData.rightColumn;
    currentTemplateId = templateId; // Update current template ID

    // Update UI to reflect the active template
    updateActiveTemplateButton(templateId);
	updateSelectedTemplateButtonStyle(templateId);

    // Reinitialize event listeners and interactive elements
    reinitializeInteractiveElements();
  } else {
    console.log("No such template!");
  }
};

const debouncedLoadTemplate = debounce(async (templateId) => {
    if (templateId === currentTemplateId) {
      console.log("This template is already active.");
      return;
    }
    //IMPORTANT!!! MAYBE
    if (currentTemplateId) {
      await saveTemplate();
      hasChanges = false;
    console.log('hasChanges is set to FALSE by debouncedLoadTemplate function');
        
     // Function to update the status div TO SAVED
function updateSaveStatusToYes() {
    const statusDiv = document.getElementById("saveReport");
    statusDiv.innerHTML = '<span id="cloudDone" class="material-symbols-sharp" style="font-size: 1.2vw; padding-top: 0.1vw;">cloud_done</span>';    
}
updateSaveStatusToYes();
      
    }
    // Clear the overlay
    document.querySelectorAll('.loading-overlay').forEach(el => el.remove());

    const templateRef = doc(db, "users", auth.currentUser.uid, "templates", templateId);
    const docSnap = await getDoc(templateRef);

    if (docSnap.exists()) {
      const templateData = docSnap.data();
      document.getElementById("left-column").innerHTML = templateData.leftColumn;
      document.getElementById("right-column").innerHTML = templateData.rightColumn;
      currentTemplateId = templateId;
      reinitializeInteractiveElements();
    } else {
      console.log("No such template!");
    }
  }, 500);
  
// Helper function to update UI for active template button
const updateActiveTemplateButton = (activeTemplateId) => {
  const templateButtons = document.querySelectorAll('.template-button');
  templateButtons.forEach(button => {
    if (button.dataset.templateId === activeTemplateId) {
      button.classList.add('active-template-button'); // Add a class to indicate active status
    } else {
      button.classList.remove('active-template-button');
    }
  });
};

// Handler for delete button click
function handleDeleteButtonClick(event) {
  const textareaContainer = event.target.closest(".textarea-container-three");
  const shapeId = textareaContainer.id.replace('textarea-container', 'shape');
  const shape = document.getElementById(shapeId);
  textareaContainer.remove();
  shape.remove();
    if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
}

// Handler for up button click
function handleUpButtonClick(event) {
  const textareaContainer = event.target.closest(".textarea-container-three");
  const prevTextareaContainer = textareaContainer.previousElementSibling;
  if (prevTextareaContainer) {
    textareaContainer.parentNode.insertBefore(textareaContainer, prevTextareaContainer);
    const shape = document.getElementById(textareaContainer.id.replace('textarea-container', 'shape'));
    const rightColumn = shape.parentNode;
    const prevShape = rightColumn.querySelector(`#${prevTextareaContainer.id.replace('textarea-container', 'shape')}`);
    rightColumn.insertBefore(shape, prevShape);
  }
   if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
}

// Handler for down button click
function handleDownButtonClick(event) {
  const textareaContainer = event.target.closest(".textarea-container-three");
  const nextTextareaContainer = textareaContainer.nextElementSibling;
  if (nextTextareaContainer) {
    textareaContainer.parentNode.insertBefore(nextTextareaContainer, textareaContainer);
    const shape = document.getElementById(textareaContainer.id.replace('textarea-container', 'shape'));
    const rightColumn = shape.parentNode;
    const nextShape = rightColumn.querySelector(`#${nextTextareaContainer.id.replace('textarea-container', 'shape')}`);
    rightColumn.insertBefore(nextShape, shape);
  }
   if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
}

function initializeQuill(id) {
    var Quill = window.Quill;
    
    // Custom Size Style Attributor to support 'vw' units
    const Parchment = Quill.import('parchment');
    const SizeStyle = new Parchment.Attributor.Style('size', 'font-size', {
        scope: Parchment.Scope.INLINE,
        whitelist: ['1vw', '1.2vw', '1.4vw', '1.6vw', '1.8vw', '2.2vw', '2.6vw', '3.2vw', '3.6vw']
    });

    Quill.register(SizeStyle, true);

    var Font = Quill.import('formats/font');
    Font.whitelist = ['times-new-roman', 'inter', 'arial', 'georgia', 'calibri', 'helvetica', 'verdana', 'tahoma']; // Add fonts to the whitelist
    Quill.register(Font, true);

    var FontAttributor = Quill.import('attributors/class/font');
    FontAttributor.whitelist = ['times-new-roman', 'inter', 'arial', 'georgia', 'calibri', 'helvetica', 'verdana', 'tahoma']; // Add your fonts here
    Quill.register(FontAttributor, true);

    var FontStyle = Quill.import('attributors/style/font');
    FontStyle.whitelist = ['times-new-roman', 'inter', 'arial', 'georgia', 'calibri', 'helvetica', 'verdana', 'tahoma'];
    Quill.register(FontStyle, true);

    var Align = Quill.import('attributors/style/align');
    Quill.register(Align, true);

    var quill = new Quill(`#richEditor${id}`, {
        theme: 'snow', // or 'bubble'
        modules: {
            toolbar: [
                [{ 'font': Font.whitelist }],
                [{ 'size': SizeStyle.whitelist }],
                ['bold', 'italic', 'underline', 'strike'], // toggled buttons
                ['blockquote'],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                [{ 'script': 'sub'}, { 'script': 'super' }], // superscript/subscript
                [{ 'align': [] }], // alignment options
                ['link'], // Add 'link' button for hyperlinks
                ['clean'] // remove formatting button
            ],
            clipboard: {
                // Custom matcher to prevent images from being pasted
                matchers: [
                    ['img', function(node, delta) {
                        return new Quill.Delta();
                    }]
                ]
            }
        },
        formats: ['font', 'size', 'align', 'bold', 'italic', 'underline', 'strike', 'blockquote', 
            'list', 'script', 'clean', 'link'] // Add 'link' to formats
    });

    
    quill.on('text-change', function() {
        const content = quill.root.innerHTML;
        document.getElementById(`richEditorPlaceholder${id}`).innerHTML = content;
		saveTemplate();
    });
}

function reinitializeInteractiveElements() {

  hasChanges = false;
  console.log('hasChanges is set to FALSE by REINIT');
    // Set up the interval to call saveTemplate every 1 minute
    setInterval(() => {
  if (hasChanges) {
    saveTemplate();
    console.log('Saved automatically after 1 minute since last change IN REINIT');
    hasChanges = false;
    console.log('hasChanges is set to FALSE by setInterval IN REINIT');

         // Function to update the status div TO SAVED
function updateSaveStatusToYes() {
    const statusDiv = document.getElementById("saveReport");
    statusDiv.innerHTML = '<span id="cloudDone" class="material-symbols-sharp" style="font-size: 1.2vw; padding-top: 0.1vw;">cloud_done</span>';    
}
updateSaveStatusToYes();
    
  }
}, 300000);

    
     // Function to update the status div TO SAVED
     function updateSaveStatusToYes() {
    const statusDiv = document.getElementById("saveReport");
        statusDiv.innerHTML = '<span id="cloudDone" class="material-symbols-sharp" style="font-size: 1.2vw; padding-top: 0.1vw;">cloud_done</span>';    
}


// Function to update the status div TO NOT SAVED
function updateSaveStatusToNo() {
    const statusDiv = document.getElementById("saveReport");
    statusDiv.innerHTML = '<span id="cloudSync" class="material-symbols-sharp" style="font-size: 1.2vw; padding-top: 0.1vw;">cloud_sync</span>';    
}


  // Re-bind event listeners to all interactive elements
  // We will find the text areas and input fields by class names and id patterns
  const leftColumn = document.getElementById("left-column");
  const rightColumn = document.getElementById("right-column");

  // Reinitialize textareas and inputs
  const textareas = leftColumn.querySelectorAll('textarea');
  const inputs = leftColumn.querySelectorAll("input[type='text']:not([data-quizTextarea='quizTextarea'])");

  textareas.forEach(textarea => {
    textarea.addEventListener("input", function() {
      // We need to find the corresponding placeholder in the right column by matching the numeric part of the id
      const correspondingId = textarea.id.match(/\d+/)[0]; // This extracts the number from the id
      const rightColumnPlaceholder = rightColumn.querySelector(`#secondplaceholder${correspondingId}`);
      if (rightColumnPlaceholder) {
        rightColumnPlaceholder.innerText = textarea.value;
        updateTemplateContent(`shape${correspondingId}.secondPlaceholder`, textarea.value);
      }
       if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
    });
  });

  inputs.forEach(input => {
    input.addEventListener("input", function() {
      // Similar to textareas, match the input id with the placeholder in the right column
      const correspondingId = input.id.match(/\d+/)[0];
      const rightColumnPlaceholder = rightColumn.querySelector(`#firstplaceholder${correspondingId}`);
      if (rightColumnPlaceholder) {
        rightColumnPlaceholder.innerText = input.value;
        updateTemplateContent(`shape${correspondingId}.firstPlaceholder`, input.value);
      }
       if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
    });
  });
  const textareaContainers = document.querySelectorAll('.textarea-container-three');
  textareaContainers.forEach(container => {
    const deleteButton = container.querySelector('.delete-button');
    const upButton = container.querySelector('.up-button');
    const downButton = container.querySelector('.down-button');

    if (deleteButton) {
      deleteButton.removeEventListener("click", handleDeleteButtonClick);
      deleteButton.addEventListener("click", handleDeleteButtonClick);
    }

    if (upButton) {
      upButton.removeEventListener("click", handleUpButtonClick);
      upButton.addEventListener("click", handleUpButtonClick);
    }

    if (downButton) {
      downButton.removeEventListener("click", handleDownButtonClick);
      downButton.addEventListener("click", handleDownButtonClick);
    }
  });
  
	  // Reinitialize Slick sliders - left column
	$(leftColumn).find('.slick-slider').removeClass('slick-initialized');
	const sliders = leftColumn.querySelectorAll('.slick-slider');
	sliders.forEach(slider => {
		  // Extract the image URLs and the index of the active slide
		  const imageUrls = Array.from(slider.querySelectorAll('.slick-slide:not(.slick-cloned) img')).map(img => img.src);
		  const activeIndex = Array.from(slider.querySelectorAll('.slick-slide')).findIndex(slide => slide.classList.contains('slick-active')) - 1;

		  // Clear the slider HTML and rebuild it
		  slider.innerHTML = '';
		  imageUrls.forEach(url => {
			const slideDiv = document.createElement('div');
			const imgElement = document.createElement('img');
			imgElement.src = url;
			slideDiv.appendChild(imgElement);
			slider.appendChild(slideDiv);
		  });

		  // Reinitialize the Slick slider
		  $(slider).slick({
			dots: true,
			infinite: true,
			speed: 500,
			slidesToShow: 1,
			initialSlide: activeIndex
		  });

		// Inside your sliders.forEach loop, after reinitializing the slider...

		$(slider).on('afterChange', function(event, slick, currentSlide) {
		  // Find the numeric ID based on the ID naming convention of the slider's container
		  const containerId = slider.closest('.textarea-container-three').id;
		  const numericIdMatch = containerId.match(/(\d+)/);

		  if (numericIdMatch) {
			const numericId = numericIdMatch[0];

			// Use the numeric ID to find the corresponding shape
			const correspondingShapeId = `shape${numericId}`;
			const shapeDiv = document.getElementById(correspondingShapeId);

			if (shapeDiv && shapeDiv.querySelector('.banner-placeholder')) {
			  const activeImgSrc = slick.$slides[currentSlide].querySelector("img").src;
			  shapeDiv.querySelector('.banner-placeholder').innerHTML = `<img src="${activeImgSrc}" style="width: 100%;">`;
			}
			// Save the current state to Firestore
			 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
		  } else {
			console.error('Numeric ID not found for slider container:', containerId);
		  }
		});

	});










	
	  // Reinitialize Slick sliders - right column
  $(rightColumn).find('.slick-slider[data-type="flashcard"]').removeClass('slick-initialized');
const flashcardSliders = rightColumn.querySelectorAll('.slick-slider[data-type="flashcard"]');

    flashcardSliders.forEach(slider => {
        // Ensure we're targeting only our flashcard sliders, if they have a specific class, check here

        // Extract existing flashcard data
        const flashcardContainers = slider.querySelectorAll('.flashcard-container');

        // Clear existing slider content
        slider.innerHTML = '';

        // Rebuild each flashcard into the slider and reapply event listeners
        flashcardContainers.forEach(container => {
            const newSlideDiv = document.createElement('div');
            const clonedContainer = container.cloneNode(true);
            newSlideDiv.appendChild(clonedContainer);
            slider.appendChild(newSlideDiv);

            // Reapply the flip event listener to the cloned container
            clonedContainer.addEventListener('click', function() {
                this.classList.toggle('flipped');
                // Optionally, if you have a save function to call upon flipping
                 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
            });
        });

        // Reinitialize slick with the rebuilt flashcards
        $(slider).slick({
            dots: false,
            infinite: false,
            speed: 300,
            slidesToShow: 1,
            adaptiveHeight: true,
        });
		
		$(slider).find('.slick-slide .flashcard-container').css('width', '100%');
		
    });	
	
	// Reinitialize the "Add Another Flashcard" buttons
	document.querySelectorAll('.add-textarea-pair-btn').forEach(button => {
		const buttonIdNumericPart = button.id.match(/\d+/)[0]; // Extract numeric ID part
		const correspondingSlider = document.querySelector(`#flashcard-slider${buttonIdNumericPart}`);

		if (correspondingSlider) {
			button.addEventListener("click", function() {
				// Ensure to pass 'button' as an argument here
				const textareaContainer = document.querySelector(`#textarea-container${buttonIdNumericPart}`);
				var pElementsCount = textareaContainer.querySelectorAll('p').length;
				const newPElement = document.createElement("p");
					newPElement.innerText = "FLASHCARD " + pElementsCount;
					newPElement.style.marginTop = "5px";
					newPElement.style.marginBottom = "0px";
          newPElement.style.fontSize = "10px";
          newPElement.style.color = "#171b70";

          const secondTextareas = Array.from(textareaContainer.querySelectorAll('textarea'))
                             .filter(textarea => textarea.id.startsWith('secondtextarea'));

// Check if we found any matching divs
if (secondTextareas.length > 0) {
    // Step 3: Determine the last 'firsttextarea' div
    const lastSecondTextarea = secondTextareas[secondTextareas.length - 1];
    
    // Step 5: Insert the new p element before the last 'firsttextarea' div
    // Check if the lastFirstTextarea is the last child of its parent
    if (lastSecondTextarea.nextElementSibling) {
        // If there's an element after the lastFirstTextarea, insert before it
        textareaContainer.insertBefore(newPElement, lastSecondTextarea.nextElementSibling);
    } else {
        // If lastFirstTextarea is the last child, simply append the new p element
        textareaContainer.appendChild(newPElement);
    }
} else {
    console.log('No textareas with ID starting "secondtextarea" were found.');
}
					appendTextareasToContainer(textareaContainer, correspondingSlider.parentNode, false, button);
					pElementsCount++;
			});
		}
	});

  // Reinitialize and apply adjustFontSizeToFit to each flashcard-front and flashcard-front within rightColumn to avoid the text going beyond top and bottom incl. on screen resizing
function reinitializeFlashcards() {

  function adjustFontSizeToFit(container, maxFontSizeVw = 2, minFontSizeVw = 0.3, stepVw = 0.1) {
    // Obtain the current height of the container.
    const currentHeight = container.offsetHeight;
    let currentFontSize = maxFontSizeVw;
    container.style.fontSize = `${currentFontSize}vw`;

    // Adjust font size based on container's current height instead of a fixed maxHeightPx
    while ((container.scrollHeight > currentHeight) && currentFontSize > minFontSizeVw) {
        currentFontSize -= stepVw;
        container.style.fontSize = `${currentFontSize}vw`;
    }
}
    // Select all .flashcard-front divs within rightColumn
    const rightColumn = document.getElementById('right-column'); // Assuming there's an element with id='rightColumn'
    const flashcards = rightColumn.querySelectorAll('.flashcard-front, .flashcard-back');

    // Iterate over each flashcard-front and apply adjustFontSizeToFit
    Array.from(flashcards).forEach(flashcard => {
        adjustFontSizeToFit(flashcard);
    });

    // Assuming you want to keep the mutation observer on each of these elements:
    flashcards.forEach(flashcard => {
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === "characterData" || mutation.type === "childList") {
                    adjustFontSizeToFit(flashcard);
                }
            });
        });

        // Configuration object for the observer
        const config = { characterData: true, childList: true, subtree: true };

        // Start observing the flashcard for changes in its text content
        observer.observe(flashcard, config);
    });
}

// Assuming you want to call this function to reinitialize:
reinitializeFlashcards();








	  // Reinitialize Slick sliders - right column

    const quizLabels = rightColumn.querySelectorAll('.quizLabel');
  quizLabels.forEach(quizLabel => {
    quizLabel.style.color = '#333333';
  });

  const allPopups = rightColumn.querySelectorAll('.popup');
  allPopups.forEach(popup => {
    popup.remove();
  });

$(rightColumn).find('.slick-slider[data-type="quiz"]').removeClass('slick-initialized');
const quizSliders = rightColumn.querySelectorAll('.slick-slider[data-type="quiz"]');


quizSliders.forEach(slider => {
        // Ensure we're targeting only our flashcard sliders, if they have a specific class, check here

        // Extract existing flashcard data
        const flashcardContainers = slider.querySelectorAll('.flashcard-container');

        // Clear existing slider content
        slider.innerHTML = '';

        // Rebuild each flashcard into the slider and reapply event listeners
        flashcardContainers.forEach(container => {
            const newSlideDiv = document.createElement('div');
            const clonedContainer = container.cloneNode(true);
            newSlideDiv.appendChild(clonedContainer);
            slider.appendChild(newSlideDiv);
        });

        // Reinitialize slick with the rebuilt flashcards
        $(slider).slick({
            dots: false,
            infinite: false,
            speed: 300,
            slidesToShow: 1,
            adaptiveHeight: true,
        });
		
		$(slider).find('.slick-slide .flashcard-container').css('width', '100%');

    $(slider).on('click', '.slick-next-button', function() {
        // Extract the numeric part from the button's ID
        var numericID = this.id.match(/\d+$/)[0];

        // Find the div with ID 'shape' concatenated with numericID
        var targetDiv = $('#shape' + numericID);

        // Find all inputs within targetDiv and change their parent label's text color to black
        targetDiv.find('input').each(function() {
        $(this).parent('label').css('color', 'black');
        });

        // Find all checked inputs within targetDiv and change their parent label's text color to red
        targetDiv.find('input:checked').each(function() {
        $(this).parent('label').css('color', 'red');
        });

        // Find all inputs within targetDiv with ID 'true' and change their parent label's text color to green
        targetDiv.find('input[id="true"]').each(function() {
        $(this).parent('label').css('color', 'green');
        });

        // Find all checked inputs within targetDiv whose ID is 'true'
        var correctAnswers = targetDiv.find('input[id="true"]:checked').length;

        // Find the number of .flashcard-container divs within targetDiv
        var numberOfQuestions = targetDiv.find('input[id="true"]').length;
        if (numberOfQuestions === 0){
        numberOfQuestions = 1;
        }
        //var numberOfSlides = targetDiv.find('.flashcard-container').length;

        // Calculate the percentage of correct answers
        var percentCorrectAnswers = Math.round((correctAnswers / numberOfQuestions) * 100);

        var targetFlashcardContainer = $(this).closest('div[id^="firstplaceholder"]');

        // Remove any existing popup
        targetFlashcardContainer.find('.popup').remove();

        // Create a new popup element with the score information
        var popup = $('<div class="popup" style="font-weight: 500; position: absolute; width: 80%; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #f5f5f5; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px #777777; text-align: center; z-index: 100000;">' +
                  '<p>Correct answers: ' + correctAnswers + '</p>' +
                  '<p style="margin-bottom: 0">Your score: ' + percentCorrectAnswers + '%</p>' +
                  '</div>');

        // Append the popup to the targetDiv
        targetFlashcardContainer.append(popup);

        // Close the popup when clicking outside of it
        $(document).on('click', function(event) {
        if (!$(event.target).closest('.popup').length && !$(event.target).is('.slick-next-button')) {
            $('.popup').remove();
        }
      });
    });
  });	


// Event listeners for radio buttons
const radioButtons = leftColumn.querySelectorAll('.quizOptionCheckbox'); // Make sure this is the correct class for your radio buttons

// Initially set the radio button to checked if 'data-checked' is 'true'
radioButtons.forEach(radioButton => {
    if (radioButton.getAttribute('data-checked') === 'true') {
        radioButton.checked = true;
         if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
    }
});

radioButtons.forEach(radioButton => {

    // Add event listener for change events
    radioButton.addEventListener('change', function() {

        // Set all radio buttons' data-checked attribute to 'false'
        radioButtons.forEach(r => {
            r.setAttribute('data-checked', 'false');
             if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
        });
        
        // Set the data-checked attribute of the currently checked radio button to 'true'
        if (this.checked) {
            this.setAttribute('data-checked', 'true');
             if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
        }

        if (this.checked) {
                const numericID = parseInt(this.id.match(/\d+/)[0], 10);
                const numericName = parseInt(this.name.match(/\d+/)[0], 10);
                const targetName = 'dynamicRadio' + numericName;
                const radios = document.querySelectorAll(`.quizRadioButton[name="${targetName}"]`);

                radios.forEach(radio => {
                    if (parseInt(radio.dataset.numericId, 10) === numericID) {
                        radio.id = 'true';
                        console.log(`ID 'true' applied to radio button with ID ${radio.id}`);
                    } else {
                        radio.id = 'false'; 
                        console.log(`ID cleared from radio button`);
                    }
                });
            }
    });
});






const quizInputs = leftColumn.querySelectorAll('input.quizOption');

quizInputs.forEach(input => {
    input.addEventListener('input', () => {
        let text = input.value.trim();

        const closestParent= input.closest('.optionInputsContainerClass');
        const inputID = closestParent.id.match(/\d+$/)[0];
        const numericId = input.id.match(/\d+$/)[0];

        const idForPlaceholder = input.name.match(/\d+$/)[0];

        const targetPlaceholder = rightColumn.querySelector(`.flashcard-quiz[id^="firstplaceholder${idForPlaceholder}"]`);

        let radioButton = targetPlaceholder.querySelector(`input[data-numeric-id="${numericId}"]`);
        let label = targetPlaceholder.querySelector(`label[data-numeric-id="${numericId}"]`);

            if (text) {
                if (!radioButton) {
                    radioButton = document.createElement('input');
                    radioButton.type = 'radio';
                    radioButton.name = 'dynamicRadio' + inputID;
                    radioButton.className = 'quizRadioButton';
                    radioButton.dataset.numericId = numericId;

                    label = document.createElement('label');
                    label.dataset.numericId = numericId;
                    label.className = 'quizLabel';
                    label.appendChild(radioButton);
                    label.append(text);

                    let inserted = false;
                    const allLabels = targetPlaceholder.querySelectorAll('label');
                    allLabels.forEach((existingLabel) => {
                        const existingNumericId = existingLabel.dataset.numericId;
                        if (parseInt(numericId) < parseInt(existingNumericId) && !inserted) {
                          targetPlaceholder.insertBefore(label, existingLabel);
                            inserted = true;
                        }
                    });

                    const nextButton = targetPlaceholder.querySelector('.slick-next-button');

                    if (!inserted) {
                        if (nextButton) {
                          targetPlaceholder.insertBefore(label, nextButton);
                        } else {
                          targetPlaceholder.appendChild(label);
                        }
                    }
                } else {
                    // Update the label's text node with new text
                    label.childNodes[1].nodeValue = text;
                }
            } else if (label) {
                label.remove();
            }

        const observer = new MutationObserver(mutations => {
        mutations.forEach(mutation => {
            if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                mutation.addedNodes.forEach(node => {
                    if (node.nodeType === Node.ELEMENT_NODE && node.classList.contains('quizRadioButton')) {
                        console.log('New radio button added:', node);
                        updateRadioButtons();
                    }
                });
            }
        });
    });

    // Configuration of the observer:
    const config = { childList: true, subtree: true };

    // Start observing the document body for added nodes
    observer.observe(document.body, config);

    // Event listeners for checkboxes
    const checkboxes = leftColumn.querySelectorAll('.quizOptionCheckbox');
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', updateRadioButtons);
    });

  function updateRadioButtons() {
        checkboxes.forEach(checkbox => {
            if (checkbox.checked) {
                const numericID = parseInt(checkbox.id.match(/\d+/)[0], 10);
                const numericName = parseInt(checkbox.name.match(/\d+/)[0], 10);
                const targetName = 'dynamicRadio' + numericName;
                const radios = document.querySelectorAll(`.quizRadioButton[name="${targetName}"]`);

                radios.forEach(radio => {
                    if (parseInt(radio.dataset.numericId, 10) === numericID) {
                        radio.id = 'true';
                        console.log(`ID 'true' applied to radio button with ID ${radio.id}`);
                    } else {
                        radio.id = 'false'; 
                        console.log(`ID cleared from radio button`);
                    }
                });
            }
        });
    }

    // Call initially to set up any radios already on the page
    updateRadioButtons();
    });

});



const quizTextareas = document.querySelectorAll("input[data-quizTextarea='quizTextarea']");

    quizTextareas.forEach(firstTextarea => {
        const idSuffix = firstTextarea.id.match(/\d+$/)[0]; // Extract the numeric part of the ID
        // Ensure `rightColumn` is defined or replace it with `document` or another suitable reference
        const firstPlaceholder = document.querySelector(`#firstplaceholder${idSuffix}`);

        firstTextarea.addEventListener("input", function() {
            // Query all divs to persist
            const divsToPersist = firstPlaceholder.querySelectorAll('.quizLabel');
            const nextToPersist = firstPlaceholder.querySelectorAll('.slick-next-button');

            // Clear the firstPlaceholder but keep the divs to persist
            while (firstPlaceholder.firstChild) {
                firstPlaceholder.removeChild(firstPlaceholder.firstChild);
            }
            // Now, create a text node for the new input value and append it
            const textNode = document.createTextNode(firstTextarea.value || "Question Text");
            firstPlaceholder.appendChild(textNode);

            // Re-add the divs to persist
            divsToPersist.forEach(div => {
                firstPlaceholder.appendChild(div.cloneNode(true));
            });
            // Re-add the next button to persist
            nextToPersist.forEach(div => {
                firstPlaceholder.appendChild(div.cloneNode(true));
            });
             if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
        });
    });


	
	// Reinitialize the "Add Another Question" buttons
	document.querySelectorAll('.add-another-question-btn').forEach(button => {
		const buttonIdNumericPart = button.id.match(/\d+/)[0]; // Extract numeric ID part
		const correspondingSlider = document.querySelector(`#flashcard-slider${buttonIdNumericPart}`);

		if (correspondingSlider) {
			button.addEventListener("click", function() {
				// Ensure to pass 'button' as an argument here
				const textareaContainer = document.querySelector(`#textarea-container${buttonIdNumericPart}`);
				var pElementsCount = textareaContainer.querySelectorAll('p').length;
				const newPElement = document.createElement("p");
					newPElement.innerText = "QUESTION " + pElementsCount;
					newPElement.style.marginTop = "5px";
					newPElement.style.marginBottom = "0px";
          newPElement.style.fontSize = "10px";
          newPElement.style.color = "#171b70";


          const secondTextareas = Array.from(textareaContainer.querySelectorAll('.optionInputsContainerClass'));

// Check if we found any matching divs
if (secondTextareas.length > 0) {
    // Step 3: Determine the last 'firsttextarea' div
    const lastSecondTextarea = secondTextareas[secondTextareas.length - 1];
    
    // Step 5: Insert the new p element before the last 'firsttextarea' div
    // Check if the lastFirstTextarea is the last child of its parent
    if (lastSecondTextarea.nextElementSibling) {
        // If there's an element after the lastFirstTextarea, insert before it
        textareaContainer.insertBefore(newPElement, lastSecondTextarea.nextElementSibling);
    } else {
        // If lastFirstTextarea is the last child, simply append the new p element
        textareaContainer.appendChild(newPElement);
    }
} else {
    console.log('No textareas with ID starting "secondtextarea" were found.');
}
					appendQuizTextareasToContainer(textareaContainer, correspondingSlider.parentNode, false, button);
					pElementsCount++;
			});
		}
	});







  // Reinitialize and apply adjustFontSizeToFit to each flashcard-quiz and flashcard-quiz within rightColumn to avoid the text going beyond top and bottom incl. on screen resizing
function reinitializeQuizzes() {

  function adjustFontSizeToFit(container, maxFontSizeVw = 1.8, minFontSizeVw = 0.3, stepVw = 0.1) {
    // Obtain the current height of the container.
    const currentHeight = container.offsetHeight;
    let currentFontSize = maxFontSizeVw;
    container.style.fontSize = `${currentFontSize}vw`;

    // Adjust font size based on container's current height instead of a fixed maxHeightPx
    while ((container.scrollHeight > currentHeight) && currentFontSize > minFontSizeVw) {
        currentFontSize -= stepVw;
        container.style.fontSize = `${currentFontSize}vw`;
    }
}
    // Select all .flashcard-quiz divs within rightColumn
    const rightColumn = document.getElementById('right-column'); // Assuming there's an element with id='rightColumn'
    const flashcards = rightColumn.querySelectorAll('.flashcard-quiz, .flashcard-back');

    // Iterate over each flashcard-quiz and apply adjustFontSizeToFit
    Array.from(flashcards).forEach(flashcard => {
        adjustFontSizeToFit(flashcard);
    });

    // Assuming you want to keep the mutation observer on each of these elements:
    flashcards.forEach(flashcard => {
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === "characterData" || mutation.type === "childList") {
                    adjustFontSizeToFit(flashcard);
                }
            });
        });

        // Configuration object for the observer
        const config = { characterData: true, childList: true, subtree: true };

        // Start observing the flashcard for changes in its text content
        observer.observe(flashcard, config);
    });
}

// Assuming you want to call this function to reinitialize:
reinitializeQuizzes();











	//Reinitialize Quill
		const quillEditors = document.querySelectorAll(".textarea-container-three .rich-editor");
	
function removeAllToolbars(className) {
    // Get all elements with the specified class
    var elements = document.getElementsByClassName(className);

    // Filter out non-div elements
    var divs = Array.from(elements).filter(el => el.tagName === 'DIV');

    // Loop through the array of divs and remove each from the DOM
    divs.forEach(function(div) {
        div.parentNode.removeChild(div);
    });
}

// Call the function with 'ql-toolbar' as the argument
removeAllToolbars('ql-toolbar');
    
    quillEditors.forEach(editor => {
        // Extract the unique part of the ID used to match the editor to its shape
        const uniqueId = editor.id.match(/\d+/)[0];

        // Assuming that initializeQuill assigns the Quill instance to the editor element
        // You can now use Quill.find to get the instance if needed
        const quillInstance = Quill.find(editor);

        // After initializing Quill, restore the event listener for the 'text-change' event
        if (quillInstance) {
            quillInstance.on('text-change', function() {
                // Assuming the shape IDs follow a pattern like 'shape' + uniqueId
                const shapeId = `shape${uniqueId}`;
                const shape = document.getElementById(shapeId);

                if (shape) {
                    // Update the content of the shape with the new editor content
                    shape.innerHTML = quillInstance.root.innerHTML;
                    // Save the new state to the backend if needed
                     if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
                }
            });
        }
		// Reinitialize the Quill editor
        // This assumes initializeQuill function has been defined globally
		initializeQuill(uniqueId);
    });
	
	   // Reinitialize Menu2 text inputs
    const menu2TextAreas = leftColumn.querySelectorAll("input[type='text'][id^='textAreaOne'], input[type='text'][id^='textAreaTwo']");
    menu2TextAreas.forEach(input => {
        input.addEventListener('input', function () {
            const correspondingId = input.id.match(/\d+/)[0]; // Extract the numeric part
            const menuItemElement = rightColumn.querySelector(`#menuItemOne${correspondingId}, #menuItemTwo${correspondingId}`);
            if (menuItemElement) {
                menuItemElement.textContent = this.value || "Topic/Week";
                updateTemplateContent(`shape${correspondingId}.menuItemText`, this.value);
            }
             if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
        });
    });

    // Reinitialize Menu2 href inputs
    const menu2HrefInputs = leftColumn.querySelectorAll("input[type='text'][id^='textAreaHrefsOne'], input[type='text'][id^='textAreaHrefsTwo']");
    menu2HrefInputs.forEach(input => {
        input.addEventListener('input', function () {
            const correspondingId = input.id.match(/\d+/)[0]; // Extract the numeric part
            const anchorElement = rightColumn.querySelector(`#menuItemOne${correspondingId}, #menuItemTwo${correspondingId}`);
            if (anchorElement) {
                anchorElement.href = this.value || "https://instructure.com/";
                updateTemplateContent(`shape${correspondingId}.menuItemHref`, this.value);
            }
             if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
        });
    });
	
		// Reinitialize Menu3 text inputs
    const menu3TextAreas = leftColumn.querySelectorAll("input[type='text'][id^='textAreaOneE'], input[type='text'][id^='textAreaTwoE'], input[type='text'][id^='textAreaThreeE']");
    menu3TextAreas.forEach(input => {
        input.addEventListener('input', function () {
            const correspondingId = input.id.match(/\d+/)[0]; // Extract the numeric part
            const menuItemElement = rightColumn.querySelector(`#menuItemOneE${correspondingId}, #menuItemTwoE${correspondingId}, #menuItemThreeE${correspondingId}`);
            if (menuItemElement) {
                menuItemElement.textContent = this.value || "Topic/Week";
                updateTemplateContent(`shape${correspondingId}.menuItemTextE`, this.value);
            }
             if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
        });
    });

    // Reinitialize Menu3 href inputs
    const menu3HrefInputs = leftColumn.querySelectorAll("input[type='text'][id^='textAreaHrefsOneE'], input[type='text'][id^='textAreaHrefsTwoE'], input[type='text'][id^='textAreaHrefsThreeE']");
    menu3HrefInputs.forEach(input => {
        input.addEventListener('input', function () {
            const correspondingId = input.id.match(/\d+/)[0]; // Extract the numeric part
            const anchorElement = rightColumn.querySelector(`#menuItemOneE${correspondingId}, #menuItemTwoE${correspondingId}, #menuItemThreeE${correspondingId}`);
            if (anchorElement) {
                anchorElement.href = this.value || "https://instructure.com/";
                updateTemplateContent(`shape${correspondingId}.menuItemHrefE`, this.value);
            }
             if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
        });
    });

// Reinitialize image upload inputs
const imageUploads = leftColumn.querySelectorAll("input[type='file'].hidden-file-input-image");
imageUploads.forEach(upload => {
    const correspondingId = upload.id.match(/\d+/)[0]; // Extracts the number from the id
    const uploadButtonContainer = document.querySelector(`#plusminusLabel${correspondingId}`);
    const firstPlaceholder = rightColumn.querySelector(`#firstplaceholder${correspondingId}`);

        // Set up the plus and minus button event listeners if they exist
        const increaseWidthButton = uploadButtonContainer.querySelector(`#increaseWidth${correspondingId}`);
    const decreaseWidthButton = uploadButtonContainer.querySelector(`#decreaseWidth${correspondingId}`);
    if (increaseWidthButton && decreaseWidthButton) {
        let maxWidthPercentage = 100; // Assuming the starting width is reset to 100% when reinitialized
        increaseWidthButton.addEventListener('click', () => adjustImageWidth(correspondingId, 10));
        decreaseWidthButton.addEventListener('click', () => adjustImageWidth(correspondingId, -10));
    }
    
    // Reattach change event listener to handle file uploads
    upload.addEventListener("change", function(event) {
        handleImageUpload(event, firstPlaceholder, uploadButtonContainer);
    });


});

// Function to adjust image width
function adjustImageWidth(imageId, change) {
    const image = document.getElementById('uploadedImage' + imageId); // Adjust the selector as needed
    if (image) {
        let maxWidthPercentage = parseInt(image.style.maxWidth) || 100; // Get current width or default to 100%
        maxWidthPercentage += change;
        maxWidthPercentage = Math.max(20, Math.min(maxWidthPercentage, 100)); // Constrain width between 20% and 100%
        image.style.maxWidth = maxWidthPercentage + "%";
    }
}


    // Reinitialize image selects from storage
    const imageSelects = leftColumn.querySelectorAll(".image-upload-storage-button");
    imageSelects.forEach(select => {
      const correspondingId = select.id.match(/\d+/)[0]; // Extracts the number from the id
      const uploadButtonContainer = document.querySelector(`#plusminusLabel${correspondingId}`);
      const firstPlaceholder = rightColumn.querySelector(`#firstplaceholder${correspondingId}`);

    // Set up the plus and minus button event listeners if they exist
    const increaseWidthButton = uploadButtonContainer.querySelector(`#increaseWidth${correspondingId}`);
    const decreaseWidthButton = uploadButtonContainer.querySelector(`#decreaseWidth${correspondingId}`);
    if (increaseWidthButton && decreaseWidthButton) {
        let maxWidthPercentage = 100; // Assuming the starting width is reset to 100% when reinitialized
        increaseWidthButton.addEventListener('click', () => adjustImageWidthSelected(correspondingId, 10));
        decreaseWidthButton.addEventListener('click', () => adjustImageWidthSelected(correspondingId, -10));
    }

      select.addEventListener("click", function() {
            listAndSelectImages(firstPlaceholder, uploadButtonContainer);
            openImageStorage();
        });
        function openImageStorage() {
            const storageDiv = document.getElementById('image-storage-content'); 
            storageDiv.style.display = 'block';
        }

    });

    // Function to adjust image width for selected videos
function adjustImageWidthSelected(imageId, change) {
    const image = document.getElementById('selectedImage' + imageId); // Adjust the selector as needed
    if (image) {
        let maxWidthPercentage = parseInt(image.style.maxWidth) || 100; // Get current width or default to 100%
        maxWidthPercentage += change;
        maxWidthPercentage = Math.max(20, Math.min(maxWidthPercentage, 100)); // Constrain width between 20% and 100%
        image.style.maxWidth = maxWidthPercentage + "%";
    }
}


    // Reinitialize video upload inputs
    const videoUploads = leftColumn.querySelectorAll("input[type='file'].hidden-file-input-video");
    videoUploads.forEach(upload => {
        const correspondingId = upload.id.match(/\d+/)[0]; // Extracts the number from the id
        const uploadButtonContainer = document.querySelector(`#textarea-container${correspondingId}`);
        const firstPlaceholder = rightColumn.querySelector(`#firstplaceholder${correspondingId}`);
        
        // Reattach change event listener to handle file uploads
        upload.addEventListener("change", function(event) {
            handleVideoUpload(event, firstPlaceholder, uploadButtonContainer);
        });
    });
    
    // Reinitialize video selects from storage
    const videoSelects = leftColumn.querySelectorAll(".video-upload-storage-button");
    videoSelects.forEach(select => {
      const correspondingId = select.id.match(/\d+/)[0]; // Extracts the number from the id
      const uploadButtonContainer = document.querySelector(`#textarea-container${correspondingId}`);
      const firstPlaceholder = rightColumn.querySelector(`#firstplaceholder${correspondingId}`);

      select.addEventListener("click", function() {
            listAndSelectVideos(firstPlaceholder, uploadButtonContainer);
            openVideoStorage();
        });
        function openVideoStorage() {
            const storageDiv = document.getElementById('video-storage-content'); 
            storageDiv.style.display = 'block';
        }
    });

    

    // Reinitialize audio upload inputs
    const audioUploads = leftColumn.querySelectorAll("input[type='file'].hidden-file-input-audio");
    audioUploads.forEach(upload => {
        const correspondingId = upload.id.match(/\d+/)[0]; // Extracts the number from the id
        const uploadButtonContainer = document.querySelector(`#textarea-container${correspondingId}`);
        const firstPlaceholder = rightColumn.querySelector(`#firstplaceholder${correspondingId}`);
        
        // Reattach change event listener to handle file uploads
        upload.addEventListener("change", function(event) {
            handleAudioUpload(event, firstPlaceholder, uploadButtonContainer);
        });
    });


    // Reinitialize audio selects from storage
    const audioSelects = leftColumn.querySelectorAll(".audio-upload-storage-button");
    audioSelects.forEach(select => {
      const correspondingId = select.id.match(/\d+/)[0]; // Extracts the number from the id
      const uploadButtonContainer = document.querySelector(`#textarea-container${correspondingId}`);
      const firstPlaceholder = rightColumn.querySelector(`#firstplaceholder${correspondingId}`);

      select.addEventListener("click", function() {
            listAndSelectAudios(firstPlaceholder, uploadButtonContainer);
            openAudioStorage();
        });
        function openAudioStorage() {
            const storageDiv = document.getElementById('audio-storage-content'); 
            storageDiv.style.display = 'block';
        }
    });

  const colorSelectButtons = leftColumn.querySelectorAll('.colorSelectButtonClass');
  const imageSelectButtons = leftColumn.querySelectorAll('.imageSelectButtonClass');
  const colorSelectButtonsTwo = leftColumn.querySelectorAll('.colorSelectButtonClass2');
  const imageSelectButtonsTwo = leftColumn.querySelectorAll('.imageSelectButtonClass2');
  const colorSelectButtonsThree = leftColumn.querySelectorAll('.colorSelectButtonClass3');
  const imageSelectButtonsThree = leftColumn.querySelectorAll('.imageSelectButtonClass3');
  const colorSelectButtonsSection = leftColumn.querySelectorAll('.colorSelectButtonClassSection');
  const colorSelectButtonsTitle = leftColumn.querySelectorAll('.colorSelectButtonClassTitle');
  const colorSelectButtonsAccordion = leftColumn.querySelectorAll('.colorSelectButtonClassAccordion');
  const colorSelectButtonCardfront = leftColumn.querySelectorAll('.colorSelectButtonClassCardfront');
  const colorSelectButtonCardback = leftColumn.querySelectorAll('.colorSelectButtonClassCardback');

  
  

  colorSelectButtons.forEach(button => {
  button.addEventListener('click', function(event) {
    event.stopPropagation();
    const numericPart = this.id.match(/\d+/)[0];
    const targetColorPopupId = `colorPopup${numericPart}`;
    const colorPopup = document.getElementById(targetColorPopupId);

    document.querySelectorAll('.image-popup, .image-popup2, .color-popup2, .image-popup3, .color-popup3, .color-popup-section, .color-popup-title, .color-popup-accordion').forEach(popup => popup.style.display = 'none');

    document.querySelectorAll('.color-popup').forEach(popup => {
      if (popup.id !== targetColorPopupId) {
        popup.style.display = 'none';
      }
    });

    const colorElements = colorPopup.querySelectorAll('.colorElement');
    colorElements.forEach(colorElement => {
      colorElement.removeEventListener('click', handleColorSelection);
      colorElement.addEventListener('click', handleColorSelection);
    });

    colorPopup.style.display = colorPopup.style.display === 'none' ? 'flex' : 'none';
  });
});

function handleColorSelection(event) {
  const colorElement = event.currentTarget;

  const colorValue = colorElement.style.backgroundColor;

  const colorPopup = colorElement.closest('[id^="colorPopup"]');
  const numericPart = colorPopup.id.match(/\d+/)[0];

  const borderDiv = rightColumn.querySelector(`#menu2_1_border${numericPart}`);
  const backgroundDiv = rightColumn.querySelector(`#menu2_1_background${numericPart}`);

  if (borderDiv) {
    borderDiv.style.cssText = `text-align: center; align-items: center; display: flex; font-size: calc(0.5vw + 5pt); width: 100%; text-align: left; border: medium solid ${colorValue}; border-left-width: 0 !important; word-wrap: break-word;`;

  }
  if (backgroundDiv) {
    backgroundDiv.style.backgroundColor = colorValue;
  }

  colorPopup.style.display = 'none'; // Hide popup after selection
   if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
} // Call to save the template with the new color
}


// Reinitialize image selection buttons
imageSelectButtons.forEach(button => {
  button.addEventListener('click', function(event) {
    event.stopPropagation();
    const numericPart = this.id.match(/\d+/)[0];
    const targetImagePopupId = `imagePopup${numericPart}`;
    const imagePopup = document.getElementById(targetImagePopupId);

    document.querySelectorAll('.color-popup, .image-popup2, .color-popup2, .image-popup3, .color-popup3, .color-popup-section, .color-popup-title, .color-popup-accordion').forEach(popup => popup.style.display = 'none');

    document.querySelectorAll('.image-popup').forEach(popup => {
      if (popup.id !== targetImagePopupId) {
        popup.style.display = 'none';
      }
    });
    
    const imageElements = imagePopup.querySelectorAll('.popup-image');
    imageElements.forEach(imgElement => {
      imgElement.removeEventListener('click', handleImageSelection);
      imgElement.addEventListener('click', handleImageSelection);
    });
    imagePopup.style.display = imagePopup.style.display === 'none' ? 'flex' : 'none';
});
});

function handleImageSelection(event) {
  const imgElement = event.currentTarget;
  const numericPart = imgElement.id.match(/\d+/)[0];
  const imageToReplace = document.getElementById(`menu2_1_image${numericPart}`);

  if (imageToReplace) {
    imageToReplace.src = imgElement.src; // Assuming imgElement has the src attribute set to the image URL
    imageToReplace.id = `menu2_1_image${numericPart}`;
  }

  // Assuming imagePopup is within the scope or you retrieve it based on numericPart
  const imagePopup = document.getElementById(`imagePopup${numericPart}`);
  imagePopup.style.display = 'none'; // Hide popup after selection
   if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
}

colorSelectButtonsTwo.forEach(button => {
  button.addEventListener('click', function(event) {
    event.stopPropagation();
    const numericPartTwo = this.id.match(/\d+/)[0];
    const targetColorPopupIdTwo = `colorPopupTwo${numericPartTwo}`;
    const colorPopupTwo = document.getElementById(targetColorPopupIdTwo);

    // Close all image popups
    document.querySelectorAll('.image-popup, .image-popup2, .color-popup, .image-popup3, .color-popup3, .color-popup-section, .color-popup-title, .color-popup-accordion').forEach(popup => popup.style.display = 'none');

    // Close all other color popups except the current one
    document.querySelectorAll('.color-popup2').forEach(popup => {
      if (popup.id !== targetColorPopupIdTwo) {
        popup.style.display = 'none';
      }
    });

    const colorElements = colorPopupTwo.querySelectorAll('.colorElementTwo');
    colorElements.forEach(colorElement => {
      colorElement.removeEventListener('click', handleColorSelectionTwo);
      colorElement.addEventListener('click', handleColorSelectionTwo);
    });

    colorPopupTwo.style.display = colorPopupTwo.style.display === 'none' ? 'flex' : 'none';
  });
});

function handleColorSelectionTwo(event) {
  const colorElement = event.currentTarget;

  const colorValue = colorElement.style.backgroundColor;

  const colorPopup = colorElement.closest('[id^="colorPopupTwo"]');
  const numericPart = colorPopup.id.match(/\d+/)[0];

  const borderDiv = rightColumn.querySelector(`#menu2_2_border${numericPart}`);
  const backgroundDiv = rightColumn.querySelector(`#menu2_2_background${numericPart}`);

  if (borderDiv) {
    borderDiv.style.cssText = `text-align: center; align-items: center; display: flex; font-size: calc(0.5vw + 5pt); width: 100%; text-align: left; border: medium solid ${colorValue}; border-left-width: 0 !important; word-wrap: break-word;`;
  }
  if (backgroundDiv) {
    backgroundDiv.style.backgroundColor = colorValue;
  }

  colorPopup.style.display = 'none';
   if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
}

// Reinitialize image selection buttons
imageSelectButtonsTwo.forEach(button => {
  button.addEventListener('click', function(event) {
    event.stopPropagation();
    const numericPart = this.id.match(/\d+/)[0];
    const targetImagePopupId = `imagePopupTwo${numericPart}`;
    const imagePopup = document.getElementById(targetImagePopupId);

    document.querySelectorAll('.color-popup, .image-popup, .color-popup2, .image-popup3, .color-popup3, .color-popup-section, .color-popup-title, .color-popup-accordion').forEach(popup => popup.style.display = 'none');

    document.querySelectorAll('.image-popup2').forEach(popup => {
      if (popup.id !== targetImagePopupId) {
        popup.style.display = 'none';
      }
    });
    
    // Dynamically bind click event handlers to img elements within the popup
    const imageElements = imagePopup.querySelectorAll('.popup-image2');
    imageElements.forEach(imgElement => {
      imgElement.removeEventListener('click', handleImageSelectionTwo); 
      imgElement.addEventListener('click', handleImageSelectionTwo);
    });
    imagePopup.style.display = imagePopup.style.display === 'none' ? 'flex' : 'none';
});
});

// Define the handleImageSelection function
function handleImageSelectionTwo(event) {
  const imgElement = event.currentTarget;
  const numericPart = imgElement.id.match(/\d+/)[0];
  const imageToReplace = document.getElementById(`menu2_2_image${numericPart}`);

  if (imageToReplace) {
    imageToReplace.src = imgElement.src;
    imageToReplace.id = `menu2_2_image${numericPart}`;
  }

  const imagePopup = document.getElementById(`imagePopupTwo${numericPart}`);
  imagePopup.style.display = 'none';
   if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
}

colorSelectButtonsThree.forEach(button => {
  button.addEventListener('click', function(event) {
    event.stopPropagation();
    const numericPartThree = this.id.match(/\d+/)[0];
    const targetColorPopupIdThree = `colorPopupThree${numericPartThree}`;
    const colorPopupThree = document.getElementById(targetColorPopupIdThree);

    // Close all image popups
    document.querySelectorAll('.image-popup, .image-popup2, .image-popup3, .color-popup, .color-popup2, .color-popup-section, .color-popup-title, .color-popup-accordion').forEach(popup => popup.style.display = 'none');

    // Close all other color popups except the current one
    document.querySelectorAll('.color-popup3').forEach(popup => {
      if (popup.id !== targetColorPopupIdThree) {
        popup.style.display = 'none';
      }
    });

    const colorElements = colorPopupThree.querySelectorAll('.colorElementThree');
    colorElements.forEach(colorElement => {
      colorElement.removeEventListener('click', handleColorSelectionThree);
      colorElement.addEventListener('click', handleColorSelectionThree);
    });

    colorPopupThree.style.display = colorPopupThree.style.display === 'none' ? 'flex' : 'none';
  });
});

function handleColorSelectionThree(event) {
  const colorElement = event.currentTarget;

  const colorValue = colorElement.style.backgroundColor;

  const colorPopup = colorElement.closest('[id^="colorPopupThree"]');
  const numericPart = colorPopup.id.match(/\d+/)[0];

  const borderDiv = rightColumn.querySelector(`#menu2_3_border${numericPart}`);
  const backgroundDiv = rightColumn.querySelector(`#menu2_3_background${numericPart}`);

  if (borderDiv) {
    borderDiv.style.cssText = `text-align: center; align-items: center; display: flex; font-size: calc(0.5vw + 5pt); width: 100%; text-align: left; border: medium solid ${colorValue}; border-left-width: 0 !important; word-wrap: break-word;`;
  }
  if (backgroundDiv) {
    backgroundDiv.style.backgroundColor = colorValue;
  }

  colorPopup.style.display = 'none';
   if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
}

// Reinitialize image selection buttons
imageSelectButtonsThree.forEach(button => {
  button.addEventListener('click', function(event) {
    event.stopPropagation();
    const numericPart = this.id.match(/\d+/)[0];
    const targetImagePopupId = `imagePopupThree${numericPart}`;
    const imagePopup = document.getElementById(targetImagePopupId);

    document.querySelectorAll('.color-popup, .image-popup, .color-popup2, .image-popup2, .color-popup3, .color-popup-section, .color-popup-title, .color-popup-accordion').forEach(popup => popup.style.display = 'none');

    document.querySelectorAll('.image-popup3').forEach(popup => {
      if (popup.id !== targetImagePopupId) {
        popup.style.display = 'none';
      }
    });
    
    // Dynamically bind click event handlers to img elements within the popup
    const imageElements = imagePopup.querySelectorAll('.popup-image3');
    imageElements.forEach(imgElement => {
      imgElement.removeEventListener('click', handleImageSelectionThree); 
      imgElement.addEventListener('click', handleImageSelectionThree);
    });
    imagePopup.style.display = imagePopup.style.display === 'none' ? 'flex' : 'none';
});
});

// Define the handleImageSelection function
function handleImageSelectionThree(event) {
  const imgElement = event.currentTarget;
  const numericPart = imgElement.id.match(/\d+/)[0];
  const imageToReplace = document.getElementById(`menu2_3_image${numericPart}`);

  if (imageToReplace) {
    imageToReplace.src = imgElement.src;
    imageToReplace.id = `menu2_3_image${numericPart}`;
  }

  const imagePopup = document.getElementById(`imagePopupThree${numericPart}`);
  imagePopup.style.display = 'none';
   if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
}

colorSelectButtonsSection.forEach(button => {
  button.addEventListener('click', function(event) {
    event.stopPropagation();
    const numericPartSection = this.id.match(/\d+/)[0];
    const targetColorPopupIdSection = `colorPopupSection${numericPartSection}`;
    const colorPopupSection = document.getElementById(targetColorPopupIdSection);

    // Close all image popups
    document.querySelectorAll('.image-popup, .image-popup2, .image-popup3, .color-popup, .color-popup2, .color-popup3, .color-popup-title, .color-popup-accordion').forEach(popup => popup.style.display = 'none');

    // Close all other color popups except the current one
    document.querySelectorAll('.color-popup-section').forEach(popup => {
      if (popup.id !== targetColorPopupIdSection) {
        popup.style.display = 'none';
      }
    });

    const colorElements = colorPopupSection.querySelectorAll('.colorElementSection');
    colorElements.forEach(colorElement => {
      colorElement.removeEventListener('click', handleColorSelectionSection);
      colorElement.addEventListener('click', handleColorSelectionSection);
    });

    colorPopupSection.style.display = colorPopupSection.style.display === 'none' ? 'flex' : 'none';
  });
});

function handleColorSelectionSection(event) {
  const colorElement = event.currentTarget;

  const colorValue = colorElement.style.backgroundColor;

  const colorPopup = colorElement.closest('[id^="colorPopupSection"]');
  const numericPart = colorPopup.id.match(/\d+/)[0];

  const backgroundDiv = document.getElementById(`shape${numericPart}`);

  if (backgroundDiv) {
    backgroundDiv.style.backgroundColor = colorValue;
  }

  colorPopup.style.display = 'none';
   if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
}






colorSelectButtonsTitle.forEach(button => {
  button.addEventListener('click', function(event) {
    event.stopPropagation();
    const numericPartTitle = this.id.match(/\d+/)[0];
    const targetColorPopupIdTitle = `colorPopupTitle${numericPartTitle}`;
    const colorPopupTitle = document.getElementById(targetColorPopupIdTitle);

    // Close all image popups
    document.querySelectorAll('.image-popup, .image-popup2, .image-popup3, .color-popup, .color-popup2, .color-popup3, .color-popup-section, .color-popup-accordion').forEach(popup => popup.style.display = 'none');

    // Close all other color popups except the current one
    document.querySelectorAll('.color-popup-title').forEach(popup => {
      if (popup.id !== targetColorPopupIdTitle) {
        popup.style.display = 'none';
      }
    });

    const colorElements = colorPopupTitle.querySelectorAll('.colorElementTitle');
    colorElements.forEach(colorElement => {
      colorElement.removeEventListener('click', handleColorSelectionTitle);
      colorElement.addEventListener('click', handleColorSelectionTitle);
    });

    colorPopupTitle.style.display = colorPopupTitle.style.display === 'none' ? 'flex' : 'none';
  });
});

function handleColorSelectionTitle(event) {
  const colorElement = event.currentTarget;

  const colorValue = colorElement.style.backgroundColor;

  const colorPopup = colorElement.closest('[id^="colorPopupTitle"]');
  const numericPart = colorPopup.id.match(/\d+/)[0];

  const backgroundDiv = document.getElementById(`shape${numericPart}`);

  if (backgroundDiv) {
    backgroundDiv.style.backgroundColor = colorValue;
  }

  colorPopup.style.display = 'none';
   if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
}




colorSelectButtonsAccordion.forEach(button => {
  button.addEventListener('click', function(event) {
    event.stopPropagation();
    const numericPartAccordion = this.id.match(/\d+/)[0];
    const targetColorPopupIdAccordion = `colorPopupAccordion${numericPartAccordion}`;
    const colorPopupAccordion = document.getElementById(targetColorPopupIdAccordion);

    // Close all image popups
    document.querySelectorAll('.image-popup, .image-popup2, .image-popup3, .color-popup, .color-popup2, .color-popup3, .color-popup-section, .color-popup-title').forEach(popup => popup.style.display = 'none');

    // Close all other color popups except the current one
    document.querySelectorAll('.color-popup-accordion').forEach(popup => {
      if (popup.id !== targetColorPopupIdAccordion) {
        popup.style.display = 'none';
      }
    });

    const colorElements = colorPopupAccordion.querySelectorAll('.colorElementAccordion');
    colorElements.forEach(colorElement => {
      colorElement.removeEventListener('click', handleColorSelectionAccordion);
      colorElement.addEventListener('click', handleColorSelectionAccordion);
    });

    colorPopupAccordion.style.display = colorPopupAccordion.style.display === 'none' ? 'flex' : 'none';
  });
});

function handleColorSelectionAccordion(event) {
  const colorElement = event.currentTarget;

  const colorValue = colorElement.style.backgroundColor;

  const colorPopup = colorElement.closest('[id^="colorPopupAccordion"]');
  const numericPart = colorPopup.id.match(/\d+/)[0];

  const backgroundDiv = document.getElementById(`shape${numericPart}`);

  if (backgroundDiv) {
    backgroundDiv.style.backgroundColor = colorValue;
  }

  colorPopup.style.display = 'none';
   if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
}

colorSelectButtonCardfront.forEach(button => {
  button.addEventListener('click', function(event) {
    event.stopPropagation();
    const numericPartCardfront = this.id.match(/\d+/)[0];
    const targetColorPopupIdCardfront = `colorPopupCardfront${numericPartCardfront}`;
    const colorPopupCardfront = document.getElementById(targetColorPopupIdCardfront);

    // Close all image popups
    document.querySelectorAll('.image-popup, .image-popup2, .image-popup3, .color-popup, .color-popup2, .color-popup3, .color-popup-section, .color-popup-title, .color-popup-accordion').forEach(popup => popup.style.display = 'none');

    // Close all other color popups except the current one
    document.querySelectorAll('.color-popup-cardfront').forEach(popup => {
      if (popup.id !== targetColorPopupIdCardfront) {
        popup.style.display = 'none';
      }
    });

    const colorElements = colorPopupCardfront.querySelectorAll('.colorElementCardfront');
    colorElements.forEach(colorElement => {
      colorElement.removeEventListener('click', handleColorSelectionCardfront);
      colorElement.addEventListener('click', handleColorSelectionCardfront);
    });

    colorPopupCardfront.style.display = colorPopupCardfront.style.display === 'none' ? 'flex' : 'none';
  });
});

function handleColorSelectionCardfront(event) {
  
  
  const colorElement = event.currentTarget;

  const colorValue = colorElement.style.backgroundColor;

  const colorPopup = colorElement.closest('[id^="colorPopupCardfront"]');
  const numericPart = colorPopup.id.match(/\d+/)[0];

  document.querySelectorAll('.flashcard-front').forEach(backgroundDiv => {
    backgroundDiv.style.borderColor = colorValue;
    });

  colorPopup.style.display = 'none';
   if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
}

colorSelectButtonCardback.forEach(button => {
  button.addEventListener('click', function(event) {
    event.stopPropagation();
    const numericPartCardback = this.id.match(/\d+/)[0];
    const targetColorPopupIdCardback = `colorPopupCardback${numericPartCardback}`;
    const colorPopupCardback = document.getElementById(targetColorPopupIdCardback);

    // Close all image popups
    document.querySelectorAll('.image-popup, .image-popup2, .image-popup3, .color-popup, .color-popup2, .color-popup3, .color-popup-section, .color-popup-title, .color-popup-accordion').forEach(popup => popup.style.display = 'none');

    // Close all other color popups except the current one
    document.querySelectorAll('.color-popup-cardback').forEach(popup => {
      if (popup.id !== targetColorPopupIdCardback) {
        popup.style.display = 'none';
      }
    });

    const colorElements = colorPopupCardback.querySelectorAll('.colorElementCardback');
    colorElements.forEach(colorElement => {
      colorElement.removeEventListener('click', handleColorSelectionCardback);
      colorElement.addEventListener('click', handleColorSelectionCardback);
    });

    colorPopupCardback.style.display = colorPopupCardback.style.display === 'none' ? 'flex' : 'none';
  });
});

function handleColorSelectionCardback(event) {
  
  
  const colorElement = event.currentTarget;

  const colorValue = colorElement.style.backgroundColor;

  const colorPopup = colorElement.closest('[id^="colorPopupCardback"]');
  const numericPart = colorPopup.id.match(/\d+/)[0];

  document.querySelectorAll('.flashcard-back').forEach(backgroundDiv => {
    backgroundDiv.style.borderColor = colorValue;
    });

  colorPopup.style.display = 'none';
   if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
}


// Add the document click listener to close popups if clicking outside
document.addEventListener('click', function(event) {

    const allColorPopups = document.querySelectorAll('.color-popup');
    allColorPopups.forEach(popup => {
      if (!popup.contains(event.target)) {
        popup.style.display = 'none';
      }
    });

    const allImagePopups = document.querySelectorAll('.image-popup'); // If you have image popups
    allImagePopups.forEach(popup => {
      if (!popup.contains(event.target)) {
        popup.style.display = 'none';
      }
    });

    const allColorPopupsTwo = document.querySelectorAll('.color-popup2');
    allColorPopupsTwo.forEach(popup => {
      if (!popup.contains(event.target)) {
        popup.style.display = 'none';
      }
    });

    const allImagePopupsTwo = document.querySelectorAll('.image-popup2'); // If you have image popups
    allImagePopupsTwo.forEach(popup => {
      if (!popup.contains(event.target)) {
        popup.style.display = 'none';
      }
    });

    const allColorPopupsThree = document.querySelectorAll('.color-popup3');
    allColorPopupsThree.forEach(popup => {
      if (!popup.contains(event.target)) {
        popup.style.display = 'none';
      }
    });

    const allImagePopupsThree = document.querySelectorAll('.image-popup3'); // If you have image popups
    allImagePopupsThree.forEach(popup => {
      if (!popup.contains(event.target)) {
        popup.style.display = 'none';
      }
    });

    const allColorPopupsSection = document.querySelectorAll('.color-popup-section');
  allColorPopupsSection.forEach(popup => {
      if (!popup.contains(event.target)) {
        popup.style.display = 'none';
      }
    });

    const allColorPopupsTitle = document.querySelectorAll('.color-popup-title');
    allColorPopupsTitle.forEach(popup => {
      if (!popup.contains(event.target)) {
        popup.style.display = 'none';
      }
    });

    const allColorPopupsAccordion = document.querySelectorAll('.color-popup-accordion');
    allColorPopupsAccordion.forEach(popup => {
      if (!popup.contains(event.target)) {
        popup.style.display = 'none';
      }
    });

    const allColorPopupsCardfront = document.querySelectorAll('.color-popup-cardfront');
    allColorPopupsCardfront.forEach(popup => {
      if (!popup.contains(event.target)) {
        popup.style.display = 'none';
      }
    });

    const allColorPopupsCardback = document.querySelectorAll('.color-popup-cardback');
    allColorPopupsCardback.forEach(popup => {
      if (!popup.contains(event.target)) {
        popup.style.display = 'none';
      }
    });
  });
}

// Helper function to update the content in Firestore
async function updateTemplateContent(contentId, contentValue) {
  if (auth.currentUser && currentTemplateId) {
    const templateDocRef = doc(db, "users", auth.currentUser.uid, "templates", currentTemplateId);
    let updates = {};
    updates[contentId] = contentValue;

    try {
      await updateDoc(templateDocRef, updates);
      console.log("Content updated");
    } catch (error) {
      console.error("Error updating content: ", error);
    }
  }
}

onAuthStateChanged(auth, async (user) => {
  if (user) {
    document.getElementById('logout').style.display = 'block';
    await fetchAndDisplayTemplates(); // Fetch and display existing templates
    await loadMostRecentTemplate(); // Load the most recent template
  } else {
    document.getElementById('logout').style.display = 'none';
    // Handle the case when the user is not logged in
  }
});

// Logout code
document.getElementById("logout").addEventListener("click", function() {
  alertify.confirm('Logout', 'Are you sure you want to logout?', 
    function() { // User clicked "OK"
      signOut(auth).then(() => {
        alertify.alert('Logout', 'Sign-out successful.', function(){
          document.getElementById('logout').style.display = 'none';
          alertify.success('You have been logged out.');
          redirectToLogin(); // Redirect to login page
        });
      }).catch((error) => {
        alertify.error('An error happened during sign-out.');
        console.log('An error happened:', error);
      });
    }, 
    function() { // User clicked "Cancel"
    });
});


  
let hasChanges = false;
  console.log('hasChanges set to FALSE');
  // Set up the interval to call saveTemplate every 1 minute
  setInterval(() => {
  if (hasChanges) {
    saveTemplate();
    console.log('Saved automatically after 1 minute since last change');
    hasChanges = false;
    console.log('hasChanges is set to FALSE by setInterval');
    
         // Function to update the status div TO SAVED
function updateSaveStatusToYes() {
    const statusDiv = document.getElementById("saveReport");
    statusDiv.innerHTML = '<span id="cloudDone" class="material-symbols-sharp" style="font-size: 1.2vw; padding-top: 0.1vw;">cloud_done</span>';    
}
updateSaveStatusToYes();
  }
}, 300000);

// Function to update the status div TO NOT SAVED
function updateSaveStatusToNo() {
    const statusDiv = document.getElementById("saveReport");
    statusDiv.innerHTML = '<span id="cloudSync" class="material-symbols-sharp" style="font-size: 1.2vw; padding-top: 0.1vw;">cloud_sync</span>';    
}


document.getElementById("storageGeneral").addEventListener("click", function() {
            var contentDiv = document.getElementById("file-storage-content");
            if (contentDiv.style.display === "block") {
                contentDiv.style.display = "none";
                const strVideos = document.getElementById('strVideos');
                const strAudios = document.getElementById('strAudios');
                const strImages = document.getElementById('strImages');
                strVideos.innerHTML = '';
                strAudios.innerHTML = '';
                strImages.innerHTML = '';
            } else {
              listAndSelectFiles();
                contentDiv.style.display = "block";
            }
        });

document.getElementById("file-close-storage").addEventListener("click", function() {
            document.getElementById("file-storage-content").style.display = "none";
            const strVideos = document.getElementById('strVideos');
                const strAudios = document.getElementById('strAudios');
                const strImages = document.getElementById('strImages');
                strVideos.innerHTML = '';
                strAudios.innerHTML = '';
                strImages.innerHTML = '';
        });


document.addEventListener("DOMContentLoaded", function() {

  var saveButton = document.getElementById("button-save");
  saveButton.addEventListener("click", function() {
    saveTemplate();
     console.log('Saved with SAVE button');
     hasChanges = false;
     console.log('hasChanges is set to FALSE by manual save button');
     
     // Function to update the status div TO SAVED
function updateSaveStatusToYes() {
    const statusDiv = document.getElementById("saveReport");
    statusDiv.innerHTML = '<span id="cloudDone" class="material-symbols-sharp" style="font-size: 1.2vw; padding-top: 0.1vw;">cloud_done</span>';    
}
updateSaveStatusToYes();

  });

  document.getElementById("copyTemplate").addEventListener("click", async function () {
    const rightColumn = document.getElementById("right-column");
    
    rightColumn.querySelectorAll('.quizLabel').forEach((label) => {
        label.style.color = '#333333';
    });

    let htmlContent = rightColumn.innerHTML;


    const flashcardStacks = rightColumn.querySelectorAll('.flashcardStack');
    const response = await fetch('https://grahamandsergei.github.io/app/flashcardServer.html');
    let masterHTML = await response.text(); // Get the master HTML template   
    
    for (let div of flashcardStacks) {
        const divId = div.id;
        let divContent = div.outerHTML;
        const userFolderPath = `users/${auth.currentUser.uid}/embeds/${divId}`;

        // Parse divContent as a new HTML document
        const parser = new DOMParser();
        const divDoc = parser.parseFromString(divContent, "text/html");

        // Remove the 'flipped' class from all divs within divContent
        const flippedDivs = divDoc.querySelectorAll('.flipped');
        flippedDivs.forEach((el) => {
            el.classList.remove('flipped');
        });

        // Serialize the modified content back to a string
        divContent = divDoc.body.innerHTML;

        // Parse the master HTML template
        const doc = parser.parseFromString(masterHTML, "text/html");

        // Find the right column and replace its content
        const rightColumnElement = doc.getElementById('right-column');
        if (rightColumnElement) {
            rightColumnElement.innerHTML = divContent; // Set the innerHTML to modified divContent
            let modifiedHTML = doc.documentElement.outerHTML; // Serialize the document back to HTML

            // Manually add DOCTYPE and fix self-closing tags
            modifiedHTML = '<!DOCTYPE html>' + modifiedHTML;
            modifiedHTML = modifiedHTML.replace(/<link(.*?)\/?>/g, '<link$1/>');

            // Convert the modified HTML to a blob
            const blob = new Blob([modifiedHTML], {type: 'text/html'});

            // Firebase Storage v9+ usage
            const storage = getStorage();
            const storageReference = storageRef(storage, userFolderPath);

            try {
                await uploadBytes(storageReference, blob);
                const fileUrl = await getDownloadURL(storageReference);

                // Replace original div in htmlContent with an iframe
                htmlContent = htmlContent.replace(div.outerHTML, `<div style="position: relative; width: 100%; padding-top: 35%;"><iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;" src="${fileUrl}"></iframe></div>`);
            } catch (error) {
                console.error("Error uploading modified HTML content:", error);
                alert("Failed to upload modified HTML content. See console for details.");
                return;
            }
        }
    }



    const quizStacks = rightColumn.querySelectorAll('.quizClass');
    const responseQuiz = await fetch('https://grahamandsergei.github.io/app/quizServer.html');
    let masterQuizHTML = await responseQuiz.text(); // Get the master HTML template

    for (let div of quizStacks) {
        const divId = div.id;
        let divContent = div.outerHTML;
        const userFolderPath = `users/${auth.currentUser.uid}/embeds/${divId}`;

        // Parse divContent as a new HTML document
        const parser = new DOMParser();
        const divDoc = parser.parseFromString(divContent, "text/html");

        // Serialize the modified content back to a string
        divContent = divDoc.body.innerHTML;

        // Parse the master HTML template
        const doc = parser.parseFromString(masterQuizHTML, "text/html");

        // Find the right column and replace its content
        const rightColumnElement = doc.getElementById('right-column');
        if (rightColumnElement) {
            rightColumnElement.innerHTML = divContent; // Set the innerHTML to modified divContent
            let modifiedHTML = doc.documentElement.outerHTML; // Serialize the document back to HTML

            // Manually add DOCTYPE and fix self-closing tags
            modifiedHTML = '<!DOCTYPE html>' + modifiedHTML;
            modifiedHTML = modifiedHTML.replace(/<link(.*?)\/?>/g, '<link$1/>');

            // Convert the modified HTML to a blob
            const blob = new Blob([modifiedHTML], {type: 'text/html'});

            // Firebase Storage v9+ usage
            const storage = getStorage();
            const storageReference = storageRef(storage, userFolderPath);

            try {
                await uploadBytes(storageReference, blob);
                const fileUrl = await getDownloadURL(storageReference);

                // Replace original div in htmlContent with an iframe
                htmlContent = htmlContent.replace(div.outerHTML, `<div style="position: relative; width: 100%; padding-top: 35%;"><iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;" src="${fileUrl}"></iframe></div>`);
            } catch (error) {
                console.error("Error uploading modified HTML content:", error);
                alert("Failed to upload modified HTML content. See console for details.");
                return;
            }
        }
    }



    // Copy the modified htmlContent to clipboard
    const textarea = document.createElement("textarea");
    textarea.value = htmlContent;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand("copy");
    document.body.removeChild(textarea);

    var editorIcon = '&lt; / &gt;';
var content = `<img src="https://firebasestorage.googleapis.com/v0/b/authentication-app-21e51.appspot.com/o/assets%2FdestinationLoop.gif?alt=media&token=c3174b31-7491-49da-af18-a40b576a16fehttps://firebasestorage.googleapis.com/v0/b/authentication-app-21e51.appspot.com/o/assets%2FarrowSave.gif?alt=media&token=db2f270c-3ef7-45be-ad6e-ac3cb4dd807b" style="width: 100%; display:block; margin:0 auto 2vw auto;"/>
<p style="font-size: 1.5vw; color: #0d82ca; text-align: center;">Open a Canvas page and paste the result into the ${editorIcon} editor.</p>`;

        // Trigger AlertifyJS alert with customized content
        alertify.alert('Success!', content);
});





		
			// Define clearTemplate function outside of setupTemplateButtons since it's no longer needed
const clearTemplate = async () => {
  saveTemplate();
  console.log('Previous template saved before adding a new page');
  hasChanges = false;
    console.log('hasChanges is set to FALSE by clearTemplate function');

        
     // Function to update the status div TO SAVED
function updateSaveStatusToYes() {
    const statusDiv = document.getElementById("saveReport");
    statusDiv.innerHTML = '<span id="cloudDone" class="material-symbols-sharp" style="font-size: 1.2vw; padding-top: 0.1vw;">cloud_done</span>';    
}
updateSaveStatusToYes();

  
// Add welcome messages
  const welcomeMessageLeft = '<div id="welcomeMessageLeft" class="welcome-message1">ADD TOOLS FROM THE BLUE COLUMN</div>';
  const welcomeMessageRight = '<div id="welcomeMessageRight" class="welcome-message2">SEE RESULT HERE</div>';

  document.getElementById("left-column").innerHTML = welcomeMessageLeft;
  document.getElementById("right-column").innerHTML = welcomeMessageRight;

  // Reset the style of all template buttons
  const templateButtons = document.querySelectorAll('.template-button');
  templateButtons.forEach(button => {
      button.classList.remove('selected-template-button');
  });

  // Create new page
  const newTemplateId = generateTemplateId();
  currentTemplateId = newTemplateId;

  // Default template name
  const defaultTemplateName = "New Page";

  // Save the new page with the default name
  await saveTemplate(defaultTemplateName);

  // Append the new page item with the default name
  appendNewTemplateItem(newTemplateId, defaultTemplateName);

  // Apply selected style to the new page button
  const newTemplateButton = document.querySelector(`[data-template-id="${newTemplateId}"]`);
  if (newTemplateButton) {
      newTemplateButton.classList.add('selected-template-button');
  }

  // Load the new page
  loadTemplate(newTemplateId); 
};
	
    const newTemplateButton = document.getElementById("newTemplateButton");
	newTemplateButton.addEventListener('click', clearTemplate);
	
            const rightColumn = document.getElementById("right-column");
            let uniqueIdCounter = Math.floor(Math.random() * 1000000000); 
			let codeCounter1 = Math.floor(Math.random() * 100000000000);
			let codeCounter2 = Math.floor(Math.random() * 100000000000);
			let codeCounter3 = Math.floor(Math.random() * 100000000000);




window.handleVideoUpload = async function(event, videoPlaceholder, uploadButtonContainer) {
  const fileInput = event.target;
    const file = fileInput.files[0];
    if (!file) return;

    // Define the allowed MIME types for videos
    const allowedVideoTypes = ['video/mp4', 'video/webm', 'video/ogg'];

    // Check if the file's MIME type is allowed
    if (!allowedVideoTypes.includes(file.type)) {
        alert('This file type is not supported for videos.');
        resetFileInput(fileInput); // Reset the file input
        return;
    }

    // Define the maximum file size for videos (e.g., 100MB)
    const maxFileSize = 100 * 1024 * 1024; // 100 Megabytes

    // Check if the file size exceeds the maximum
    if (file.size > maxFileSize) {
        alert('The video is too large. Please upload a video smaller than 100MB.');
        resetFileInput(fileInput); // Reset the file input
        return;
    }

       // Get total size of all files uploaded by the user
    const userId = auth.currentUser.uid;
    const totalSizeLimit = await getTotalSizeOfUserFiles(userId);
    const maxTotalSize = 300 * 1024 * 1024; // 10 GB

    // Check if the new file exceeds the total size limit
    if (totalSizeLimit + file.size > maxTotalSize) {
        alert('You have exceeded your total upload limit of 300MB available in the trial.');
        resetFileInput(fileInput); // Reset the file input
        return; // Exit the function if the total size exceeds the limit
    }

    // Temp animation
    if (videoPlaceholder) {
        videoPlaceholder.innerHTML = "";
        const animation = document.createElement("div")
        animation.innerHTML = '<div class="tempLoadingAnimation"><div class="circles"><div class="circleColorOne"></div><div class="circleColorTwo"></div><div class="circleColorOne"></div><div class="circleColorTwo"></div></div></div>';
        videoPlaceholder.appendChild(animation);
    }

    // Generate a human-readable timestamp
    const now = new Date();
    const formattedTimestamp = `${now.getDate()}-${now.getMonth()+1}-${now.getFullYear()}-${now.getHours()}-${now.getMinutes()}-${now.getSeconds()}`;

    // Extract the file extension
    const fileExtension = file.name.split('.').pop();
    const fileNameWithoutExtension = file.name.replace(`.${fileExtension}`, '');

    // Generate a unique file name
    const uniqueFileName = `${fileNameWithoutExtension}-${formattedTimestamp}.${fileExtension}`;

    // Include the user's UID in the file path
    const userFolderPath = `users/${auth.currentUser.uid}/videos/${uniqueFileName}`;

    // Use the modular syntax for Firebase Storage
    const storage = getStorage();
    const storageReference = storageRef(storage, userFolderPath);

    try {
        const snapshot = await uploadBytes(storageReference, file);
        const url = await getDownloadURL(snapshot.ref);

        // Here, replace the iframe src with the uploaded video URL
        if (videoPlaceholder) {
            videoPlaceholder.innerHTML = `<p style="text-align: center;"><video style="min-width: 50%; max-width: 60%; display: inline-block;" title="Video player" controls="controls"><source src="${url}"></video></p>`;
        }

        let fileNameDisplay = uploadButtonContainer.querySelector('.file-name-display-video');
        if (!fileNameDisplay) {
            fileNameDisplay = document.createElement("div");
            fileNameDisplay.className = 'file-name-display-video';
            uploadButtonContainer.appendChild(fileNameDisplay);
        }
        fileNameDisplay.style.marginTop = "5px";
        fileNameDisplay.style.marginBottom = "0px";
        fileNameDisplay.style.fontSize = "10px";
        fileNameDisplay.style.color = "#171b70";
        fileNameDisplay.textContent = `UPLOADED VIDEO: ${file.name}`;

        updateTemplateContent(auth.currentUser.uid, `shape${uniqueIdCounter}.firstPlaceholder`, url);
        saveTemplate();
        hasChanges = false;
             // Function to update the status div TO SAVED
function updateSaveStatusToYes() {
    const statusDiv = document.getElementById("saveReport");
    statusDiv.innerHTML = '<span id="cloudDone" class="material-symbols-sharp" style="font-size: 1.2vw; padding-top: 0.1vw;">cloud_done</span>';    
}
updateSaveStatusToYes();

        // Update the storage usage display
        await updateStorageUsage(auth.currentUser.uid);

    } catch (error) {
        console.error("Error uploading video:", error);
    } finally {
        resetFileInput(fileInput); // Reset the file input to allow re-uploading the same file
    }
};

// Function to reset the file input element
function resetFileInput(fileInput) {
    const form = fileInput.closest('form');
    if (form) {
        form.reset();
    } else {
        fileInput.value = '';
    }
};


// Define listAndSelectVideos outside of the conditional block
window.listAndSelectVideos = async function(videoPlaceholder, uploadButtonContainer) {
    const storage = getStorage();
    const storageReference = storageRef(storage, `users/${auth.currentUser.uid}/videos/`);
    const storageDiv = document.getElementById('video-storage-content');

    const otherStorageDivs = document.querySelectorAll('.image-storage-content, .audio-storage-content, .file-storage-content');
            otherStorageDivs.forEach(div => {
              div.style.display = 'none';
            });

    try {
        // List all items (files) in the user's video folder
        const listResult = await listAll(storageReference);

        // Clear the storageDiv before appending the new list
        storageDiv.innerHTML = '<span class="video-close-storage" id="video-close-storage">&times;</span><div id="storageFiles" style="font-size: 2vw; font-family: Arial; color: white; margin-bottom: 3vw;">Storage Videos</div>';

        // Display the list of video files
        listResult.items.forEach((itemRef) => {
            const fileName = itemRef.name;

            // Create a container for the icon and file name
            const fileItemContainer = document.createElement('div');
            fileItemContainer.className = 'video-file-item-container';
            fileItemContainer.style.display = 'flex';
            fileItemContainer.style.alignItems = 'center';

            // Create and add the video icon
            const videoIcon = document.createElement('div');
            videoIcon.innerHTML = '<span id="storageFiles" class="material-symbols-sharp" style="font-size: 1vw;">videocam</span>';
            videoIcon.style.marginRight = '8px';
            videoIcon.style.display = 'flex';
            videoIcon.style.alignItems = 'center';
            fileItemContainer.appendChild(videoIcon);

            // Create and add the file name
            const fileItem = document.createElement('div');
            fileItem.textContent = fileName;
            fileItem.className = 'video-file-item';
            fileItemContainer.appendChild(fileItem);

            // Add a click event listener to handle video selection
            fileItemContainer.addEventListener('click', async () => {
                // Hide the video-storage-content div first
                storageDiv.style.display = 'none';

                try {
                    const url = await getDownloadURL(itemRef);

                    // Replace the iframe src with the selected video URL
                    if (videoPlaceholder) {
                        videoPlaceholder.innerHTML = `<p style="text-align: center;"><video style="min-width: 50%; max-width: 60%; display: inline-block;" title="Video player" controls="controls"><source src="${url}"></video></p>`;
                    }

                    let fileNameDisplay = uploadButtonContainer.querySelector('.file-name-display-video');
                    if (!fileNameDisplay) {
                        fileNameDisplay = document.createElement("div");
                        fileNameDisplay.className = 'file-name-display-video';
                        uploadButtonContainer.appendChild(fileNameDisplay);
                    }
                    fileNameDisplay.style.marginTop = "5px";
                    fileNameDisplay.style.marginBottom = "0px";
                    fileNameDisplay.style.fontSize = "10px";
                    fileNameDisplay.style.color = "#171b70";
                    fileNameDisplay.textContent = `SELECTED VIDEO: ${fileName}`;

                    updateTemplateContent(auth.currentUser.uid, `shape${uniqueIdCounter}.firstPlaceholder`, url);
                    saveTemplate();
                    hasChanges = false;

                    // Function to update the status div TO SAVED
                    function updateSaveStatusToYes() {
                        const statusDiv = document.getElementById("saveReport");
                        statusDiv.innerHTML = '<span id="cloudDone" class="material-symbols-sharp" style="font-size: 1.2vw; padding-top: 0.1vw;">cloud_done</span>';
                    }
                    updateSaveStatusToYes();

                    // Update the storage usage display
                    await updateStorageUsage(auth.currentUser.uid);
                } catch (error) {
                    console.error("Error getting video URL:", error);
                }
            });

            // Append the file item container to the storage div
            storageDiv.appendChild(fileItemContainer);
        });

        // Attach the close event to the newly created close button
        document.getElementById('video-close-storage').onclick = function() {
            storageDiv.style.display = 'none';
        };
    } catch (error) {
        console.error("Error listing videos:", error);
    } 
};

// New function to handle audio uploads
window.handleAudioUpload = async function(event, audioPlaceholder, uploadButtonContainer) {
  const fileInput = event.target;
    const file = fileInput.files[0];
    if (!file) return;

    // Define the allowed MIME types for audios
    const allowedAudioTypes = ['audio/mpeg'];

    // Check if the file's MIME type is allowed
    if (!allowedAudioTypes.includes(file.type)) {
        alert('This file type is not supported for audios.');
        resetFileInput(fileInput); // Reset the file input
        return;
    }

    // Define the maximum file size for audios (e.g., 100MB)
    const maxFileSize = 100 * 1024 * 1024; // 100 Megabytes

    // Check if the file size exceeds the maximum
    if (file.size > maxFileSize) {
        alert('The audio is too large. Please upload an audio smaller than 100MB.');
        resetFileInput(fileInput); // Reset the file input
        return;
    }


       // Get total size of all files uploaded by the user
       const userId = auth.currentUser.uid;
    const totalSizeLimit = await getTotalSizeOfUserFiles(userId);
    const maxTotalSize = 10000 * 1024 * 1024; // 10 GB

    // Check if the new file exceeds the total size limit
    if (totalSizeLimit + file.size > maxTotalSize) {
        alert('You have exceeded your total upload limit of 10GB.');
        resetFileInput(fileInput); // Reset the file input
        return; // Exit the function if the total size exceeds the limit
    }

        // Temp animation
        if (audioPlaceholder) {
          audioPlaceholder.innerHTML = "";
          const animation = document.createElement("div")
          animation.innerHTML = '<div class="tempLoadingAnimation"><div class="circles"><div class="circleColorOne"></div><div class="circleColorTwo"></div><div class="circleColorOne"></div><div class="circleColorTwo"></div></div></div>';
          audioPlaceholder.appendChild(animation);
        }

    // Generate a human-readable timestamp
    const now = new Date();
    const formattedTimestamp = `${now.getDate()}-${now.getMonth()+1}-${now.getFullYear()}-${now.getHours()}-${now.getMinutes()}-${now.getSeconds()}`;

    // Extract the file extension
    const fileExtension = file.name.split('.').pop();
    const fileNameWithoutExtension = file.name.replace(`.${fileExtension}`, '');

    // Generate a unique file name
    const uniqueFileName = `${fileNameWithoutExtension}-${formattedTimestamp}.${fileExtension}`;

    // Include the user's UID in the file path
    const userFolderPath = `users/${auth.currentUser.uid}/audios/${uniqueFileName}`;

    // Use the modular syntax for Firebase Storage
    const storage = getStorage();
    const storageReference = storageRef(storage, userFolderPath);

    try {
        const snapshot = await uploadBytes(storageReference, file);
        const url = await getDownloadURL(snapshot.ref);

        // Here, replace the iframe src with the uploaded audio URL
        if (audioPlaceholder) {
          audioPlaceholder.innerHTML = `<p style="text-align: center;"><audio style="min-width: 60%; max-width: 80%; max-height: 5vh; display: inline-block;" title="Audio player" controls="controls"><source src="${url}"></audio></p>`;
        }

        let fileNameDisplay = uploadButtonContainer.querySelector('.file-name-display-audio');
        if (!fileNameDisplay) {
            fileNameDisplay = document.createElement("div");
            fileNameDisplay.className = 'file-name-display-audio';
            uploadButtonContainer.appendChild(fileNameDisplay);
        }
        fileNameDisplay.style.marginTop = "5px";
        fileNameDisplay.style.marginBottom = "0px";
        fileNameDisplay.style.fontSize = "10px";
        fileNameDisplay.style.color = "#171b70";
        fileNameDisplay.textContent = `UPLOADED AUDIO: ${file.name}`;

        updateTemplateContent(auth.currentUser.uid, `shape${uniqueIdCounter}.firstPlaceholder`, url);
        saveTemplate();
        hasChanges = false;
             // Function to update the status div TO SAVED
function updateSaveStatusToYes() {
    const statusDiv = document.getElementById("saveReport");
    statusDiv.innerHTML = '<span id="cloudDone" class="material-symbols-sharp" style="font-size: 1.2vw; padding-top: 0.1vw;">cloud_done</span>';    
}
updateSaveStatusToYes();

        // Update the storage usage display
        await updateStorageUsage(auth.currentUser.uid);

    } catch (error) {
        console.error("Error uploading audio:", error);
    } finally {
        resetFileInput(fileInput); // Reset the file input to allow re-uploading the same file
    }
};

// Function to reset the file input element
function resetFileInput(fileInput) {
    const form = fileInput.closest('form');
    if (form) {
        form.reset();
    } else {
        fileInput.value = '';
    }
};


// Define listAndSelectAudios outside of the conditional block
window.listAndSelectAudios = async function(audioPlaceholder, uploadButtonContainer) {
    const storage = getStorage();
    const storageReference = storageRef(storage, `users/${auth.currentUser.uid}/audios/`);
    const storageDiv = document.getElementById('audio-storage-content');

    const otherStorageDivs = document.querySelectorAll('.video-storage-content, .image-storage-content, .file-storage-content');
            otherStorageDivs.forEach(div => {
              div.style.display = 'none';
            });

    try {
        // List all items (files) in the user's audio folder
        const listResult = await listAll(storageReference);

        // Clear the storageDiv before appending the new list
        storageDiv.innerHTML = '<span class="audio-close-storage" id="audio-close-storage">&times;</span><div id="storageFiles" style="font-size: 2vw; font-family: Arial; color: white; margin-bottom: 3vw;">Storage Audios</div>';

        // Display the list of audio files
        listResult.items.forEach((itemRef) => {
            const fileName = itemRef.name;

            // Create a container for the icon and file name
            const fileItemContainer = document.createElement('div');
            fileItemContainer.className = 'audio-file-item-container';
            fileItemContainer.style.display = 'flex';
            fileItemContainer.style.alignItems = 'center';

            // Create and add the audio icon
            const audioIcon = document.createElement('div');
            audioIcon.innerHTML = '<span id="storageFiles" class="material-symbols-sharp" style="font-size: 1vw;"> music_note </span>';
            audioIcon.style.marginRight = '8px';
            audioIcon.style.display = 'flex';
            audioIcon.style.alignItems = 'center';
            fileItemContainer.appendChild(audioIcon);

            // Create and add the file name
            const fileItem = document.createElement('div');
            fileItem.textContent = fileName;
            fileItem.className = 'audio-file-item';
            fileItemContainer.appendChild(fileItem);

            // Add a click event listener to handle audio selection
            fileItemContainer.addEventListener('click', async () => {
                // Hide the audio-storage-content div first
                storageDiv.style.display = 'none';

                try {
                    const url = await getDownloadURL(itemRef);

                    // Replace the iframe src with the selected audio URL
                    if (audioPlaceholder) {
                      audioPlaceholder.innerHTML = `<p style="text-align: center;"><audio style="min-width: 60%; max-width: 80%; max-height: 5vh; display: inline-block;" title="Audio player" controls="controls"><source src="${url}"></audio></p>`;
                    }

                    let fileNameDisplay = uploadButtonContainer.querySelector('.file-name-display-audio');
                    if (!fileNameDisplay) {
                        fileNameDisplay = document.createElement("div");
                        fileNameDisplay.className = 'file-name-display-audio';
                        uploadButtonContainer.appendChild(fileNameDisplay);
                    }
                    fileNameDisplay.style.marginTop = "5px";
                    fileNameDisplay.style.marginBottom = "0px";
                    fileNameDisplay.style.fontSize = "10px";
                    fileNameDisplay.style.color = "#171b70";
                    fileNameDisplay.textContent = `SELECTED AUDIO: ${fileName}`;

                    updateTemplateContent(auth.currentUser.uid, `shape${uniqueIdCounter}.firstPlaceholder`, url);
                    saveTemplate();
                    hasChanges = false;

                    // Function to update the status div TO SAVED
                    function updateSaveStatusToYes() {
                        const statusDiv = document.getElementById("saveReport");
                        statusDiv.innerHTML = '<span id="cloudDone" class="material-symbols-sharp" style="font-size: 1.2vw; padding-top: 0.1vw;">cloud_done</span>';
                    }
                    updateSaveStatusToYes();

                    // Update the storage usage display
                    await updateStorageUsage(auth.currentUser.uid);
                } catch (error) {
                    console.error("Error getting audio URL:", error);
                }
            });

            // Append the file item container to the storage div
            storageDiv.appendChild(fileItemContainer);
        });

        // Attach the close event to the newly created close button
        document.getElementById('audio-close-storage').onclick = function() {
            storageDiv.style.display = 'none';
        };
    } catch (error) {
        console.error("Error listing audios:", error);
    }
};

window.handleImageUpload = async function(event, imagePlaceholder, uploadButtonContainer) {
    const fileInput = event.target;
    const file = fileInput.files[0];
    if (!file) return;

    // Define the allowed MIME types
    const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];

    // Check if the file's MIME type is in the allowed MIME types
    if (!allowedTypes.includes(file.type)) {
        alert('This file type is not supported.');
        resetFileInput(fileInput); // Reset the file input
        return; // Exit the function if the file type is not supported
    }

    // Define the maximum file size (e.g., 5MB)
    const maxFileSize = 5 * 1024 * 1024; // 5 Megabytes

    // Check if the file size exceeds the maximum size
    if (file.size > maxFileSize) {
        alert('The file is too large. Please upload a file smaller than 5MB.');
        resetFileInput(fileInput); // Reset the file input
        return; // Exit the function if the file is too large
    }

    // Get total size of all files uploaded by the user
    const userId = auth.currentUser.uid;
    const totalSizeLimit = await getTotalSizeOfUserFiles(userId);
    const maxTotalSize = 10000 * 1024 * 1024; // 10 GB

    // Check if the new file exceeds the total size limit
    if (totalSizeLimit + file.size > maxTotalSize) {
        alert('You have exceeded your total upload limit of 10GB.');
        resetFileInput(fileInput); // Reset the file input
        return; // Exit the function if the total size exceeds the limit
    }

    // Temp animation
    if (imagePlaceholder) {
        imagePlaceholder.innerHTML = "";
        const animation = document.createElement("div");
        animation.innerHTML = '<div class="tempLoadingAnimation"><div class="circles"><div class="circleColorOne"></div><div class="circleColorTwo"></div><div class="circleColorOne"></div><div class="circleColorTwo"></div></div></div>';
        imagePlaceholder.appendChild(animation);
    }


    // Generate a human-readable timestamp
    const now = new Date();
    const formattedTimestamp = `${now.getDate()}-${now.getMonth()+1}-${now.getFullYear()}-${now.getHours()}-${now.getMinutes()}-${now.getSeconds()}`;

    // Extract the file extension
    const fileExtension = file.name.split('.').pop();
    const fileNameWithoutExtension = file.name.replace(`.${fileExtension}`, '');

    // Generate a unique file name
    const uniqueFileName = `${fileNameWithoutExtension}-${formattedTimestamp}.${fileExtension}`;

    // Include the user's UID in the file path
    const userFolderPath = `users/${auth.currentUser.uid}/images/${uniqueFileName}`;

    // Use the modular syntax for Firebase Storage
    const storage = getStorage();
    const storageReference = storageRef(storage, userFolderPath);
    try {
        // Upload the file
        const snapshot = await uploadBytes(storageReference, file);

        // Get the download URL
        const url = await getDownloadURL(snapshot.ref);

        const imagePlaceholderId = imagePlaceholder.id.match(/\d+$/)[0];

        // Initial max-width percentage
        let maxWidthPercentage = 100;

        // Update the image in the right column, if necessary
        if (imagePlaceholder) {
            imagePlaceholder.innerHTML = ''; // Clear any existing content
            const image = document.createElement("img");
            image.src = url;
            image.id = 'uploadedImage' + imagePlaceholderId;
            image.style.maxWidth = maxWidthPercentage + "%"; // Apply initial max-width
            imagePlaceholder.appendChild(image);
        }

        let minusplus = uploadButtonContainer.querySelector('.minusplus');

        if (!minusplus) {
            minusplus = document.createElement("div");
            minusplus.className = 'minusplus';

            var plus = document.createElement('div');
            plus.innerHTML = '<span class="material-symbols-sharp" id="cursorDiv"> add_box </span>';
            plus.id = 'increaseWidth' + imagePlaceholderId;
            plus.style.display = 'flex';
            plus.style.alignItems = 'center';
            minusplus.appendChild(plus);

            var minus = document.createElement('div');
            minus.innerHTML = '<span class="material-symbols-sharp" id="cursorDiv">indeterminate_check_box</span>';
            minus.id = 'decreaseWidth' + imagePlaceholderId;
            minus.style.display = 'flex';
            minus.style.alignItems = 'center';
            minusplus.appendChild(minus);

            var plusminusLabel = document.getElementById('plusminusLabel' + imagePlaceholderId);

            plusminusLabel.appendChild(minusplus);
        }

        // Create or update an element to display the file name under the upload button
        let fileNameDisplay = uploadButtonContainer.querySelector('.file-name-display');
        if (!fileNameDisplay) {
            fileNameDisplay = document.createElement("div");
            fileNameDisplay.className = 'file-name-display';
            fileNameDisplay.id = 'file-name-display' + imagePlaceholderId;
            uploadButtonContainer.appendChild(fileNameDisplay);
        }
        fileNameDisplay.style.margin = '1vh 0 0 0;';
        fileNameDisplay.style.fontSize = "10px";
        fileNameDisplay.style.color = "#171b70";
        fileNameDisplay.textContent = `UPLOADED IMAGE: ${file.name}`;

        function adjustImageWidth(change) {
            const image = document.getElementById('uploadedImage' + imagePlaceholderId);
            if (image) {
                maxWidthPercentage += change;
                if (maxWidthPercentage > 100) maxWidthPercentage = 100; // Limit to 100%
                if (maxWidthPercentage < 20) maxWidthPercentage = 20;  // Limit to 20%
                image.style.maxWidth = maxWidthPercentage + "%";
            }
        }

        document.getElementById('increaseWidth' + imagePlaceholderId).addEventListener('click', () => adjustImageWidth(10));
        document.getElementById('decreaseWidth' + imagePlaceholderId).addEventListener('click', () => adjustImageWidth(-10));

        // Update your template content and save
        updateTemplateContent(auth.currentUser.uid, `shape${uniqueIdCounter}.firstPlaceholder`, url);
        saveTemplate();
        hasChanges = false;

        // Function to update the status div TO SAVED
        function updateSaveStatusToYes() {
            const statusDiv = document.getElementById("saveReport");
            statusDiv.innerHTML = '<span id="cloudDone" class="material-symbols-sharp" style="font-size: 1.2vw; padding-top: 0.1vw;">cloud_done</span>';
        }
        updateSaveStatusToYes();

        // Update the storage usage display
        await updateStorageUsage(auth.currentUser.uid);

    } catch (error) {
        console.error("Error uploading file:", error);
    } finally {
        resetFileInput(fileInput); // Reset the file input to allow re-uploading the same file
    }
};

// Function to reset the file input element
function resetFileInput(fileInput) {
    const form = fileInput.closest('form');
    if (form) {
        form.reset();
    } else {
        fileInput.value = '';
    }
};


// Define listAndSelectImages outside of the conditional block
window.listAndSelectImages = async function(imagePlaceholder, uploadButtonContainer) {
    const storage = getStorage();
    const storageReference = storageRef(storage, `users/${auth.currentUser.uid}/images/`);
    const storageDiv = document.getElementById('image-storage-content');

    const otherStorageDivs = document.querySelectorAll('.video-storage-content, .audio-storage-content, .file-storage-content');
            otherStorageDivs.forEach(div => {
              div.style.display = 'none';
            });

    try {
        // List all items (files) in the user's image folder
        const listResult = await listAll(storageReference);

        // Clear the storageDiv before appending the new list
        storageDiv.innerHTML = '<span class="image-close-storage" id="image-close-storage">&times;</span><div id="storageFiles" style="font-size: 2vw; font-family: Arial; color: white; margin-bottom: 3vw;">Storage Images</div>';

        // Display the list of image files
        listResult.items.forEach((itemRef) => {
            const fileName = itemRef.name;

            // Create a container for the icon and file name
            const fileItemContainer = document.createElement('div');
            fileItemContainer.className = 'image-file-item-container';
            fileItemContainer.style.display = 'flex';
            fileItemContainer.style.alignItems = 'center';

            // Create and add the image icon
            const imageIcon = document.createElement('div');
            imageIcon.innerHTML = '<span id="storageFiles" class="material-symbols-sharp" style="font-size: 1vw;"> imagesmode </span>';
            imageIcon.style.marginRight = '8px';
            imageIcon.style.display = 'flex';
            imageIcon.style.alignItems = 'center';
            fileItemContainer.appendChild(imageIcon);

            // Create and add the file name
            const fileItem = document.createElement('div');
            fileItem.textContent = fileName;
            fileItem.className = 'image-file-item';
            fileItemContainer.appendChild(fileItem);

            // Add a click event listener to handle image selection
            fileItemContainer.addEventListener('click', async () => {
                // Hide the image-storage-content div first
                storageDiv.style.display = 'none';

                try {
                    const url = await getDownloadURL(itemRef);

                    const imagePlaceholderId = imagePlaceholder.id.match(/\d+$/)[0];


                            // Initial max-width percentage
        let maxWidthPercentage = 100;

                    // Replace the iframe src with the selected image URL
                    if (imagePlaceholder) {
                      imagePlaceholder.innerHTML = "";
            const image = document.createElement("img");
            image.src = url;
            image.id = 'selectedImage' + imagePlaceholderId;
            image.style.maxWidth = maxWidthPercentage + "%"; // Apply initial max-width
            imagePlaceholder.appendChild(image);

        }

        let minusplus = uploadButtonContainer.querySelector('.minusplus');

if (!minusplus) {
minusplus = document.createElement("div");
minusplus.className = 'minusplus';

var plus = document.createElement('div');
plus.innerHTML = '<span class="material-symbols-sharp" id="cursorDiv"> add_box </span>';
plus.id = 'increaseWidth' + imagePlaceholderId;
plus.style.display = 'flex';
plus.style.alignItems = 'center';
minusplus.appendChild(plus);

var minus = document.createElement('div');
minus.innerHTML = '<span class="material-symbols-sharp" id="cursorDiv">indeterminate_check_box</span>';
minus.id = 'decreaseWidth' + imagePlaceholderId;
minus.style.display = 'flex';
minus.style.alignItems = 'center';
minusplus.appendChild(minus);

var plusminusLabel = document.getElementById('plusminusLabel' + imagePlaceholderId);

plusminusLabel.appendChild(minusplus);
}

                    let fileNameDisplay = uploadButtonContainer.querySelector('.file-name-display');
                    if (!fileNameDisplay) {
                        fileNameDisplay = document.createElement("div");
                        fileNameDisplay.className = 'file-name-display';
                        fileNameDisplay.id = 'file-name-display' + imagePlaceholderId;
                        uploadButtonContainer.appendChild(fileNameDisplay);
                    }
                    fileNameDisplay.style.margin = '1vh 0 0 0;';
                    fileNameDisplay.style.fontSize = "10px";
                    fileNameDisplay.style.color = "#171b70";
                    fileNameDisplay.textContent = `SELECTED IMAGE: ${fileName}`;

                    
function adjustImageWidth(change) {
    const image = document.getElementById('selectedImage' + imagePlaceholderId);
    if (image) {
        maxWidthPercentage += change;
        if (maxWidthPercentage > 100) maxWidthPercentage = 100; // Limit to 100%
        if (maxWidthPercentage < 20) maxWidthPercentage = 20;  // Limit to 20%
        image.style.maxWidth = maxWidthPercentage + "%";
    }
}

document.getElementById('increaseWidth' + imagePlaceholderId).addEventListener('click', () => adjustImageWidth(10));
document.getElementById('decreaseWidth' + imagePlaceholderId).addEventListener('click', () => adjustImageWidth(-10));
	

                    updateTemplateContent(auth.currentUser.uid, `shape${uniqueIdCounter}.firstPlaceholder`, url);
                    saveTemplate();
                    hasChanges = false;

                    // Function to update the status div TO SAVED
                    function updateSaveStatusToYes() {
                        const statusDiv = document.getElementById("saveReport");
                        statusDiv.innerHTML = '<span id="cloudDone" class="material-symbols-sharp" style="font-size: 1.2vw; padding-top: 0.1vw;">cloud_done</span>';
                    }
                    updateSaveStatusToYes();

                    // Update the storage usage display
                    await updateStorageUsage(auth.currentUser.uid);
                } catch (error) {
                    console.error("Error getting image URL:", error);
                }
            });

            // Append the file item container to the storage div
            storageDiv.appendChild(fileItemContainer);
        });

        // Attach the close event to the newly created close button
        document.getElementById('image-close-storage').onclick = function() {
            storageDiv.style.display = 'none';
        };
    } catch (error) {
        console.error("Error listing images:", error);
    }
};


// Function to get total size of all files in the user's folder
async function getTotalSizeOfUserFiles(userId) {
    const storage = getStorage();
    const folderNames = ['videos', 'audios', 'images', 'embeds'];
    let totalSizeLimit = 0;

    try {
        const promises = folderNames.map(async (folder) => {
            const listRef = storageRef(storage, `users/${userId}/${folder}`);
            const res = await listAll(listRef);
            const folderPromises = res.items.map(async (itemRef) => {
                const metadata = await getMetadata(itemRef);
                totalSizeLimit += metadata.size;
            });
            await Promise.all(folderPromises);
        });

        await Promise.all(promises);

    } catch (error) {
        console.error("Error calculating storage usage:", error);
    }
    return totalSizeLimit;
};



window.listAndSelectFiles = async function() {
    const storage = getStorage();
    const storageDiv = document.getElementById('file-storage-content');
    const userId = auth.currentUser.uid;

    const strVideos = document.getElementById('strVideos');
    const strAudios = document.getElementById('strAudios');
    const strImages = document.getElementById('strImages');

    // Add styles for hover effect on delete button
    const style = document.createElement('style');
    style.innerHTML = `
        .delete-icon:hover {
            color: rgba(255, 255, 0, 0.799);
        }
    `;
    document.head.appendChild(style);

    const storageReferenceVideos = storageRef(storage, `users/${auth.currentUser.uid}/videos/`);
    try {
        // List all items (files) in the user's video folder
        const listResult = await listAll(storageReferenceVideos);

        // Display the list of video files
        listResult.items.forEach(async (itemRef) => {
            const fileName = itemRef.name;

            // Create a container for the icon and file name
            const fileItemContainer = document.createElement('div');
            fileItemContainer.className = 'storage-file-item-container';
            fileItemContainer.style.display = 'flex';
            fileItemContainer.style.alignItems = 'center';

            // Create and add the delete icon
            const deleteIcon = document.createElement('div');
            deleteIcon.innerHTML = '<span id="mobileIcon" class="material-symbols-sharp delete-icon" style="font-size: 1vw; cursor: pointer;">delete</span>';
            deleteIcon.style.marginRight = '8px';
            deleteIcon.style.display = 'flex';
            deleteIcon.style.alignItems = 'center';
            deleteIcon.onclick = async () => {
                const confirmation = confirm('Confirm you want to permanently delete this file. It will become unavailable in any of the pages you created.');
                if (confirmation) {
                    try {
                        await deleteObject(itemRef);
                        strVideos.removeChild(fileItemContainer);
                        updateStorageUsage(userId);
                    } catch (error) {
                        console.error("Error deleting file:", error);
                    }
                }
            };
            fileItemContainer.appendChild(deleteIcon);

            // Create and add the video icon
            const videoIcon = document.createElement('div');
            videoIcon.innerHTML = '<span id="mobileIcon" class="material-symbols-sharp" style="font-size: 1vw;">videocam</span>';
            videoIcon.style.marginRight = '8px';
            videoIcon.style.display = 'flex';
            videoIcon.style.alignItems = 'center';
            fileItemContainer.appendChild(videoIcon);

            // Create and add the file link
            const fileLink = document.createElement('a');
            fileLink.textContent = fileName;

            fileLink.className = 'video-file-item';
            fileLink.target = '_blank';
            // Get the download URL and set it as the href attribute
            const fileUrl = await getDownloadURL(itemRef);
            fileLink.href = fileUrl;
            fileItemContainer.appendChild(fileLink);

            // Append the file item container to the storage div
            strVideos.appendChild(fileItemContainer);
        });

        // Attach the close event to the newly created close button
        document.getElementById('file-close-storage').onclick = function() {
            storageDiv.style.display = 'none';
            strVideos.innerHTML = '';
            strAudios.innerHTML = '';
            strImages.innerHTML = '';
        };
    } catch (error) {
        console.error("Error listing videos:", error);
    }

    const storageReferenceAudios = storageRef(storage, `users/${auth.currentUser.uid}/audios/`);
    try {
        // List all items (files) in the user's audio folder
        const listResult = await listAll(storageReferenceAudios);

        // Display the list of audio files
        listResult.items.forEach(async (itemRef) => {
            const fileName = itemRef.name;

            // Create a container for the icon and file name
            const fileItemContainer = document.createElement('div');
            fileItemContainer.className = 'storage-file-item-container';
            fileItemContainer.style.display = 'flex';
            fileItemContainer.style.alignItems = 'center';

            // Create and add the delete icon
            const deleteIcon = document.createElement('div');
            deleteIcon.innerHTML = '<span id="mobileIcon" class="material-symbols-sharp delete-icon" style="font-size: 1vw; cursor: pointer;">delete</span>';
            deleteIcon.style.marginRight = '8px';
            deleteIcon.style.display = 'flex';
            deleteIcon.style.alignItems = 'center';
            deleteIcon.onclick = async () => {
                const confirmation = confirm('Confirm you want to permanently delete this file. It will become unavailable in any of the pages you created.');
                if (confirmation) {
                    try {
                        await deleteObject(itemRef);
                        strAudios.removeChild(fileItemContainer);
                        updateStorageUsage(userId);
                    } catch (error) {
                        console.error("Error deleting file:", error);
                    }
                }
            };
            fileItemContainer.appendChild(deleteIcon);

            // Create and add the audio icon
            const audioIcon = document.createElement('div');
            audioIcon.innerHTML = '<span id="mobileIcon" class="material-symbols-sharp" style="font-size: 1vw;">audiotrack</span>';
            audioIcon.style.marginRight = '8px';
            audioIcon.style.display = 'flex';
            audioIcon.style.alignItems = 'center';
            fileItemContainer.appendChild(audioIcon);

            // Create and add the file link
            const fileLink = document.createElement('a');
            fileLink.textContent = fileName;
            fileLink.className = 'audio-file-item';
            fileLink.target = '_blank';
            // Get the download URL and set it as the href attribute
            const fileUrl = await getDownloadURL(itemRef);
            fileLink.href = fileUrl;
            fileItemContainer.appendChild(fileLink);

            // Append the file item container to the storage div
            strAudios.appendChild(fileItemContainer);
        });
    } catch (error) {
        console.error("Error listing audios:", error);
    }

    const storageReferenceImages = storageRef(storage, `users/${auth.currentUser.uid}/images/`);
    try {
        // List all items (files) in the user's image folder
        const listResult = await listAll(storageReferenceImages);

        // Display the list of image files
        listResult.items.forEach(async (itemRef) => {
            const fileName = itemRef.name;

            // Create a container for the icon and file name
            const fileItemContainer = document.createElement('div');
            fileItemContainer.className = 'storage-file-item-container';
            fileItemContainer.style.display = 'flex';
            fileItemContainer.style.alignItems = 'center';

            // Create and add the delete icon
            const deleteIcon = document.createElement('div');
            deleteIcon.innerHTML = '<span id="mobileIcon" class="material-symbols-sharp delete-icon" style="font-size: 1vw; cursor: pointer;">delete</span>';
            deleteIcon.style.marginRight = '8px';
            deleteIcon.style.display = 'flex';
            deleteIcon.style.alignItems = 'center';
            deleteIcon.onclick = async () => {
                const confirmation = confirm('Confirm you want to permanently delete this file. It will become unavailable in any of the pages you created.');
                if (confirmation) {
                    try {
                        await deleteObject(itemRef);
                        strImages.removeChild(fileItemContainer);
                        updateStorageUsage(userId);
                    } catch (error) {
                        console.error("Error deleting file:", error);
                    }
                }
            };
            fileItemContainer.appendChild(deleteIcon);

            // Create and add the image icon
            const imageIcon = document.createElement('div');
            imageIcon.innerHTML = '<span id="mobileIcon" class="material-symbols-sharp" style="font-size: 1vw;">image</span>';
            imageIcon.style.marginRight = '8px';
            imageIcon.style.display = 'flex';
            imageIcon.style.alignItems = 'center';
            fileItemContainer.appendChild(imageIcon);

            // Create and add the file link
            const fileLink = document.createElement('a');
            fileLink.textContent = fileName;
            fileLink.className = 'image-file-item';
            fileLink.target = '_blank';
            // Get the download URL and set it as the href attribute
            const fileUrl = await getDownloadURL(itemRef);
            fileLink.href = fileUrl;
            fileItemContainer.appendChild(fileLink);

            // Append the file item container to the storage div
            strImages.appendChild(fileItemContainer);
        });
    } catch (error) {
        console.error("Error listing images:", error);
    }
};







// Function to calculate and display the total storage usage for the user
async function updateStorageUsage(userId) {
    const storage = getStorage();
    const folderNames = ['videos', 'audios', 'images', 'embeds'];
    let totalSize = 0;

    try {
    const promises = folderNames.map(async (folder) => {
        const listRef = storageRef(storage, `users/${userId}/${folder}`);
        const res = await listAll(listRef);
        const folderPromises = res.items.map(async (itemRef) => {
            const metadata = await getMetadata(itemRef);
            totalSize += metadata.size;
        });
        await Promise.all(folderPromises); 
    });

    await Promise.all(promises);

    // Convert total size to a readable format (e.g., MB or GB)
    const totalSizeMB = totalSize / (1024 * 1024);
    let displaySize;

    if (totalSizeMB > 999) {
        const totalSizeGB = (totalSizeMB / 1024).toFixed(2);
        displaySize = `${totalSizeGB} GB`;
    } else {
        displaySize = `${totalSizeMB.toFixed(2)} MB`;
    }

    document.getElementById("storageIndicator").textContent = `${displaySize} out of 10GB`;
} catch (error) {
    console.error('Error calculating total size:', error);
}

}
// Call updateStorageUsage when the auth state changes
const auth = getAuth();
onAuthStateChanged(auth, (user) => {
    if (user) {
        (async function() {
            await updateStorageUsage(user.uid);
        })();
    }
});



        function createShape(shapeClass, text, color, isBanner) {
        const shapeContainer = document.createElement("div");
        shapeContainer.id = `shape${uniqueIdCounter}`;
        shapeContainer.className = "shape " + shapeClass;

				if (shapeClass === "circle") {

                    shapeContainer.style.color = '#ffffff';
                    shapeContainer.style.backgroundColor = '#171b70';
                    shapeContainer.style.padding = '4vw 4vw 3vw 3vw';

                    const firstPlaceholder = document.createElement("div");
                    firstPlaceholder.id = `firstplaceholder${uniqueIdCounter}`;
                    firstPlaceholder.className = "placeholderRedCircle";
                    firstPlaceholder.innerText = "Course Title";

                    firstPlaceholder.style.color = '#ffffff';
                    firstPlaceholder.style.marginBottom = '0';
                    firstPlaceholder.style.wordWrap = 'break-word'; 
                    firstPlaceholder.style.lineHeight = '1';
                    firstPlaceholder.style.paddingBottom = '1vw';

                    const secondPlaceholder = document.createElement("div");
                    secondPlaceholder.id = `secondplaceholder${uniqueIdCounter}`;
                    secondPlaceholder.className = "placeholderRedCircle";
                    secondPlaceholder.innerText = "Course Details";

                    secondPlaceholder.style.color = '#ffffff';
                    secondPlaceholder.style.marginBottom = '0';
                    secondPlaceholder.style.wordWrap = 'break-word'; 

                    // Apply different styles to first and second placeholders
                    firstPlaceholder.style.fontSize = "2.5vw"; // Updated the font size
                    secondPlaceholder.style.fontSize = "1.5vw"; // Adjust the size as needed

                    shapeContainer.appendChild(firstPlaceholder);
                    shapeContainer.appendChild(secondPlaceholder);
					
					} else if (isBanner) {
                    const bannerPlaceholder = document.createElement("div");
                    bannerPlaceholder.className = "banner-placeholder";
                    bannerPlaceholder.id = `banner-placeholder${uniqueIdCounter}`;
                    shapeContainer.appendChild(bannerPlaceholder);
					
					} else if (shapeClass === "rich-editor") {
						const richEditorPlaceholder = document.createElement("div");
						richEditorPlaceholder.id = `richEditorPlaceholder${uniqueIdCounter}`;
						richEditorPlaceholder.className = "rich-editor-placeholder";
            richEditorPlaceholder.style.whiteSpace = 'pre-wrap';
            richEditorPlaceholder.style.lineHeight = '1.42';
            richEditorPlaceholder.style.fontSize = '1.2vw';
            richEditorPlaceholder.style.fontFamily = 'Times New Roman';
            const richPlaceholderText = `<div id="richPlaceholderText" style="display: grid; place-items: center; height: 7.5vw; color: #171b70; font-size: 1.5vw; text-align: center;"><span class="material-symbols-sharp"> history_edu </span>YOUR TEXT WILL APPEAR HERE</div>`;
            richEditorPlaceholder.innerHTML = richPlaceholderText;

						shapeContainer.appendChild(richEditorPlaceholder);

					} else if (shapeClass === "square-blue") {
						const placeholder = document.createElement("div");
						placeholder.id = `firstplaceholder${uniqueIdCounter}`;
						placeholder.className = "placeholderRedCircle";
						placeholder.innerText = text;
            placeholder.style.padding = '1.2vw 4vw 1.2vw 3vw';
						placeholder.style.textAlign = "center";
						placeholder.style.marginLeft = '0';
            placeholder.style.fontSize = "1.5vw";
            placeholder.style.marginBottom = '1vw';
            placeholder.style.color = '#ffffff';
            shapeContainer.style.backgroundColor = "#171b70";

          
						shapeContainer.appendChild(placeholder);

					} else if (shapeClass === "menu2") {
						codeCounter1++;
						codeCounter2++;
						const htmlCode = getMenu2Html(codeCounter1, codeCounter2);
						shapeContainer.innerHTML = htmlCode;
						console.log("Created ID for menuItemOne:", `menuItemOne${codeCounter1}`);
						console.log("Created ID for menuItemTwo:", `menuItemTwo${codeCounter2}`);
						document.getElementById('right-column').appendChild(shapeContainer);
					} else if (shapeClass === "menu3") {
						codeCounter1++;
						codeCounter2++;
						codeCounter3++;
						const htmlCode = getMenu3Html(codeCounter1, codeCounter2, codeCounter3);
						shapeContainer.innerHTML = htmlCode;
						console.log("Created ID for menuItemOne:", `menuItemOne${codeCounter1}`);
						console.log("Created ID for menuItemTwo:", `menuItemTwo${codeCounter2}`);
						console.log("Created ID for menuItemTwo:", `menuItemTwo${codeCounter3}`);
						document.getElementById('right-column').appendChild(shapeContainer);
					} else if (shapeClass === "imageUpload") {
						const firstPlaceholder = document.createElement("div");
						firstPlaceholder.id = `firstplaceholder${uniqueIdCounter}`;
						firstPlaceholder.className = "placeholderImage";
            firstPlaceholder.style.display = 'flex';
            firstPlaceholder.style.justifyContent = 'center';
            const imagePlaceholderText = `<div style="display: grid; place-items: center; height: 7.5vw; color: #171b70; font-size: 1.5vw; text-align: center;"><span class="material-symbols-sharp"> imagesmode </span>YOUR IMAGE WILL APPEAR HERE</div>`;
						firstPlaceholder.innerHTML = imagePlaceholderText;
						shapeContainer.appendChild(firstPlaceholder);
					} else if (shapeClass === "accordion") {
						// Container styling
						shapeContainer.style.padding = "5px 10px 5px 10px";
						shapeContainer.style.backgroundColor = "#171b70";
						shapeContainer.style.marginBottom = "1vw";
						shapeContainer.style.border = "0px solid"; // Add a border for definition
						shapeContainer.style.borderRadius = "5px"; // Rounded corners for a modern look
            shapeContainer.style.wordWrap = "break-word";

						const details = document.createElement("details");

						// Summary styling
						const summary = document.createElement("summary");
						summary.id = `firstplaceholder${uniqueIdCounter}`;
						summary.style.cursor = "pointer";
						summary.innerText = "Title";
						summary.style.fontWeight = "bold"; // Make the label bold
						summary.style.margin = "0.5vw 0 0.5vw 0"; // Space between summary and content
						summary.style.color = "#fff";
						summary.style.padding = "2px 0"; // Padding for touch targets
            summary.style.fontSize = "calc(0.7vw + 3pt)";


						// Content div styling
						const div = document.createElement("div");
						div.id = `secondplaceholder${uniqueIdCounter}`;
            div.className = "accordionDetails";
						div.style.padding = "10px 10px";
						div.innerText = "Accordion details will appear here";
						div.style.backgroundColor = "#fff"; // Slightly off-white background for the content area
						div.style.color = "#000";
            div.style.fontSize = "calc(0.7vw + 3pt)";

						details.appendChild(summary);
						details.appendChild(div);
						shapeContainer.appendChild(details);
					} else if (shapeClass === "flashcardStack") {
						const sliderContainer = document.createElement("div");
						sliderContainer.className = "flashcard-slider";
						sliderContainer.id = `flashcard-slider${uniqueIdCounter}`;
						shapeContainer.appendChild(sliderContainer);	
					} else if (shapeClass === "videoUpload") {
            const firstPlaceholder = document.createElement("div");
            firstPlaceholder.id = `firstplaceholder${uniqueIdCounter}`;
            firstPlaceholder.className = "placeholderVideo";
            const videoPlaceholderText = `<div style="display: grid; place-items: center; height: 7.5vw; color: #171b70; font-size: 1.5vw; text-align: center;"><span class="material-symbols-sharp"> videocam </span>YOUR VIDEO WILL APPEAR HERE</div>`;
						firstPlaceholder.innerHTML = videoPlaceholderText;
            shapeContainer.appendChild(firstPlaceholder);
				  } else if (shapeClass === "audioUpload") {
            const firstPlaceholder = document.createElement("div");
            firstPlaceholder.id = `firstplaceholder${uniqueIdCounter}`;
            firstPlaceholder.className = "placeholderAudio";
            const audioPlaceholderText = `<div style="display: grid; place-items: center; height: 7.5vw; color: #171b70; font-size: 1.5vw; text-align: center;"><span class="material-symbols-sharp"> music_note </span>YOUR AUDIO WILL APPEAR HERE</div>`;
						firstPlaceholder.innerHTML = audioPlaceholderText;
            shapeContainer.appendChild(firstPlaceholder);
				  } else if (shapeClass === "emptyLine") {
            const firstPlaceholder = document.createElement("div");
            firstPlaceholder.style.height = '1vw';
            firstPlaceholder.id = `firstplaceholder${uniqueIdCounter}`;
            firstPlaceholder.className = "empty-line";
            shapeContainer.appendChild(firstPlaceholder);
				  } else if (shapeClass === "quizClass") {
						const sliderContainer = document.createElement("div");
						sliderContainer.className = "flashcard-slider";
						sliderContainer.id = `flashcard-slider${uniqueIdCounter}`;
						shapeContainer.appendChild(sliderContainer);	
					}
          return shapeContainer;
        }
	
            function createTextarea(container, shape, firstPlaceholder, secondPlaceholder, isBanner, currentCodeCounter1, currentCodeCounter2, currentCodeCounter3) {
                const textareaContainer = document.createElement("div");
                textareaContainer.id = `textarea-container${uniqueIdCounter}`;
                textareaContainer.className = "textarea-container-three";
                textareaContainer.style.display = "none";
				        textareaContainer.style.marginTop = "20px";
				
				        // Add a delete button
                const deleteButton = document.createElement("button");
                deleteButton.className = "delete-button fas fa-trash";
                deleteButton.addEventListener("click", function() {
                    // Remove both textarea-container and the associated shape
                    textareaContainer.remove();
                    shape.remove();
				             if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
                });

                // Add a down button
                const downButton = document.createElement("button");
                downButton.className = "down-button fas fa-arrow-down";
                downButton.addEventListener("click", function() {
                    const nextTextareaContainer = textareaContainer.nextElementSibling;
                    const nextShape = shape.nextElementSibling;
                    if (nextTextareaContainer && nextShape) {
                        container.insertBefore(nextTextareaContainer, textareaContainer);
                        rightColumn.insertBefore(nextShape, shape);
                    }
				               if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
                });

                // Add an up button
                const upButton = document.createElement("button");
                upButton.className = "up-button fas fa-arrow-up";
                upButton.addEventListener("click", function() {
                    const prevTextareaContainer = textareaContainer.previousElementSibling;
                    const prevShape = shape.previousElementSibling;
                    if (prevTextareaContainer && prevShape) {
                        container.insertBefore(textareaContainer, prevTextareaContainer);
                        rightColumn.insertBefore(shape, prevShape);
                    }
				               if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
                });
				
				deleteButton.style.color = "#d61d1d";
				downButton.style.color = "#171b70";
				upButton.style.color = "#171b70";
				textareaContainer.appendChild(deleteButton);
        textareaContainer.appendChild(downButton);
        textareaContainer.appendChild(upButton);
				
				if (shape.classList.contains("circle")) {
            const firstPElement = document.createElement("p");
            firstPElement.innerText = "TITLE / DETAILS";
            firstPElement.style.fontWeight = "bold";
            firstPElement.style.color = "#171b70";
            textareaContainer.appendChild(firstPElement);

// COLOR----- Create button for opening color selection palette
var colorSelectButtonTitle = document.createElement('button');
colorSelectButtonTitle.id = `colorSelectButtonTitle${uniqueIdCounter}`;
colorSelectButtonTitle.className = 'colorSelectButtonClassTitle';
const img = document.createElement("img");
img.src = 'https://grahamandsergei.github.io/app/palette.png';
img.style.maxWidth = '20px';
img.style.maxHeight = '18px';
colorSelectButtonTitle.appendChild(img);
textareaContainer.appendChild(colorSelectButtonTitle);

// Create popup area for color selection
var colorPopupTitle = document.createElement('div');
colorPopupTitle.id = `colorPopupTitle${uniqueIdCounter}`;
colorPopupTitle.className = 'color-popup-title';
textareaContainer.appendChild(colorPopupTitle);

// Populate popup with color options
colors.forEach(function(colorTitle) {
  var colorElementTitle = document.createElement('div');
  colorElementTitle.className = 'colorElementTitle'; 
  colorElementTitle.style.backgroundColor = colorTitle;

  colorElementTitle.id = `colorOptionTitle${uniqueIdCounter}`;

  var numericPart = textareaContainer.id.match(/\d+/)[0];
  var correspondingShape = document.getElementById(`shape${numericPart}`);


    colorElementTitle.addEventListener('click', function() {    
    if (correspondingShape) {
      correspondingShape.style.backgroundColor = colorTitle;
    }
    colorPopupTitle.style.display = 'none'; // Hide popup after selection
  });
  colorPopupTitle.appendChild(colorElementTitle);
});

var colorSelectButton = document.createElement('div');
var imageSelectButton = document.createElement('div');
var colorSelectButtonTwo = document.createElement('div');
var imageSelectButtonTwo = document.createElement('div');
var colorSelectButtonThree = document.createElement('div');
var imageSelectButtonThree = document.createElement('div');
var colorSelectButtonSection = document.createElement('div');

function setupPopupToggle(button, popupPrefix) {
    button.addEventListener('click', function(event) {
        event.stopPropagation();

        // Determine the target popup
        const numericPart = this.id.match(/\d+/)[0];
        const targetPopupId = `${popupPrefix}${numericPart}`;
        const targetPopup = document.getElementById(targetPopupId);

        // Check if the target popup is already displayed
        if (targetPopup.style.display === 'flex') {
            // If so, close it and return early to avoid reopening it
            targetPopup.style.display = 'none';
            return; // Prevent further execution of the function
        }

        // Close all popups first
        document.querySelectorAll('.image-popup, .image-popup2, .color-popup, .color-popup2, .image-popup3, .color-popup3, .color-popup-section, .color-popup-title').forEach(popup => {
            popup.style.display = 'none';
        });

        // Open the target popup
        targetPopup.style.display = 'flex';

         if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
    });
}

// Setup event listeners for each button (assuming the button variables are already defined)
setupPopupToggle(colorSelectButton, 'colorPopup');
setupPopupToggle(imageSelectButton, 'imagePopup');
setupPopupToggle(colorSelectButtonTwo, 'colorPopupTwo');
setupPopupToggle(imageSelectButtonTwo, 'imagePopupTwo');
setupPopupToggle(colorSelectButtonThree, 'colorPopupThree');
setupPopupToggle(imageSelectButtonThree, 'imagePopupThree');
setupPopupToggle(colorSelectButtonSection, 'colorPopupSection');
setupPopupToggle(colorSelectButtonTitle, 'colorPopupTitle');

            const firstTextarea = document.createElement("input");
						firstTextarea.style.width = "90%";
						firstTextarea.style.marginBottom = "5px";
						firstTextarea.type = 'text';
						firstTextarea.id = `firsttextarea${uniqueIdCounter}`;
						firstTextarea.placeholder = "e.g. DM999 Digital Marketing";
						firstTextarea.addEventListener("input", function() {
						  firstPlaceholder.innerText = firstTextarea.value || "Course Title";
						  // Update the value attribute so it's included in innerHTML
						  firstTextarea.setAttribute('value', firstTextarea.value);
						updateTemplateContent(auth.currentUser.uid, `shape${uniqueIdCounter}.firstPlaceholder`, firstTextarea.value);
                     if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
} // Call saveTemplate to save after each change.
            });

						const secondTextarea = document.createElement("textarea");
						secondTextarea.id = `secondtextarea${uniqueIdCounter}`;
						secondTextarea.placeholder = "e.g. Undergraduate, 2024-25";
						secondTextarea.addEventListener("input", function() {
						  secondPlaceholder.innerText = secondTextarea.value || "Course Details";
						  // Update the text content so it's included in innerHTML
						  secondTextarea.textContent = secondTextarea.value;
						updateTemplateContent(auth.currentUser.uid, `shape${uniqueIdCounter}.secondPlaceholder`, secondTextarea.value);
                     if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
} // Call saveTemplate to save after each change.
					});
                    textareaContainer.appendChild(firstTextarea);
                    textareaContainer.appendChild(secondTextarea);	

					} else if (isBanner) {
				
					const pElement = document.createElement("p");
          pElement.innerText = "BANNER IMAGE";
          pElement.style.fontWeight = "bold";
          pElement.style.color = "#171b70";
					textareaContainer.appendChild(pElement);
					
					const slider = document.createElement("div");
					slider.className = "slick-slider";
					slider.style.marginBottom = "0px";

					// Your image paths
					const imagePaths = [
					'https://javamedvedev.github.io/0/sbe.jpg',  // Replace with your first image path
					'https://javamedvedev.github.io/0/sl.jpg', // Replace with your second image path
					'https://javamedvedev.github.io/0/schm.jpg',   // Replace with your third image path
          'https://grahamandsergei.github.io/app/cairnesEconomics.jpg',
          'https://grahamandsergei.github.io/app/cairnesMarketing.jpg',
          'https://grahamandsergei.github.io/app/cairnesManagement.jpg',
          'https://grahamandsergei.github.io/app/cairnesBusinessInformationSystems.jpg',
          'https://grahamandsergei.github.io/app/cairnesAccountanceAndFinance.jpg'
					];

					imagePaths.forEach(path => {
						const slide = document.createElement("div");
						const img = document.createElement("img");
						img.src = path;
						slide.appendChild(img);
						slider.appendChild(slide);
					});

					textareaContainer.appendChild(slider);

					// Append the textareaContainer to the DOM before initializing Slick
					container.appendChild(textareaContainer);

					// Initialize the Slick slider
					$(slider).slick({
						dots: true,
						infinite: true,
						speed: 500,
						slidesToShow: 1,
						initialSlide: 0
					});

					// Set the banner-placeholder to the first image in the slider
					const placeholderId = `banner-placeholder${uniqueIdCounter}`;
					const placeholderDiv = document.getElementById(placeholderId);
					if (placeholderDiv) {
						// Clear any previous content
						placeholderDiv.innerHTML = '';

						// Create an img element for the first image
						const imgElement = document.createElement('img');
						imgElement.src = imagePaths[0]; // Assuming imagePaths contains your images and the first one is what you want
						imgElement.style.width = '100%'; // Set the width to 100%

						// Append the img element to the placeholderDiv
						placeholderDiv.appendChild(imgElement);
					}

					(function(currentId) {
						$(slider).on('afterChange', function(event, slick, currentSlide) {
							const activeImgSrc = slick.$slides[currentSlide].querySelector("img").src;
							const placeholderId = `banner-placeholder${currentId}`;
							const placeholderDiv = document.getElementById(placeholderId);
							if (placeholderDiv) {
								// Clear the existing contents of the placeholderDiv
								placeholderDiv.innerHTML = '';

								// Create a new img element and set its src to the active image source
								const imgElement = document.createElement('img');
								imgElement.src = activeImgSrc;
								imgElement.style.width = '100%'; // Set the width to 100%

								// Append the new img element to the placeholderDiv
								placeholderDiv.appendChild(imgElement);
							}
						});
					})
					(uniqueIdCounter);
					
					// Add change listener to the slider
        $(slider).on('afterChange', function(event, slick, currentSlide) {
            const activeImgSrc = slick.$slides[currentSlide].querySelector("img").src;

            // Update the corresponding shape in the right column
            const shapeId = `shape${uniqueIdCounter}`;
            const shapeDiv = document.getElementById(shapeId);
            if (shapeDiv && shapeDiv.querySelector('.banner-placeholder')) {
                shapeDiv.querySelector('.banner-placeholder').innerHTML = `<img src="${activeImgSrc}" style="width: 100%;">`;
            }

            // Save the current state
             if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
            console.log('hasChanges is set to TRUE by the banner');
        });
					
					} else if (shape.classList.contains("rich-editor")) {
						const pElement = document.createElement("p");
						pElement.innerText = "TEXT EDITOR";
            pElement.style.fontWeight = "bold";
            pElement.style.color = "#171b70";

						const editorDiv = document.createElement("div");
						editorDiv.id = `richEditor${uniqueIdCounter}`;
						editorDiv.className = "rich-editor";
								
						textareaContainer.appendChild(pElement);
						textareaContainer.appendChild(editorDiv);
						// Append the textareaContainer to the DOM before initializing Quill
						container.appendChild(textareaContainer);
						textareaContainer.style.display = "block";

						initializeQuill(uniqueIdCounter); // Initialize Quill for the new editor
						 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
			
					} else if (shape.classList.contains("square-blue")){
							const pElement = document.createElement("p");
							pElement.innerText = "SECTION HEADER";
              pElement.style.fontWeight = "bold";
              pElement.style.color = "#171b70";
							textareaContainer.appendChild(pElement);

// COLOR----- Create button for opening color selection palette
var colorSelectButtonSection = document.createElement('button');
colorSelectButtonSection.id = `colorSelectButtonSection${uniqueIdCounter}`;
colorSelectButtonSection.className = 'colorSelectButtonClassSection';
const img = document.createElement("img");
img.src = 'https://grahamandsergei.github.io/app/palette.png';
img.style.maxWidth = '20px';
img.style.maxHeight = '18px';
colorSelectButtonSection.appendChild(img);
textareaContainer.appendChild(colorSelectButtonSection);

// Create popup area for color selection
var colorPopupSection = document.createElement('div');
colorPopupSection.id = `colorPopupSection${uniqueIdCounter}`;
colorPopupSection.className = 'color-popup-section';
textareaContainer.appendChild(colorPopupSection);

// Populate popup with color options
colors.forEach(function(colorSection) {
  var colorElementSection = document.createElement('div');
  colorElementSection.className = 'colorElementSection'; 
  colorElementSection.style.backgroundColor = colorSection;

  colorElementSection.id = `colorOptionSection${uniqueIdCounter}`;

  var numericPart = textareaContainer.id.match(/\d+/)[0];
  var correspondingShape = document.getElementById(`shape${numericPart}`);


    colorElementSection.addEventListener('click', function() {    
    if (correspondingShape) {
      correspondingShape.style.backgroundColor = colorSection;
    }
    colorPopupSection.style.display = 'none'; // Hide popup after selection
  });
  colorPopupSection.appendChild(colorElementSection);
});

var colorSelectButton = document.createElement('div');
var imageSelectButton = document.createElement('div');
var colorSelectButtonTwo = document.createElement('div');
var imageSelectButtonTwo = document.createElement('div');
var colorSelectButtonThree = document.createElement('div');
var imageSelectButtonThree = document.createElement('div');

function setupPopupToggle(button, popupPrefix) {
    button.addEventListener('click', function(event) {
        event.stopPropagation();

        // Determine the target popup
        const numericPart = this.id.match(/\d+/)[0];
        const targetPopupId = `${popupPrefix}${numericPart}`;
        const targetPopup = document.getElementById(targetPopupId);

        // Check if the target popup is already displayed
        if (targetPopup.style.display === 'flex') {
            // If so, close it and return early to avoid reopening it
            targetPopup.style.display = 'none';
            return; // Prevent further execution of the function
        }

        // Close all popups first
        document.querySelectorAll('.image-popup, .image-popup2, .color-popup, .color-popup2, .image-popup3, .color-popup3, .color-popup-section').forEach(popup => {
            popup.style.display = 'none';
        });

        // Open the target popup
        targetPopup.style.display = 'flex';

         if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
    });
}

// Setup event listeners for each button (assuming the button variables are already defined)
setupPopupToggle(colorSelectButton, 'colorPopup');
setupPopupToggle(imageSelectButton, 'imagePopup');
setupPopupToggle(colorSelectButtonTwo, 'colorPopupTwo');
setupPopupToggle(imageSelectButtonTwo, 'imagePopupTwo');
setupPopupToggle(colorSelectButtonThree, 'colorPopupThree');
setupPopupToggle(imageSelectButtonThree, 'imagePopupThree');
setupPopupToggle(colorSelectButtonSection, 'colorPopupSection');

							const textarea = document.createElement("input");
							textarea.style.width = "100%";
							textarea.style.marginBottom = "5px";
							textarea.type = 'text';
							textarea.id = `textarea${uniqueIdCounter}`;
							textarea.placeholder = "e.g. Introduction";
              textarea.style.width = '90%';
							// Corrected event listener for updating the corresponding placeholder
							textarea.addEventListener("input", function() {
							  firstPlaceholder.innerText = textarea.value || "SECTION TITLE";
							  // Update the value attribute so it's included in innerHTML
							  textarea.setAttribute('value', textarea.value);
							  updateTemplateContent(`shape${uniqueIdCounter}.firstPlaceholder`, textarea.value);
							   if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
							});
							textareaContainer.appendChild(textarea);
							
						} else if (shape.classList.contains("menu2")) {
					const menuPElement = document.createElement("p");
					menuPElement.innerText = "MENU OF 2";
          menuPElement.style.fontWeight = "bold";
          menuPElement.style.color = "#171b70";
					textareaContainer.appendChild(menuPElement);

// COLOR----- Create button for opening color selection palette
var colorSelectButton = document.createElement('button');
colorSelectButton.id = `colorSelectButton${currentCodeCounter1}`;
colorSelectButton.className = 'colorSelectButtonClass';
const img = document.createElement("img");
img.src = 'https://grahamandsergei.github.io/app/palette.png';
img.style.maxWidth = '20px';
img.style.maxHeight = '18px';
colorSelectButton.appendChild(img);
textareaContainer.appendChild(colorSelectButton);

// Create popup area for color selection
var colorPopup = document.createElement('div');
colorPopup.id = `colorPopup${currentCodeCounter1}`;
colorPopup.className = 'color-popup';
textareaContainer.appendChild(colorPopup);

// Populate popup with color options
colors.forEach(function(color) {
  var colorElement = document.createElement('div');
  colorElement.className = 'colorElement'; 
  colorElement.style.backgroundColor = color;

  colorElement.id = `colorOption${currentCodeCounter1}`;

  var numericPart = textareaContainer.id.match(/\d+/)[0];
  var correspondingShape = document.getElementById(`shape${numericPart}`);
    var borderDiv = correspondingShape.querySelector('.menu2_1_border');
    borderDiv.id = `menu2_1_border${currentCodeCounter1}`;
    var backgroundDiv = correspondingShape.querySelector('.menu2_1_background');
    backgroundDiv.id = `menu2_1_background${currentCodeCounter1}`;

  colorElement.addEventListener('click', function() {    
    if (borderDiv) {
      borderDiv.style.cssText = `text-align: center; align-items: center; display: flex; font-size: calc(0.5vw + 5pt); width: 100%; text-align: left; border: medium solid ${color}; border-left-width: 0 !important; word-wrap: break-word;`;
    }
    if (backgroundDiv) {
      backgroundDiv.style.backgroundColor = color;
    }
    colorPopup.style.display = 'none'; // Hide popup after selection
  });
  colorPopup.appendChild(colorElement);
});

//ICON---- Create button for opening image selection grid
var imageSelectButton = document.createElement('button');
imageSelectButton.id = `imageSelectButton${currentCodeCounter1}`;
imageSelectButton.className = 'imageSelectButtonClass';
const img2 = document.createElement("img");
img2.src = 'https://grahamandsergei.github.io/app/school_FILL0_wght400_GRAD200_opsz48.png';
img2.style.maxWidth = '20px';
img2.style.maxHeight = '18px';
imageSelectButton.appendChild(img2);
textareaContainer.appendChild(imageSelectButton);

// Create popup area for image selection
var imagePopup = document.createElement('div');
imagePopup.id = `imagePopup${currentCodeCounter1}`;
imagePopup.className = 'image-popup';
imagePopup.style.display = 'none'; // Initially hidden
textareaContainer.appendChild(imagePopup);

// Populate popup with images
images.forEach(function(image) {
  var imgElement = document.createElement('img');
  imgElement.src = image.url;
  imgElement.alt = image.alt;
  imgElement.className = 'popup-image';
  imgElement.id = `imageOption${currentCodeCounter1}`;

  var numericPart = textareaContainer.id.match(/\d+/)[0];
  var correspondingShape = document.getElementById(`shape${numericPart}`);
  var imageToReplace = correspondingShape.querySelector('.menu2_1_image');
  imageToReplace.id = `menu2_1_image${currentCodeCounter1}`;

  imgElement.addEventListener('click', function() {
    // Update the src of the corresponding shape's image
    if (imageToReplace) {
      imageToReplace.src = image.url;
    }
    imagePopup.style.display = 'none'; // Hide popup after selection
  });
  imagePopup.appendChild(imgElement);
});

					// Create text area for the first menu item text
					var textAreaOne = document.createElement('input');
					textAreaOne.type = 'text';
					textAreaOne.id = `textAreaOne${codeCounter1}`;
					textAreaOne.placeholder = 'e.g. Topic or Week';
					textAreaOne.value = ''; // Set the default value if needed
          textAreaOne.style.width = '40%';

					textAreaOne.addEventListener('input', function () {
					var menuElementId = `menuItemOne${currentCodeCounter1}`;
						console.log("Targeting element with ID:", menuElementId);
						// Update the displayed text
						var menuElement = document.getElementById(menuElementId);
						if (menuElement) {
							menuElement.textContent = this.value || "Topic/Week";
						}
						// Update the value attribute so it's included in innerHTML
						this.setAttribute('value', this.value);
						// Call your update and save functions
						updateTemplateContent(auth.currentUser.uid, `shape${uniqueIdCounter}.menuItemOne`, this.value);
						 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
					});
          textareaContainer.appendChild(textAreaOne);


					// Create text area for the first menu item URL
					var textAreaHrefsOne = document.createElement('input');
					textAreaHrefsOne.type = 'text';
					textAreaHrefsOne.id = `textAreaHrefsOne${codeCounter1}`;
					textAreaHrefsOne.placeholder = 'URL';
					textAreaHrefsOne.value = ''; // Set the default value if needed
          textAreaHrefsOne.style.width = '40%';

					textAreaHrefsOne.addEventListener('input', function () {
					var menuElementId = `menuItemOne${currentCodeCounter1}`;
						console.log("Targeting element with ID:", menuElementId);
						var anchorElement = document.getElementById(menuElementId);
						if (anchorElement) {
							anchorElement.href = this.value || "https://instructure.com/";
						}
						// Call your update and save functions
						updateTemplateContent(auth.currentUser.uid, `shape${uniqueIdCounter}.menuItemOneHref`, this.value);
						 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
					});
					textareaContainer.appendChild(textAreaHrefsOne);


// COLOR----- Create button for opening color selection palette
var colorSelectButtonTwo = document.createElement('button');
colorSelectButtonTwo.id = `colorSelectButtonTwo${currentCodeCounter2}`;
colorSelectButtonTwo.className = 'colorSelectButtonClass2';
const img1_2 = document.createElement("img");
img1_2.src = 'https://grahamandsergei.github.io/app/palette.png';
img1_2.style.maxWidth = '20px';
img1_2.style.maxHeight = '18px';
colorSelectButtonTwo.appendChild(img1_2);
textareaContainer.appendChild(colorSelectButtonTwo);

// Create popup area for color selection
var colorPopupTwo = document.createElement('div');
colorPopupTwo.id = `colorPopupTwo${currentCodeCounter2}`;
colorPopupTwo.className = 'color-popup2';
textareaContainer.appendChild(colorPopupTwo);


// Populate popup with color options
colors.forEach(function(color2) {
  var colorElementTwo = document.createElement('div');
  colorElementTwo.className = 'colorElementTwo';
  colorElementTwo.style.backgroundColor = color2;
  colorElementTwo.id = `colorOptionTwo${currentCodeCounter2}`;

  var numericPart2 = textareaContainer.id.match(/\d+/)[0];
  var correspondingShape2 = document.getElementById(`shape${numericPart2}`);
    var borderDiv2 = correspondingShape2.querySelector('.menu2_2_border');
    borderDiv2.id = `menu2_2_border${currentCodeCounter2}`;
    var backgroundDiv2 = correspondingShape2.querySelector('.menu2_2_background');
    backgroundDiv2.id = `menu2_2_background${currentCodeCounter2}`;

  colorElementTwo.addEventListener('click', function() {    
    if (borderDiv2) {
      borderDiv2.style.cssText = `text-align: center; align-items: center; display: flex; font-size: calc(0.5vw + 5pt); width: 100%; text-align: left; border: medium solid ${color2}; border-left-width: 0 !important; word-wrap: break-word;`;
    }
    if (backgroundDiv2) {
      backgroundDiv2.style.backgroundColor = color2;
    }
    colorPopupTwo.style.display = 'none'; // Hide popup after selection
  });
  colorPopupTwo.appendChild(colorElementTwo);
});

//ICON---- Create button for opening image selection grid
var imageSelectButtonTwo = document.createElement('button');
imageSelectButtonTwo.id = `imageSelectButtonTwo${currentCodeCounter2}`;
imageSelectButtonTwo.className = 'imageSelectButtonClass2';
const img2_2 = document.createElement("img");
img2_2.src = 'https://grahamandsergei.github.io/app/school_FILL0_wght400_GRAD200_opsz48.png';
img2_2.style.maxWidth = '20px';
img2_2.style.maxHeight = '18px';
imageSelectButtonTwo.appendChild(img2_2);
textareaContainer.appendChild(imageSelectButtonTwo);

// Create popup area for image selection
var imagePopupTwo = document.createElement('div');
imagePopupTwo.id = `imagePopupTwo${currentCodeCounter2}`;
imagePopupTwo.className = 'image-popup2';
imagePopupTwo.style.display = 'none'; // Initially hidden
textareaContainer.appendChild(imagePopupTwo);


// Populate popup with images
images.forEach(function(image2) {
  var imgElementTwo = document.createElement('img');
  imgElementTwo.src = image2.url;
  imgElementTwo.alt = image2.alt;
  imgElementTwo.className = 'popup-image2';
  imgElementTwo.id = `imageOptionTwo${currentCodeCounter2}`;

  var numericPart2 = textareaContainer.id.match(/\d+/)[0];
  var correspondingShape2 = document.getElementById(`shape${numericPart2}`);
  var imageToReplace2 = correspondingShape2.querySelector('.menu2_2_image');
  imageToReplace2.id = `menu2_2_image${currentCodeCounter2}`;

  imgElementTwo.addEventListener('click', function() {
    // Update the src of the corresponding shape's image
    if (imageToReplace2) {
      imageToReplace2.src = image2.url;
    }
    imagePopupTwo.style.display = 'none'; // Hide popup after selection
  });
  imagePopupTwo.appendChild(imgElementTwo);
});

var colorSelectButtonThree = document.createElement('div');
var imageSelectButtonThree = document.createElement('div');
var colorSelectButtonSection = document.createElement('div');

function setupPopupToggle(button, popupPrefix) {
    button.addEventListener('click', function(event) {
        event.stopPropagation();

        // Determine the target popup
        const numericPart = this.id.match(/\d+/)[0];
        const targetPopupId = `${popupPrefix}${numericPart}`;
        const targetPopup = document.getElementById(targetPopupId);

        // Check if the target popup is already displayed
        if (targetPopup.style.display === 'flex') {
            // If so, close it and return early to avoid reopening it
            targetPopup.style.display = 'none';
            return; // Prevent further execution of the function
        }

        // Close all popups first
        document.querySelectorAll('.image-popup, .image-popup2, .color-popup, .color-popup2, .image-popup3, .color-popup3, .color-popup-section').forEach(popup => {
            popup.style.display = 'none';
        });

        // Open the target popup
        targetPopup.style.display = 'flex';
    });
}

// Setup event listeners for each button (assuming the button variables are already defined)
setupPopupToggle(colorSelectButton, 'colorPopup');
setupPopupToggle(imageSelectButton, 'imagePopup');
setupPopupToggle(colorSelectButtonTwo, 'colorPopupTwo');
setupPopupToggle(imageSelectButtonTwo, 'imagePopupTwo');
setupPopupToggle(colorSelectButtonThree, 'colorPopupThree');
setupPopupToggle(imageSelectButtonThree, 'imagePopupThree');
setupPopupToggle(colorSelectButtonSection, 'colorPopupSection');

					// Create text area for the first menu item text
					var textAreaTwo = document.createElement('input');
					textAreaTwo.type = 'text';
					textAreaTwo.id = `textAreaTwo${codeCounter2}`;
					textAreaTwo.placeholder = 'e.g. Topic or Week';
					textAreaTwo.value = ''; // Set the default value if needed
          textAreaTwo.style.width = '40%';

					textAreaTwo.addEventListener('input', function () {
					var menuElementId = `menuItemTwo${currentCodeCounter2}`;
						console.log("Targeting element with ID:", menuElementId);
						var menuElement = document.getElementById(menuElementId);
						if (menuElement) {
							menuElement.textContent = this.value || "Topic/Week";
						}
						// Update the value attribute so it's included in innerHTML
						this.setAttribute('value', this.value);
						// Call your update and save functions
						updateTemplateContent(auth.currentUser.uid, `shape${uniqueIdCounter}.menuItemTwo`, this.value);
						 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
						
					});
					textareaContainer.appendChild(textAreaTwo);

					// Create text area for the first menu item URL
					var textAreaHrefsTwo = document.createElement('input');
					textAreaHrefsTwo.type = 'text';
					textAreaHrefsTwo.id = `textAreaHrefsTwo${codeCounter2}`;
					textAreaHrefsTwo.placeholder = 'URL';
					textAreaHrefsTwo.value = ''; // Set the default value if needed
          textAreaHrefsTwo.style.width = '40%';

					textAreaHrefsTwo.addEventListener('input', function () {
					var menuElementId = `menuItemTwo${currentCodeCounter2}`;
						console.log("Targeting element with ID:", menuElementId);
						var anchorElement = document.getElementById(menuElementId);
						if (anchorElement) {
							anchorElement.href = this.value || "https://instructure.com/";
						}
						// Call your update and save functions
						updateTemplateContent(auth.currentUser.uid, `shape${uniqueIdCounter}.menuItemTwoHref`, this.value);
						 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
					});
					textareaContainer.appendChild(textAreaHrefsTwo);
				}  else if (shape.classList.contains("menu3")) {
					const menuPElement = document.createElement("p");
					menuPElement.innerText = "MENU OF 3";
          menuPElement.style.fontWeight = "bold";
          menuPElement.style.color = "#171b70";
					textareaContainer.appendChild(menuPElement);

// COLOR----- Create button for opening color selection palette
var colorSelectButton = document.createElement('button');
colorSelectButton.id = `colorSelectButton${currentCodeCounter1}`;
colorSelectButton.className = 'colorSelectButtonClass';
const img = document.createElement("img");
img.src = 'https://grahamandsergei.github.io/app/palette.png';
img.style.maxWidth = '20px';
img.style.maxHeight = '18px';
colorSelectButton.appendChild(img);
textareaContainer.appendChild(colorSelectButton);

// Create popup area for color selection
var colorPopup = document.createElement('div');
colorPopup.id = `colorPopup${currentCodeCounter1}`;
colorPopup.className = 'color-popup';
textareaContainer.appendChild(colorPopup);

// Populate popup with color options
colors.forEach(function(color) {
  var colorElement = document.createElement('div');
  colorElement.className = 'colorElement'; 
  colorElement.style.backgroundColor = color;

  colorElement.id = `colorOption${currentCodeCounter1}`;

  var numericPart = textareaContainer.id.match(/\d+/)[0];
  var correspondingShape = document.getElementById(`shape${numericPart}`);
    var borderDiv = correspondingShape.querySelector('.menu2_1_border');
    borderDiv.id = `menu2_1_border${currentCodeCounter1}`;
    var backgroundDiv = correspondingShape.querySelector('.menu2_1_background');
    backgroundDiv.id = `menu2_1_background${currentCodeCounter1}`;

  colorElement.addEventListener('click', function() {    
    if (borderDiv) {
      borderDiv.style.cssText = `text-align: center; align-items: center; display: flex; font-size: calc(0.5vw + 5pt); width: 100%; text-align: left; border: medium solid ${color}; border-left-width: 0 !important; word-wrap: break-word;`;
    }
    if (backgroundDiv) {
      backgroundDiv.style.backgroundColor = color;
    }
    colorPopup.style.display = 'none'; // Hide popup after selection
  });
  colorPopup.appendChild(colorElement);
});

//ICON---- Create button for opening image selection grid
var imageSelectButton = document.createElement('button');
imageSelectButton.id = `imageSelectButton${currentCodeCounter1}`;
imageSelectButton.className = 'imageSelectButtonClass';
const img2 = document.createElement("img");
img2.src = 'https://grahamandsergei.github.io/app/school_FILL0_wght400_GRAD200_opsz48.png';
img2.style.maxWidth = '20px';
img2.style.maxHeight = '18px';
imageSelectButton.appendChild(img2);
textareaContainer.appendChild(imageSelectButton);

// Create popup area for image selection
var imagePopup = document.createElement('div');
imagePopup.id = `imagePopup${currentCodeCounter1}`;
imagePopup.className = 'image-popup';
imagePopup.style.display = 'none'; // Initially hidden
textareaContainer.appendChild(imagePopup);

// Populate popup with images
images.forEach(function(image) {
  var imgElement = document.createElement('img');
  imgElement.src = image.url;
  imgElement.alt = image.alt;
  imgElement.className = 'popup-image';
  imgElement.id = `imageOption${currentCodeCounter1}`;

  var numericPart = textareaContainer.id.match(/\d+/)[0];
  var correspondingShape = document.getElementById(`shape${numericPart}`);
  var imageToReplace = correspondingShape.querySelector('.menu2_1_image');
  imageToReplace.id = `menu2_1_image${currentCodeCounter1}`;

  imgElement.addEventListener('click', function() {
    // Update the src of the corresponding shape's image
    if (imageToReplace) {
      imageToReplace.src = image.url;
    }
    imagePopup.style.display = 'none'; // Hide popup after selection
  });
  imagePopup.appendChild(imgElement);
});
	
					// Create text area for the first menu item text
					var textAreaOneE = document.createElement('input');
					textAreaOneE.type = 'text';
					textAreaOneE.id = `textAreaOneE${codeCounter1}`;
					textAreaOneE.placeholder = 'e.g. Topic or Week';
					textAreaOneE.value = ''; // Set the default value if needed
          textAreaOneE.style.width = '40%';

					textAreaOneE.addEventListener('input', function () {
					var menuElementId = `menuItemOneE${currentCodeCounter1}`;
						console.log("Targeting element with ID:", menuElementId);
						// Update the displayed text
						var menuElement = document.getElementById(menuElementId);
						if (menuElement) {
							menuElement.textContent = this.value || "Topic/Week";
						}
						// Update the value attribute so it's included in innerHTML
						this.setAttribute('value', this.value);
						// Call your update and save functions
						updateTemplateContent(auth.currentUser.uid, `shape${uniqueIdCounter}.menuItemOneE`, this.value);
						 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
					});
					textareaContainer.appendChild(textAreaOneE);

					// Create text area for the first menu item URL
					var textAreaHrefsOneE = document.createElement('input');
					textAreaHrefsOneE.type = 'text';
					textAreaHrefsOneE.id = `textAreaHrefsOneE${codeCounter1}`;
					textAreaHrefsOneE.placeholder = 'URL';
					textAreaHrefsOneE.value = ''; // Set the default value if needed
          textAreaHrefsOneE.style.width = '40%';

					textAreaHrefsOneE.addEventListener('input', function () {
					var menuElementId = `menuItemOneE${currentCodeCounter1}`;
						console.log("Targeting element with ID:", menuElementId);
						var anchorElement = document.getElementById(menuElementId);
						if (anchorElement) {
							anchorElement.href = this.value || "https://instructure.com/";
						}
						// Call your update and save functions
						updateTemplateContent(auth.currentUser.uid, `shape${uniqueIdCounter}.menuItemOneHrefE`, this.value);
						 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
					});
					textareaContainer.appendChild(textAreaHrefsOneE);








// COLOR----- Create button for opening color selection palette
var colorSelectButtonTwo = document.createElement('button');
colorSelectButtonTwo.id = `colorSelectButtonTwo${currentCodeCounter2}`;
colorSelectButtonTwo.className = 'colorSelectButtonClass2';
const img1_2 = document.createElement("img");
img1_2.src = 'https://grahamandsergei.github.io/app/palette.png';
img1_2.style.maxWidth = '20px';
img1_2.style.maxHeight = '18px';
colorSelectButtonTwo.appendChild(img1_2);
textareaContainer.appendChild(colorSelectButtonTwo);

// Create popup area for color selection
var colorPopupTwo = document.createElement('div');
colorPopupTwo.id = `colorPopupTwo${currentCodeCounter2}`;
colorPopupTwo.className = 'color-popup2';
textareaContainer.appendChild(colorPopupTwo);


// Populate popup with color options
colors.forEach(function(color2) {
  var colorElementTwo = document.createElement('div');
  colorElementTwo.className = 'colorElementTwo';
  colorElementTwo.style.backgroundColor = color2;
  colorElementTwo.id = `colorOptionTwo${currentCodeCounter2}`;

  var numericPart2 = textareaContainer.id.match(/\d+/)[0];
  var correspondingShape2 = document.getElementById(`shape${numericPart2}`);
    var borderDiv2 = correspondingShape2.querySelector('.menu2_2_border');
    borderDiv2.id = `menu2_2_border${currentCodeCounter2}`;
    var backgroundDiv2 = correspondingShape2.querySelector('.menu2_2_background');
    backgroundDiv2.id = `menu2_2_background${currentCodeCounter2}`;

  colorElementTwo.addEventListener('click', function() {    
    if (borderDiv2) {
      borderDiv2.style.cssText = `text-align: center; align-items: center; display: flex; font-size: calc(0.5vw + 5pt); width: 100%; text-align: left; border: medium solid ${color2}; border-left-width: 0 !important; word-wrap: break-word;`;
    }
    if (backgroundDiv2) {
      backgroundDiv2.style.backgroundColor = color2;
    }
    colorPopupTwo.style.display = 'none'; // Hide popup after selection
  });
  colorPopupTwo.appendChild(colorElementTwo);
});

//ICON---- Create button for opening image selection grid
var imageSelectButtonTwo = document.createElement('button');
imageSelectButtonTwo.id = `imageSelectButtonTwo${currentCodeCounter2}`;
imageSelectButtonTwo.className = 'imageSelectButtonClass2';
const img2_2 = document.createElement("img");
img2_2.src = 'https://grahamandsergei.github.io/app/school_FILL0_wght400_GRAD200_opsz48.png';
img2_2.style.maxWidth = '20px';
img2_2.style.maxHeight = '18px';
imageSelectButtonTwo.appendChild(img2_2);
textareaContainer.appendChild(imageSelectButtonTwo);

// Create popup area for image selection
var imagePopupTwo = document.createElement('div');
imagePopupTwo.id = `imagePopupTwo${currentCodeCounter2}`;
imagePopupTwo.className = 'image-popup2';
imagePopupTwo.style.display = 'none'; // Initially hidden
textareaContainer.appendChild(imagePopupTwo);


// Populate popup with images
images.forEach(function(image2) {
  var imgElementTwo = document.createElement('img');
  imgElementTwo.src = image2.url;
  imgElementTwo.alt = image2.alt;
  imgElementTwo.className = 'popup-image2';
  imgElementTwo.id = `imageOptionTwo${currentCodeCounter2}`;

  var numericPart2 = textareaContainer.id.match(/\d+/)[0];
  var correspondingShape2 = document.getElementById(`shape${numericPart2}`);
  var imageToReplace2 = correspondingShape2.querySelector('.menu2_2_image');
  imageToReplace2.id = `menu2_2_image${currentCodeCounter2}`;

  imgElementTwo.addEventListener('click', function() {
    // Update the src of the corresponding shape's image
    if (imageToReplace2) {
      imageToReplace2.src = image2.url;
    }
    imagePopupTwo.style.display = 'none'; // Hide popup after selection
  });
  imagePopupTwo.appendChild(imgElementTwo);
});


          


					// Create text area for the first menu item text
					var textAreaTwoE = document.createElement('input');
					textAreaTwoE.type = 'text';
					textAreaTwoE.id = `textAreaTwoE${codeCounter2}`;
					textAreaTwoE.placeholder = 'e.g. Topic or Week';
					textAreaTwoE.value = ''; // Set the default value if needed
          textAreaTwoE.style.width = '40%';

					textAreaTwoE.addEventListener('input', function () {
					var menuElementId = `menuItemTwoE${currentCodeCounter2}`;
						console.log("Targeting element with ID:", menuElementId);
						var menuElement = document.getElementById(menuElementId);
						if (menuElement) {
							menuElement.textContent = this.value || "Topic/Week";
						}
						// Update the value attribute so it's included in innerHTML
						this.setAttribute('value', this.value);
						// Call your update and save functions
						updateTemplateContent(auth.currentUser.uid, `shape${uniqueIdCounter}.menuItemTwoE`, this.value);
						 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
						
					});
					textareaContainer.appendChild(textAreaTwoE);

					// Create text area for the first menu item URL
					var textAreaHrefsTwoE = document.createElement('input');
					textAreaHrefsTwoE.type = 'text';
					textAreaHrefsTwoE.id = `textAreaHrefsTwoE${codeCounter2}`;
					textAreaHrefsTwoE.placeholder = 'URL';
					textAreaHrefsTwoE.value = ''; // Set the default value if needed
          textAreaHrefsTwoE.style.width = '40%';

					textAreaHrefsTwoE.addEventListener('input', function () {
					var menuElementId = `menuItemTwoE${currentCodeCounter2}`;
						console.log("Targeting element with ID:", menuElementId);
						var anchorElement = document.getElementById(menuElementId);
						if (anchorElement) {
							anchorElement.href = this.value || "https://instructure.com/";
						}
						// Call your update and save functions
						updateTemplateContent(auth.currentUser.uid, `shape${uniqueIdCounter}.menuItemTwoHrefE`, this.value);
						 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
					});
					textareaContainer.appendChild(textAreaHrefsTwoE);




// COLOR----- Create button for opening color selection palette
var colorSelectButtonThree = document.createElement('button');
colorSelectButtonThree.id = `colorSelectButtonThree${currentCodeCounter3}`;
colorSelectButtonThree.className = 'colorSelectButtonClass3';
const img1_3 = document.createElement("img");
img1_3.src = 'https://grahamandsergei.github.io/app/palette.png';
img1_3.style.maxWidth = '20px';
img1_3.style.maxHeight = '18px';
colorSelectButtonThree.appendChild(img1_3);
textareaContainer.appendChild(colorSelectButtonThree);

// Create popup area for color selection
var colorPopupThree = document.createElement('div');
colorPopupThree.id = `colorPopupThree${currentCodeCounter3}`;
colorPopupThree.className = 'color-popup3';
textareaContainer.appendChild(colorPopupThree);


// Populate popup with color options
colors.forEach(function(color3) {
  var colorElementThree = document.createElement('div');
  colorElementThree.className = 'colorElementThree';
  colorElementThree.style.backgroundColor = color3;
  colorElementThree.id = `colorOptionThree${currentCodeCounter2}`;

  var numericPart3 = textareaContainer.id.match(/\d+/)[0];
  var correspondingShape3 = document.getElementById(`shape${numericPart3}`);
    var borderDiv3 = correspondingShape3.querySelector('.menu2_3_border');
    borderDiv3.id = `menu2_3_border${currentCodeCounter3}`;
    var backgroundDiv3 = correspondingShape3.querySelector('.menu2_3_background');
    backgroundDiv3.id = `menu2_3_background${currentCodeCounter3}`;

    colorElementThree.addEventListener('click', function() {    
    if (borderDiv3) {
      borderDiv3.style.cssText = `text-align: center; align-items: center; display: flex; font-size: calc(0.5vw + 5pt); width: 100%; text-align: left; border: medium solid ${color3}; border-left-width: 0 !important; word-wrap: break-word;`;
    }
    if (backgroundDiv3) {
      backgroundDiv3.style.backgroundColor = color3;
    }
    colorPopupThree.style.display = 'none'; // Hide popup after selection
  });
  colorPopupThree.appendChild(colorElementThree);
});

//ICON---- Create button for opening image selection grid
var imageSelectButtonThree = document.createElement('button');
imageSelectButtonThree.id = `imageSelectButtonThree${currentCodeCounter3}`;
imageSelectButtonThree.className = 'imageSelectButtonClass3';
const img2_3 = document.createElement("img");
img2_3.src = 'https://grahamandsergei.github.io/app/school_FILL0_wght400_GRAD200_opsz48.png';
img2_3.style.maxWidth = '20px';
img2_3.style.maxHeight = '18px';
imageSelectButtonThree.appendChild(img2_3);
textareaContainer.appendChild(imageSelectButtonThree);

// Create popup area for image selection
var imagePopupThree = document.createElement('div');
imagePopupThree.id = `imagePopupThree${currentCodeCounter3}`;
imagePopupThree.className = 'image-popup3';
imagePopupThree.style.display = 'none'; // Initially hidden
textareaContainer.appendChild(imagePopupThree);


// Populate popup with images
images.forEach(function(image3) {
  var imgElementThree = document.createElement('img');
  imgElementThree.src = image3.url;
  imgElementThree.alt = image3.alt;
  imgElementThree.className = 'popup-image3';
  imgElementThree.id = `imageOptionThree${currentCodeCounter3}`;

  var numericPart3 = textareaContainer.id.match(/\d+/)[0];
  var correspondingShape3 = document.getElementById(`shape${numericPart3}`);
  var imageToReplace3 = correspondingShape3.querySelector('.menu2_3_image');
  imageToReplace3.id = `menu2_3_image${currentCodeCounter3}`;

  imgElementThree.addEventListener('click', function() {
    // Update the src of the corresponding shape's image
    if (imageToReplace3) {
      imageToReplace3.src = image3.url;
    }
    imagePopupThree.style.display = 'none'; // Hide popup after selection
  });
  imagePopupThree.appendChild(imgElementThree);
});


var colorSelectButtonSection = document.createElement('div');

function setupPopupToggle(button, popupPrefix) {
    button.addEventListener('click', function(event) {
        event.stopPropagation();

        // Determine the target popup
        const numericPart = this.id.match(/\d+/)[0];
        const targetPopupId = `${popupPrefix}${numericPart}`;
        const targetPopup = document.getElementById(targetPopupId);

        // Check if the target popup is already displayed
        if (targetPopup.style.display === 'flex') {
            // If so, close it and return early to avoid reopening it
            targetPopup.style.display = 'none';
            return; // Prevent further execution of the function
        }

        // Close all popups first
        document.querySelectorAll('.image-popup, .image-popup2, .color-popup, .color-popup2, .image-popup3, .color-popup3, .color-popup-section').forEach(popup => {
            popup.style.display = 'none';
        });

        // Open the target popup
        targetPopup.style.display = 'flex';

         if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
    });
}

// Setup event listeners for each button (assuming the button variables are already defined)
setupPopupToggle(colorSelectButton, 'colorPopup');
setupPopupToggle(imageSelectButton, 'imagePopup');
setupPopupToggle(colorSelectButtonTwo, 'colorPopupTwo');
setupPopupToggle(imageSelectButtonTwo, 'imagePopupTwo');
setupPopupToggle(colorSelectButtonThree, 'colorPopupThree');
setupPopupToggle(imageSelectButtonThree, 'imagePopupThree');
setupPopupToggle(colorSelectButtonSection, 'colorPopupSection');


					// Create text area for the first menu item text
					var textAreaThreeE = document.createElement('input');
					textAreaThreeE.type = 'text';
					textAreaThreeE.id = `textAreaThreeE${codeCounter3}`;
					textAreaThreeE.placeholder = 'e.g. Topic or Week';
					textAreaThreeE.value = ''; // Set the default value if needed
          textAreaThreeE.style.width = '40%';

					textAreaThreeE.addEventListener('input', function () {
					var menuElementId = `menuItemThreeE${currentCodeCounter3}`;
						console.log("Targeting element with ID:", menuElementId);
						var menuElement = document.getElementById(menuElementId);
						if (menuElement) {
							menuElement.textContent = this.value || "Topic/Week";
						}
						// Update the value attribute so it's included in innerHTML
						this.setAttribute('value', this.value);
						// Call your update and save functions
						updateTemplateContent(auth.currentUser.uid, `shape${uniqueIdCounter}.menuItemThreeE`, this.value);
						 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
						
					});
					textareaContainer.appendChild(textAreaThreeE);

					// Create text area for the first menu item URL
					var textAreaHrefsThreeE = document.createElement('input');
					textAreaHrefsThreeE.type = 'text';
					textAreaHrefsThreeE.id = `textAreaHrefsThreeE${codeCounter3}`;
					textAreaHrefsThreeE.placeholder = 'URL';
					textAreaHrefsThreeE.value = ''; // Set the default value if needed
          textAreaHrefsThreeE.style.width = '40%';

					textAreaHrefsThreeE.addEventListener('input', function () {
					var menuElementId = `menuItemThreeE${currentCodeCounter3}`;
						console.log("Targeting element with ID:", menuElementId);
						var anchorElement = document.getElementById(menuElementId);
						if (anchorElement) {
							anchorElement.href = this.value || "https://instructure.com/";
						}
						// Call your update and save functions
						updateTemplateContent(auth.currentUser.uid, `shape${uniqueIdCounter}.menuItemThreeHrefE`, this.value);
						 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
					});
					textareaContainer.appendChild(textAreaHrefsThreeE);
          

				} else if (shape.classList.contains("imageUpload")) {
					const pElement = document.createElement("p");
          pElement.innerText = "IMAGE";
          pElement.style.fontWeight = "bold";
          pElement.style.color = "#171b70";
					textareaContainer.appendChild(pElement);

          const plusminusLabel = document.createElement('div');
          plusminusLabel.className = 'plusminusLabel';
          plusminusLabel.id = `plusminusLabel${uniqueIdCounter}`;

					// Create the hidden file input
					const fileInput = document.createElement("input");
					fileInput.id = `file-upload${uniqueIdCounter}`;
					fileInput.type = "file";
					fileInput.accept = "image/jpeg, image/png, image/gif";
					fileInput.className = "hidden-file-input-image";
					fileInput.addEventListener("change", function(event) {
						handleImageUpload(event, firstPlaceholder, plusminusLabel);
					});

					// Create the label which will act as the upload button
					const fileLabel = document.createElement("label");
					fileLabel.htmlFor = fileInput.id; // Associate the label with the file input using the id
					fileLabel.className = "upload-button";
					fileLabel.innerText = "Upload Image";

          const fileLabelSmall = document.createElement("p");
          fileLabelSmall.innerText = "(Accepted formats: jpeg, png, gif. Max. size: 5MB)";
          fileLabelSmall.style.margin = "0 0 0 0";
          fileLabelSmall.style.fontSize = "10px";
          fileLabelSmall.style.fontWeight = "normal";
          fileLabel.appendChild(fileLabelSmall);

					// Append the file input and label to the textarea container
					textareaContainer.appendChild(fileInput);
					textareaContainer.appendChild(fileLabel);

          const addFromStorage = document.createElement('div');
          addFromStorage.className = 'image-upload-storage-button';
          addFromStorage.innerText = 'Select Image from Storage';
          addFromStorage.id = `file-select${uniqueIdCounter}`;
          addFromStorage.addEventListener("click", function() {
            listAndSelectImages(firstPlaceholder, plusminusLabel);
            openImageStorage();
        });
          textareaContainer.appendChild(addFromStorage);
          textareaContainer.appendChild(plusminusLabel);

        function openImageStorage() {
            const storageDiv = document.getElementById('image-storage-content'); 
            storageDiv.style.display = 'block';
        }

					 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
} // Call saveTemplate to save after each change.


				} else if (shape.classList.contains("accordion")) {
				
					const pElement = document.createElement("p");
					pElement.innerText = "ACCORDION ITEM";
          pElement.style.fontWeight = "bold";
          pElement.style.color = "#171b70";
					textareaContainer.appendChild(pElement);

// COLOR----- Create button for opening color selection palette
var colorSelectButtonAccordion = document.createElement('button');
colorSelectButtonAccordion.id = `colorSelectButtonAccordion${uniqueIdCounter}`;
colorSelectButtonAccordion.className = 'colorSelectButtonClassAccordion';
const img = document.createElement("img");
img.src = 'https://grahamandsergei.github.io/app/palette.png';
img.style.maxWidth = '20px';
img.style.maxHeight = '18px';
colorSelectButtonAccordion.appendChild(img);
textareaContainer.appendChild(colorSelectButtonAccordion);

// Create popup area for color selection
var colorPopupAccordion = document.createElement('div');
colorPopupAccordion.id = `colorPopupAccordion${uniqueIdCounter}`;
colorPopupAccordion.className = 'color-popup-accordion';
textareaContainer.appendChild(colorPopupAccordion);

// Populate popup with color options
colors.forEach(function(colorAccordion) {
  var colorElementAccordion = document.createElement('div');
  colorElementAccordion.className = 'colorElementAccordion'; 
  colorElementAccordion.style.backgroundColor = colorAccordion;

  colorElementAccordion.id = `colorOptionAccordion${uniqueIdCounter}`;

  var numericPart = textareaContainer.id.match(/\d+/)[0];
  var correspondingShape = document.getElementById(`shape${numericPart}`);


    colorElementAccordion.addEventListener('click', function() {    
    if (correspondingShape) {
      correspondingShape.style.backgroundColor = colorAccordion;
    }
    colorPopupAccordion.style.display = 'none'; // Hide popup after selection
  });
  colorPopupAccordion.appendChild(colorElementAccordion);
});

var colorSelectButton = document.createElement('div');
var imageSelectButton = document.createElement('div');
var colorSelectButtonTwo = document.createElement('div');
var imageSelectButtonTwo = document.createElement('div');
var colorSelectButtonThree = document.createElement('div');
var imageSelectButtonThree = document.createElement('div');
var colorSelectButtonSection = document.createElement('div');
var colorSelectButtonTitle = document.createElement('div');

function setupPopupToggle(button, popupPrefix) {
    button.addEventListener('click', function(event) {
        event.stopPropagation();

        // Determine the target popup
        const numericPart = this.id.match(/\d+/)[0];
        const targetPopupId = `${popupPrefix}${numericPart}`;
        const targetPopup = document.getElementById(targetPopupId);

        // Check if the target popup is already displayed
        if (targetPopup.style.display === 'flex') {
            // If so, close it and return early to avoid reopening it
            targetPopup.style.display = 'none';
            return; // Prevent further execution of the function
        }

        // Close all popups first
        document.querySelectorAll('.image-popup, .image-popup2, .color-popup, .color-popup2, .image-popup3, .color-popup3, .color-popup-section, .color-popup-title, .color-popup-accordion').forEach(popup => {
            popup.style.display = 'none';
        });

        // Open the target popup
        targetPopup.style.display = 'flex';

         if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
    });
}

// Setup event listeners for each button (assuming the button variables are already defined)
setupPopupToggle(colorSelectButton, 'colorPopup');
setupPopupToggle(imageSelectButton, 'imagePopup');
setupPopupToggle(colorSelectButtonTwo, 'colorPopupTwo');
setupPopupToggle(imageSelectButtonTwo, 'imagePopupTwo');
setupPopupToggle(colorSelectButtonThree, 'colorPopupThree');
setupPopupToggle(imageSelectButtonThree, 'imagePopupThree');
setupPopupToggle(colorSelectButtonSection, 'colorPopupSection');
setupPopupToggle(colorSelectButtonTitle, 'colorPopupTitle');
setupPopupToggle(colorSelectButtonAccordion, 'colorPopupAccordion');

					const summaryId = `firstplaceholder${uniqueIdCounter}`;
					const tabId = `secondplaceholder${uniqueIdCounter}`;

					const firstTextarea = document.createElement("input");
					firstTextarea.style.width = "90%";
					firstTextarea.style.marginBottom = "5px";
					firstTextarea.id = `firsttextarea${uniqueIdCounter}`;
					firstTextarea.type = "text";
					firstTextarea.placeholder = "Add Title";
					firstTextarea.addEventListener("input", function() {
						document.getElementById(summaryId).textContent = firstTextarea.value;
						// Update the value attribute so it's included in innerHTML
						firstTextarea.setAttribute('value', firstTextarea.value);
						updateTemplateContent(auth.currentUser.uid, `shape${uniqueIdCounter}.summary`, firstTextarea.value);
						 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
} // Call saveTemplate to save after each change.
					});

          
          const secondTextarea = document.createElement("textarea");
						secondTextarea.id = `secondtextarea${uniqueIdCounter}`;
						secondTextarea.placeholder = "Add Details";
						secondTextarea.addEventListener("input", function() {
						  secondPlaceholder.innerText = secondTextarea.value || "Accordion details will appear here";
						  // Update the text content so it's included in innerHTML
						  secondTextarea.textContent = secondTextarea.value;
						updateTemplateContent(auth.currentUser.uid, `shape${uniqueIdCounter}.secondPlaceholder`, secondTextarea.value);
                     if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
} // Call saveTemplate to save after each change.
					});

					textareaContainer.style.display = "block";
					textareaContainer.appendChild(firstTextarea);
					textareaContainer.appendChild(secondTextarea);
				} else if (shape.className.includes("flashcardStack")) {
					const pTitle = document.createElement("p");
					pTitle.innerText = "FLASHCARD DECK";
          pTitle.style.fontWeight = "bold";
          pTitle.style.color = "#171b70";
					pTitle.style.fontWeight = "bold";
					textareaContainer.appendChild(pTitle);

          

					
					// Specific handling for flashcardStack
					var flashcardCounter = 1;
					const addButton = document.createElement("button");
					addButton.innerText = "Add Another Flashcard";
					addButton.className = "add-textarea-pair-btn";
					addButton.id = `flashcardButton${uniqueIdCounter}`;

					// Append the addButton first to ensure it's in the DOM for reference
					textareaContainer.appendChild(addButton);

					// Initial paragraph element
					const pElement = document.createElement("p");
					pElement.innerText = "FLASHCARD " + flashcardCounter;
					pElement.style.marginTop = "5px";
					pElement.style.marginBottom = "0px";
          pElement.style.fontSize = "10px";
          pElement.style.color = "#171b70";
					textareaContainer.insertBefore(pElement, addButton); // Insert before the addButton

					addButton.addEventListener("click", function() {
						flashcardCounter++;
						const newPElement = document.createElement("p");
						newPElement.innerText = "FLASHCARD " + flashcardCounter;
						newPElement.style.marginTop = "5px";
						newPElement.style.marginBottom = "0px";
            newPElement.style.fontSize = "10px";
            newPElement.style.color = "#171b70";

						textareaContainer.insertBefore(newPElement, addButton); // Insert new elements before the addButton

						appendTextareasToContainer(textareaContainer, shape, isBanner, addButton); // Modified function call
					});

					appendTextareasToContainer(textareaContainer, shape, isBanner, addButton); // Initial call to add textareas

					 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}

				} else if (shape.classList.contains("videoUpload")) {
          const pElement = document.createElement("p");
          pElement.innerText = "VIDEO";
          pElement.style.fontWeight = "bold";
          pElement.style.color = "#171b70";
					textareaContainer.appendChild(pElement);

					const fileInput = document.createElement("input");
					fileInput.id = `file-upload${uniqueIdCounter}`;
					fileInput.type = "file";
					fileInput.accept = "video/mp4, video/avi, video/mov";
					fileInput.className = "hidden-file-input-video";
					fileInput.addEventListener("change", function(event) {
						handleVideoUpload(event, firstPlaceholder, textareaContainer);
					});

					const fileLabel = document.createElement("label");
					fileLabel.htmlFor = fileInput.id;
					fileLabel.className = "upload-button";
					fileLabel.innerText = "Upload Video";

          const fileLabelSmall = document.createElement("p");
          fileLabelSmall.innerText = "(Accepted formats: mp4, avi, mov. Max. size: 100MB)";
          fileLabelSmall.style.margin = "0 0 0 0";
          fileLabelSmall.style.fontSize = "10px";
          fileLabelSmall.style.fontWeight = "normal";
          fileLabel.appendChild(fileLabelSmall);

					textareaContainer.appendChild(fileInput);
					textareaContainer.appendChild(fileLabel);

          const addFromStorage = document.createElement('div');
          addFromStorage.className = 'video-upload-storage-button';
          addFromStorage.innerText = 'Select Video from Storage';
          addFromStorage.id = `file-select${uniqueIdCounter}`;
          addFromStorage.addEventListener("click", function() {
            listAndSelectVideos(firstPlaceholder, textareaContainer);
            openVideoStorage();
        });
          textareaContainer.appendChild(addFromStorage);

        function openVideoStorage() {
            const storageDiv = document.getElementById('video-storage-content'); 
            storageDiv.style.display = 'block';
        }



				} else if (shape.classList.contains("audioUpload")) {
          const pElement = document.createElement("p");
          pElement.innerText = "AUDIO";
          pElement.style.fontWeight = "bold";
          pElement.style.color = "#171b70";
					textareaContainer.appendChild(pElement);
					const fileInput = document.createElement("input");
					fileInput.id = `file-upload${uniqueIdCounter}`;
					fileInput.type = "file";
					fileInput.accept = "audio/mpeg, audio/aac";
					fileInput.className = "hidden-file-input-audio";
					fileInput.addEventListener("change", function(event) {
						handleAudioUpload(event, firstPlaceholder, textareaContainer);
					});
					const fileLabel = document.createElement("label");
					fileLabel.htmlFor = fileInput.id;
					fileLabel.className = "upload-button";
					fileLabel.innerText = "Upload Audio";

          const fileLabelSmall = document.createElement("p");
          fileLabelSmall.innerText = "(Accepted formats: mp3, aac. Max. size: 100MB)";
          fileLabelSmall.style.margin = "0 0 0 0";
          fileLabelSmall.style.fontSize = "10px";
          fileLabelSmall.style.fontWeight = "normal";
          fileLabel.appendChild(fileLabelSmall);

					textareaContainer.appendChild(fileInput);
					textareaContainer.appendChild(fileLabel);

          
          const addFromStorage = document.createElement('div');
          addFromStorage.className = 'audio-upload-storage-button';
          addFromStorage.innerText = 'Select Audio from Storage';
          addFromStorage.id = `file-select${uniqueIdCounter}`;
          addFromStorage.addEventListener("click", function() {
            listAndSelectAudios(firstPlaceholder, textareaContainer);
            openAudioStorage();
        });
          textareaContainer.appendChild(addFromStorage);

        function openAudioStorage() {
            const storageDiv = document.getElementById('audio-storage-content'); 
            storageDiv.style.display = 'block';
        }

				} else if (shape.classList.contains("emptyLine")) {
          const pElement = document.createElement("p");
          pElement.innerText = "EMPTY LINE";
          pElement.style.fontWeight = "bold";
          pElement.style.color = "#171b70";
					textareaContainer.appendChild(pElement);
				} else if (shape.className.includes("quizClass")) {
					const pTitle = document.createElement("p");
					pTitle.innerText = "MCQ QUIZ";
          pTitle.style.fontWeight = "bold";
          pTitle.style.color = "#171b70";
					pTitle.style.fontWeight = "bold";
					textareaContainer.appendChild(pTitle);

          
					// Specific handling for flashcardStack
					var flashcardCounter = 1;
					const addButton = document.createElement("button");
					addButton.innerText = "Add Another Question";
					addButton.className = "add-another-question-btn";
					addButton.id = `flashcardButton${uniqueIdCounter}`;

					// Append the addButton first to ensure it's in the DOM for reference
					textareaContainer.appendChild(addButton);

					// Initial paragraph element
					const pElement = document.createElement("p");
					pElement.innerText = "QUESTION " + flashcardCounter;
					pElement.style.marginTop = "5px";
					pElement.style.marginBottom = "0px";
          pElement.style.fontSize = "10px";
          pElement.style.color = "#171b70";
					textareaContainer.insertBefore(pElement, addButton); // Insert before the addButton

					addButton.addEventListener("click", function() {
						flashcardCounter++;
						const newPElement = document.createElement("p");
						newPElement.innerText = "QUESTION " + flashcardCounter;
						newPElement.style.marginTop = "5px";
						newPElement.style.marginBottom = "0px";
            newPElement.style.fontSize = "10px";
            newPElement.style.color = "#171b70";

						textareaContainer.insertBefore(newPElement, addButton); // Insert new elements before the addButton

						appendQuizTextareasToContainer(textareaContainer, shape, isBanner, addButton); // Modified function call
             if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
					});

					appendQuizTextareasToContainer(textareaContainer, shape, isBanner, addButton); // Initial call to add textareas

					 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}

				}
			
			container.appendChild(textareaContainer);
			 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
			return textareaContainer;
		}


    window.appendQuizTextareasToContainer = function(textareaContainer, shape, isBanner, addButton) {

const sliderContainer = shape.querySelector(".flashcard-slider");

// Create flashcard container
const flashcardContainer = document.createElement("div");
flashcardContainer.className = "flashcard-container";
flashcardContainer.id = `flashcard${uniqueIdCounter}`;


// Create a new placeholder
const firstPlaceholder = document.createElement("div");
firstPlaceholder.className = "flashcard-quiz";
firstPlaceholder.id = `firstplaceholder${uniqueIdCounter}`;
firstPlaceholder.innerText = "Question Text";
flashcardContainer.appendChild(firstPlaceholder);


//NEW NEW NEW TO REINIT
// Adjust the font size for the initial content
function adjustFontSizeToFit(container, maxFontSizeVw = 1.8, minFontSizeVw = 0.3, stepVw = 0.1) {
// Obtain the current height of the container.
const currentHeight = container.offsetHeight;
let currentFontSize = maxFontSizeVw;
container.style.fontSize = `${currentFontSize}vw`;

// Adjust font size based on container's current height instead of a fixed maxHeightPx
while ((container.scrollHeight > currentHeight) && currentFontSize > minFontSizeVw) {
  currentFontSize -= stepVw;
  container.style.fontSize = `${currentFontSize}vw`;
}
}
window.addEventListener('resize', () => {
adjustFontSizeToFit(firstPlaceholder);
});

// Creating a MutationObserver to watch for changes in the text content
const observer = new MutationObserver((mutations) => {
mutations.forEach((mutation) => {
  if (mutation.type === "characterData" || mutation.type === "childList") {
  adjustFontSizeToFit(firstPlaceholder);
  }
});
});

// Configuration object for the observer
const config = { characterData: true, childList: true, subtree: true };

// Start observing the firstPlaceholder for changes in its text content
observer.observe(firstPlaceholder, config);


textareaContainer.insertBefore(flashcardContainer, addButton);


// Append textareas
const firstTextarea = document.createElement("input");
firstTextarea.type = 'text';
firstTextarea.id = `firsttextarea${uniqueIdCounter}`;
firstTextarea.placeholder = "Question Text (Set the correct answer with a radio button below)";
firstTextarea.style.width = "100%";
firstTextarea.style.marginBottom = "5px";
firstTextarea.setAttribute ('data-quizTextarea', 'quizTextarea');
firstTextarea.addEventListener("input", function() {
// Query all divs to persist
const divsToPersist = firstPlaceholder.querySelectorAll('.quizLabel');
const nextToPersist = firstPlaceholder.querySelectorAll('.slick-next-button');

// Clear the firstPlaceholder but keep the divs to persist
while (firstPlaceholder.firstChild) {
  firstPlaceholder.removeChild(firstPlaceholder.firstChild);
}
// Now, create a text node for the new input value and append it
const textNode = document.createTextNode(firstTextarea.value || "Question Text");
firstPlaceholder.appendChild(textNode);

  // Re-add the divs to persist
  divsToPersist.forEach(div => {
  firstPlaceholder.appendChild(div.cloneNode(true));
});
  // Re-add the next button to persist
  nextToPersist.forEach(div => {
  firstPlaceholder.append(div.cloneNode(true));
});
 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
});


  // Insert the front text input before the addButton
textareaContainer.insertBefore(firstTextarea, addButton);

var inputID = firstTextarea.id.match(/\d+$/)[0];

const optionInputsContainer = document.createElement('div');
optionInputsContainer.className = 'optionInputsContainerClass';
optionInputsContainer.id = 'optionInputsContainer' + inputID;

const input1 = document.createElement("input");
input1.className = "quizOption";
input1.type = 'text';
input1.id = `option1`;
input1.name = "inputLabel" + inputID;
const input2 = document.createElement("input");
input2.className = "quizOption";
input2.type = 'text';
input2.id = `option2`;
input2.name = "inputLabel" + inputID;
const input3 = document.createElement("input");
input3.className = "quizOption";
input3.type = 'text';
input3.id = `option3`;
input3.name = "inputLabel" + inputID;
const input4 = document.createElement("input");
input4.className = "quizOption";
input4.type = 'text';
input4.id = `option4`;
input4.name = "inputLabel" + inputID;


//if inputCheckbox selected, then inputCheckbox.name -> selectAll(.flashcard-container where the numeric part of its id="flashcardNumber" = selected inputCheckbox's numeric name's number) find in that flashcard-container if the quizRadioButton with data-numeric-id = the numeric part of optionCheckbox's ID --IS-- selected, then give the quizRadioButton an ID = 'correct'. in the end count quizRadioButtons with ID = 'correct' + highlight correct and selected answers.

const inputOneCheckbox = document.createElement("input");
inputOneCheckbox.className = "quizOptionCheckbox";
inputOneCheckbox.id = `optionCheckbox1`;
inputOneCheckbox.type = "radio";
inputOneCheckbox.name = "inputCheckbox" + inputID;
inputOneCheckbox.setAttribute('data-checked', 'false');

const inputTwoCheckbox = document.createElement("input");
inputTwoCheckbox.className = "quizOptionCheckbox";
inputTwoCheckbox.id = `optionCheckbox2`;
inputTwoCheckbox.type = "radio";
inputTwoCheckbox.name = "inputCheckbox" + inputID;
inputTwoCheckbox.setAttribute('data-checked', 'false');

const inputThreeCheckbox = document.createElement("input");
inputThreeCheckbox.className = "quizOptionCheckbox";
inputThreeCheckbox.id = `optionCheckbox3`;
inputThreeCheckbox.type = "radio";
inputThreeCheckbox.name = "inputCheckbox" + inputID;
inputThreeCheckbox.setAttribute('data-checked', 'false');

const inputFourCheckbox = document.createElement("input");
inputFourCheckbox.className = "quizOptionCheckbox";
inputFourCheckbox.id = `optionCheckbox4`;
inputFourCheckbox.type = "radio";
inputFourCheckbox.name = "inputCheckbox" + inputID;
inputFourCheckbox.setAttribute('data-checked', 'false');

optionInputsContainer.appendChild(inputOneCheckbox);
optionInputsContainer.appendChild(input1);
optionInputsContainer.appendChild(inputTwoCheckbox);
optionInputsContainer.appendChild(input2);
optionInputsContainer.appendChild(inputThreeCheckbox);
optionInputsContainer.appendChild(input3);
optionInputsContainer.appendChild(inputFourCheckbox);
optionInputsContainer.appendChild(input4);

textareaContainer.insertBefore(optionInputsContainer, firstTextarea.nextSibling);

// Event listeners for radio buttons
const radioButtons = optionInputsContainer.querySelectorAll('.quizOptionCheckbox'); // Make sure this is the correct class for your radio buttons

radioButtons.forEach(radioButton => {
// Add event listener for change events
radioButton.addEventListener('change', function() {

  // Set all radio buttons' data-checked attribute to 'false'
  radioButtons.forEach(r => {
      r.setAttribute('data-checked', 'false');
  });
  
  // Set the data-checked attribute of the currently checked radio button to 'true'
  if (this.checked) {
      this.setAttribute('data-checked', 'true');
  }
});
});




//CREATES RADIO BUTTONS IN RIGHT COLUMN WHEN ONE GETS CREATED IN LEFT COLUMN
const inputs = optionInputsContainer.querySelectorAll('.quizOption');

inputs.forEach(input => {
// Attach event listeners without re-appending inputs to textareaContainer.
input.addEventListener('input', () => {
  let text = input.value.trim();
  const numericId = input.id.match(/\d+$/)[0];
  let radioButton = firstPlaceholder.querySelector(`input[data-numeric-id="${numericId}"]`);
  let label = firstPlaceholder.querySelector(`label[data-numeric-id="${numericId}"]`);

  if (text) {
      if (!radioButton) {
          radioButton = document.createElement('input');
          radioButton.type = 'radio';
          radioButton.name = 'dynamicRadio' + inputID;
          radioButton.className = 'quizRadioButton';
          radioButton.dataset.numericId = numericId;

          label = document.createElement('label');
          label.dataset.numericId = numericId;
          label.className = 'quizLabel';
          label.appendChild(radioButton);
          label.append(text);

          let inserted = false;
          const allLabels = firstPlaceholder.querySelectorAll('label');
          allLabels.forEach((existingLabel) => {
              const existingNumericId = existingLabel.dataset.numericId;
              if (parseInt(numericId) < parseInt(existingNumericId) && !inserted) {
                firstPlaceholder.insertBefore(label, existingLabel);
                  inserted = true;
              }
          });

          const nextButton = firstPlaceholder.querySelector('.slick-next-button');

          if (!inserted) {
                if (nextButton) {
  // If the Next button exists, insert the label before the Next button
                firstPlaceholder.insertBefore(label, nextButton);
            } else {
                // Otherwise, append the label as the last child
                firstPlaceholder.appendChild(label);
            }

          }
      } else {
          label.childNodes[1].nodeValue = text;
      }
  } else if (label) {
      label.remove();
  }

  const observer = new MutationObserver(mutations => {
  mutations.forEach(mutation => {
      if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
          mutation.addedNodes.forEach(node => {
              if (node.nodeType === Node.ELEMENT_NODE && node.classList.contains('quizRadioButton')) {
                  console.log('New radio button added:', node);
                  updateRadioButtons();
              }
          });
      }
  });
});

// Configuration of the observer:
const config = { childList: true, subtree: true };

// Start observing the document body for added nodes
observer.observe(document.body, config);




// Event listeners for checkboxes
const checkboxes = document.querySelectorAll('.quizOptionCheckbox');
checkboxes.forEach(checkbox => {
  checkbox.addEventListener('change', updateRadioButtons);
});

function updateRadioButtons() {
  checkboxes.forEach(checkbox => {
      if (checkbox.checked) {
          const numericID = parseInt(checkbox.id.match(/\d+/)[0], 10);
          const numericName = parseInt(checkbox.name.match(/\d+/)[0], 10);
          const targetName = 'dynamicRadio' + numericName;
          const radios = document.querySelectorAll(`.quizRadioButton[name="${targetName}"]`);

          radios.forEach(radio => {
              if (parseInt(radio.dataset.numericId, 10) === numericID) {
                  radio.id = 'true';
                  console.log(`ID 'true' applied to radio button with ID ${radio.id}`);
              } else {
                  radio.id = 'false'; 
                  console.log(`ID cleared from radio button`);
              }
          });
      }
  });
}

// Call initially to set up any radios already on the page
updateRadioButtons();
});

});





// Check if Slick has been initialized on the sliderContainer
if ($(sliderContainer).hasClass('slick-initialized')) {
  // Create a jQuery object wrapping the flashcardContainer for slickAdd
  var $newSlide = $(flashcardContainer);
  // Add the fully prepared flashcardContainer as a new slide
  $(sliderContainer).slick('slickAdd', $newSlide);

  // Go to the newly added slide
  var newIndex = $(sliderContainer).slick('getSlick').slideCount - 1;
  $(sliderContainer).slick('slickGoTo', newIndex, true);
// After adding the new slide, call addNextButtonToLastSlide
addNextButtonToLastSlide(sliderContainer);
} else {
// If Slick is not initialized, just append the container and initialize Slick
sliderContainer.appendChild(flashcardContainer);
initializeQuizSlick(sliderContainer);
}
uniqueIdCounter = Math.floor(Math.random() * 1000000000);
 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}

}




// Function to add the 'Next' button only to the last slide
function addNextButtonToLastSlide(sliderContainer) {
// First, remove 'Next' buttons from all slides
$(sliderContainer).find('.slick-next-button').remove();

var inputID = sliderContainer.id.match(/\d+$/)[0];
const buttonNext = document.createElement('button');
buttonNext.type = 'button';
buttonNext.className = 'slick-next-button';
buttonNext.id = 'slick-next-button' + inputID;
buttonNext.innerText = 'CHECK';

// Then, add the 'Next' button only to the last slide
var $lastSlide = $(sliderContainer).find('.flashcard-quiz').last();
$lastSlide.append(buttonNext);
}



function initializeQuizSlick(sliderContainer) {
// Check if Slick has not been initialized
if (!$(sliderContainer).hasClass('slick-initialized')) {
  // Initialize Slick Slider
  $(sliderContainer).slick({
      dots: false,
      infinite: false,
      speed: 300,
      slidesToShow: 1,
      adaptiveHeight: true,
      arrows: true,
  });

  $(sliderContainer).attr('data-type', 'quiz');

  // Instead of adding a 'Next' button to each slide, add it only to the last slide
  addNextButtonToLastSlide(sliderContainer);

  // Bind click event to Next button using event delegation
$(sliderContainer).on('click', '.slick-next-button', function() {
// Extract the numeric part from the button's ID
var numericID = this.id.match(/\d+$/)[0];

// Find the div with ID 'shape' concatenated with numericID
var targetDiv = $('#shape' + numericID);

  // Find all inputs within targetDiv and change their parent label's text color to black
targetDiv.find('input').each(function() {
  $(this).parent('label').css('color', 'black');
});

// Find all checked inputs within targetDiv and change their parent label's text color to red
targetDiv.find('input:checked').each(function() {
  $(this).parent('label').css('color', 'red');
});

// Find all inputs within targetDiv with ID 'true' and change their parent label's text color to green
targetDiv.find('input[id="true"]').each(function() {
  $(this).parent('label').css('color', 'green');
});

// Find all checked inputs within targetDiv whose ID is 'true'
var correctAnswers = targetDiv.find('input[id="true"]:checked').length;

// Find the number of .flashcard-container divs within targetDiv
var numberOfQuestions = targetDiv.find('input[id="true"]').length;
if (numberOfQuestions === 0){
numberOfQuestions = 1;
}
//var numberOfSlides = targetDiv.find('.flashcard-container').length;

// Calculate the percentage of correct answers
var percentCorrectAnswers = Math.round((correctAnswers / numberOfQuestions) * 100);

var targetFlashcardContainer = $(this).closest('div[id^="firstplaceholder"]');

// Remove any existing popup
targetFlashcardContainer.find('.popup').remove();

// Create a new popup element with the score information
var popup = $('<div class="popup" style="position: absolute; width: 80%; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #f5f5f5; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px #777777; text-align: center; z-index: 100000;">' +
            '<p>Correct answers: ' + correctAnswers + '</p>' +
            '<p style="margin-bottom: 0">Your score: ' + percentCorrectAnswers + '%</p>' +
            '</div>');

// Append the popup to the targetDiv
targetFlashcardContainer.append(popup);

// Close the popup when clicking outside of it
$(document).on('click', function(event) {
  if (!$(event.target).closest('.popup').length && !$(event.target).is('.slick-next-button')) {
      $('.popup').remove();
  }
});
});


}
}


window.appendTextareasToContainer = function(textareaContainer, shape, isBanner, addButton) {

			const sliderContainer = shape.querySelector(".flashcard-slider");

			// Create flashcard container
			const flashcardContainer = document.createElement("div");
			flashcardContainer.className = "flashcard-container";
			flashcardContainer.id = `flashcard${uniqueIdCounter}`;

			// Add click event listener to toggle the 'flipped' class
			flashcardContainer.addEventListener('click', function() {
				flashcardContainer.classList.toggle('flipped');
				 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
			});



//NEW NEW NEW FO REINIT


function adjustFontSizeToFit(container, maxFontSizeVw = 2, minFontSizeVw = 0.3, stepVw = 0.1) {
    // Obtain the current height of the container.
    const currentHeight = container.offsetHeight;
    let currentFontSize = maxFontSizeVw;
    container.style.fontSize = `${currentFontSize}vw`;

    // Adjust font size based on container's current height instead of a fixed maxHeightPx
    while ((container.scrollHeight > currentHeight) && currentFontSize > minFontSizeVw) {
        currentFontSize -= stepVw;
        container.style.fontSize = `${currentFontSize}vw`;
    }
}

var numericPartfirstFlashcard = textareaContainer.id.match(/\d+/)[0];
var firstFlashcardFront = document.getElementById(`firstplaceholder${numericPartfirstFlashcard}`);

// Create a new placeholder
const firstPlaceholder = document.createElement("div");
firstPlaceholder.className = "flashcard-front";
firstPlaceholder.id = `firstplaceholder${uniqueIdCounter}`;
firstPlaceholder.innerText = "Front Text";



if (firstFlashcardFront) {
    // If an existing placeholder is found, use its border color
    var existingBorderColor = window.getComputedStyle(firstFlashcardFront).borderColor;
    firstPlaceholder.style.borderColor = existingBorderColor;
} else {
    // If no existing placeholder is found, use a default color
    firstPlaceholder.style.borderColor = "#171b70";
}

flashcardContainer.appendChild(firstPlaceholder);


//NEW NEW NEW TO REINIT
// Adjust the font size for the initial content
adjustFontSizeToFit(firstPlaceholder);

// Creating a MutationObserver to watch for changes in the text content
const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
        if (mutation.type === "characterData" || mutation.type === "childList") {
            adjustFontSizeToFit(firstPlaceholder);
        }
    });
});

// Configuration object for the observer
const config = { characterData: true, childList: true, subtree: true };

// Start observing the firstPlaceholder for changes in its text content
observer.observe(firstPlaceholder, config);






var firstFlashcardBack = document.getElementById(`secondplaceholder${numericPartfirstFlashcard}`);

			const secondPlaceholder = document.createElement("div");
			secondPlaceholder.className = "flashcard-back";
			secondPlaceholder.id = `secondplaceholder${uniqueIdCounter}`;
			secondPlaceholder.innerText = "Back Text";

      if (firstFlashcardBack) {
    // If an existing placeholder is found, use its border color
    var existingBorderColor = window.getComputedStyle(firstFlashcardBack).borderColor;
    secondPlaceholder.style.borderColor = existingBorderColor;
} else {
    // If no existing placeholder is found, use a default color
    secondPlaceholder.style.borderColor = "#171b70";
}

			flashcardContainer.appendChild(secondPlaceholder);

//NEW NEW NEW TO REINIT
// Adjust the font size for the initial content
adjustFontSizeToFit(secondPlaceholder);

// Creating a MutationObserver to watch for changes in the text content
const observer2 = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
        if (mutation.type === "characterData" || mutation.type === "childList") {
            adjustFontSizeToFit(secondPlaceholder);
        }
    });
});

// Configuration object for the observer
const config2 = { characterData: true, childList: true, subtree: true };

// Start observing the secondPlaceholder for changes in its text content
observer2.observe(secondPlaceholder, config2);
			
			textareaContainer.insertBefore(flashcardContainer, addButton);

			// Append textareas
			const firstTextarea = document.createElement("input");
			firstTextarea.type = 'text';
			firstTextarea.id = `firsttextarea${uniqueIdCounter}`;
			firstTextarea.placeholder = "Front Text";
			firstTextarea.style.width = "100%";
			firstTextarea.style.marginBottom = "5px";
			firstTextarea.addEventListener("input", function() {
				firstPlaceholder.innerText = firstTextarea.value || "Front Text";
				 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
			});
			
				// Insert the front text input before the addButton
			textareaContainer.insertBefore(firstTextarea, addButton);

			const secondTextarea = document.createElement("textarea");
			secondTextarea.id = `secondtextarea${uniqueIdCounter}`;
			secondTextarea.placeholder = "Back Text";
			secondTextarea.addEventListener("input", function() {
				secondPlaceholder.innerText = secondTextarea.value || "Back Text";
				 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
			});

			// Insert the back text input before the addButton
			textareaContainer.insertBefore(secondTextarea, addButton);
			
		// Check if Slick has been initialized on the sliderContainer
			if ($(sliderContainer).hasClass('slick-initialized')) {
				// Create a jQuery object wrapping the flashcardContainer for slickAdd
				var $newSlide = $(flashcardContainer);
				// Add the fully prepared flashcardContainer as a new slide
				$(sliderContainer).slick('slickAdd', $newSlide);

				// Go to the newly added slide
				var newIndex = $(sliderContainer).slick('getSlick').slideCount - 1;
				$(sliderContainer).slick('slickGoTo', newIndex, true);
			} else {
				// If Slick is not initialized, just append the container and initialize Slick
				sliderContainer.appendChild(flashcardContainer);
				initializeSlick(sliderContainer);
			}
			uniqueIdCounter = Math.floor(Math.random() * 1000000000);


//NEW NEW NEW FO REINIT

// Check if the color button already exists and remove it if it does
var existingButtonsFront = textareaContainer.querySelectorAll('.colorSelectButtonClassCardfront');
existingButtonsFront.forEach(function(button) {
    button.parentNode.removeChild(button);
});
var existingButtonsBack = textareaContainer.querySelectorAll('.colorSelectButtonClassCardback');
existingButtonsBack.forEach(function(button) {
    button.parentNode.removeChild(button);
});



//NEW NEW NEW FO REINIT

// COLOR----- Create button for opening color selection palette
var colorSelectButtonCardfront = document.createElement('button');
colorSelectButtonCardfront.id = `colorSelectButtonCardfront${uniqueIdCounter}`;
colorSelectButtonCardfront.className = 'colorSelectButtonClassCardfront';

const img = document.createElement("img");
img.src = 'https://grahamandsergei.github.io/app/palette.png';
img.style.maxWidth = '1.4vw';
img.style.maxHeight = '1vw';
img.style.marginRight = '0.4vw'; // Add some space between the img and the text
img.style.marginTop = '-0.1vw';
img.style.position = "relative";
img.style.display = "inline-block"; // Make the img display inline-block

colorSelectButtonCardfront.appendChild(img);

const colorSelectButtonClassCardfrontText = document.createElement("div");
colorSelectButtonClassCardfrontText.innerText = "Front Color";
colorSelectButtonClassCardfrontText.style.margin = "0"; // Remove default margins to align properly
colorSelectButtonClassCardfrontText.style.position = "relative";
colorSelectButtonClassCardfrontText.style.display = "inline-block"; 
colorSelectButtonCardfront.appendChild(colorSelectButtonClassCardfrontText);

textareaContainer.appendChild(colorSelectButtonCardfront);



//NEW NEW NEW FO REINIT

var existingPopups = textareaContainer.querySelectorAll('.color-popup-cardfront');
existingPopups.forEach(function(popup) {
    popup.parentNode.removeChild(popup);
});

// Create popup area for color selection
var colorPopupCardfront = document.createElement('div');
colorPopupCardfront.id = `colorPopupCardfront${uniqueIdCounter}`;
colorPopupCardfront.className = 'color-popup-cardfront';
textareaContainer.appendChild(colorPopupCardfront);

// Populate popup with color options
colors.forEach(function(colorCardfront) {
    var colorElementCardfront = document.createElement('div');
    colorElementCardfront.className = 'colorElementCardfront'; 
    colorElementCardfront.style.backgroundColor = colorCardfront;
  
    colorElementCardfront.id = `colorOptionCardfront${uniqueIdCounter}`;
  
    var numericPart = textareaContainer.id.match(/\d+/)[0];
    var correspondingShape = document.getElementById(`shape${numericPart}`);
    var allFrontcards = correspondingShape.querySelectorAll('.flashcard-front');
  
      colorElementCardfront.addEventListener('click', function() {    
      if (allFrontcards) {
        allFrontcards.forEach(front => {
              front.style.borderColor = colorCardfront;
          });
      }
      colorPopupCardfront.style.display = 'none'; // Hide popup after selection
    });
    colorPopupCardfront.appendChild(colorElementCardfront);
});



//NEW NEW NEW FO REINIT

// COLOR2----- Create button for opening color selection palette
var colorSelectButtonCardback = document.createElement('button');
colorSelectButtonCardback.id = `colorSelectButtonCardback${uniqueIdCounter}`;
colorSelectButtonCardback.className = 'colorSelectButtonClassCardback';

const imgBack = document.createElement("img");
imgBack.src = 'https://grahamandsergei.github.io/app/palette.png';

imgBack.style.maxWidth = '1.4vw';
imgBack.style.maxHeight = '1vw';
imgBack.style.marginRight = '0.4vw'; // Add some space between the img and the text
imgBack.style.marginTop = '-0.1vw';
imgBack.style.position = "relative";
imgBack.style.display = "inline-block"; // Make the img display inline-block

colorSelectButtonCardback.appendChild(imgBack);

const colorSelectButtonClassCardbackText = document.createElement("div");
colorSelectButtonClassCardbackText.innerText = "Back Color";
colorSelectButtonClassCardbackText.style.margin = "0"; // Remove default margins to align properly
colorSelectButtonClassCardbackText.style.position = "relative";
colorSelectButtonClassCardbackText.style.display = "inline-block"; 
colorSelectButtonCardback.appendChild(colorSelectButtonClassCardbackText);

textareaContainer.appendChild(colorSelectButtonCardback);


//NEW NEW NEW FO REINIT

var existingPopupsBack = textareaContainer.querySelectorAll('.color-popup-cardback');
existingPopupsBack.forEach(function(popup) {
    popup.parentNode.removeChild(popup);
});

// Create popup area for color selection
var colorPopupCardback = document.createElement('div');
colorPopupCardback.id = `colorPopupCardback${uniqueIdCounter}`;
colorPopupCardback.className = 'color-popup-cardback';
textareaContainer.appendChild(colorPopupCardback);

// Populate popup with color options
colors.forEach(function(colorCardback) {
    var colorElementCardback = document.createElement('div');
    colorElementCardback.className = 'colorElementCardback'; 
    colorElementCardback.style.backgroundColor = colorCardback;
  
    colorElementCardback.id = `colorOptionCardback${uniqueIdCounter}`;
  
    var numericPart = textareaContainer.id.match(/\d+/)[0];
    var correspondingShape = document.getElementById(`shape${numericPart}`);
    var allbackcards = correspondingShape.querySelectorAll('.flashcard-back');
  
      colorElementCardback.addEventListener('click', function() {    
      if (allbackcards) {
        allbackcards.forEach(back => {
              back.style.borderColor = colorCardback;
          });
      }
      colorPopupCardback.style.display = 'none'; // Hide popup after selection
    });
    colorPopupCardback.appendChild(colorElementCardback);
});

var colorSelectButton = document.createElement('div');
var imageSelectButton = document.createElement('div');
var colorSelectButtonTwo = document.createElement('div');
var imageSelectButtonTwo = document.createElement('div');
var colorSelectButtonThree = document.createElement('div');
var imageSelectButtonThree = document.createElement('div');
var colorSelectButtonSection = document.createElement('div');
var colorSelectButtonTitle = document.createElement('div');
var colorSelectButtonAccordion = document.createElement('div');

function setupPopupToggle(button, popupPrefix) {
    button.addEventListener('click', function(event) {
        event.stopPropagation();

        // Determine the target popup
        const numericPart = this.id.match(/\d+/)[0];
        const targetPopupId = `${popupPrefix}${numericPart}`;
        const targetPopup = document.getElementById(targetPopupId);

        // Check if the target popup is already displayed
        if (targetPopup.style.display === 'flex') {
            // If so, close it and return early to avoid reopening it
            targetPopup.style.display = 'none';
            return; // Prevent further execution of the function
        }

        // Close all popups first
        document.querySelectorAll('.image-popup, .image-popup2, .color-popup, .color-popup2, .image-popup3, .color-popup3, .color-popup-section, .color-popup-title, .color-popup-accordion, .color-popup-cardfront, .color-popup-cardback').forEach(popup => {
            popup.style.display = 'none';
        });

        // Open the target popup
        targetPopup.style.display = 'flex';

         if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
    });
}

// Setup event listeners for each button (assuming the button variables are already defined)
setupPopupToggle(colorSelectButton, 'colorPopup');
setupPopupToggle(imageSelectButton, 'imagePopup');
setupPopupToggle(colorSelectButtonTwo, 'colorPopupTwo');
setupPopupToggle(imageSelectButtonTwo, 'imagePopupTwo');
setupPopupToggle(colorSelectButtonThree, 'colorPopupThree');
setupPopupToggle(imageSelectButtonThree, 'imagePopupThree');
setupPopupToggle(colorSelectButtonSection, 'colorPopupSection');
setupPopupToggle(colorSelectButtonTitle, 'colorPopupTitle');
setupPopupToggle(colorSelectButtonAccordion, 'colorPopupAccordion');
setupPopupToggle(colorSelectButtonCardfront, 'colorPopupCardfront');
setupPopupToggle(colorSelectButtonCardback, 'colorPopupCardback');

			 if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}
		}


		function initializeSlick(sliderContainer) {
			// Initialize Slick Slider if it has not been initialized
			if (!$(sliderContainer).hasClass('slick-initialized')) {
				$(sliderContainer).slick({
					dots: false,
					infinite: false,
					speed: 300,
					slidesToShow: 1,
					adaptiveHeight: true
					// Add other options as needed
				});

        $(sliderContainer).attr('data-type', 'flashcard');

			}
		}

				function addButtonClickListener(button, container, shapeClass, placeholder, color, isBanner = false) {
					button.addEventListener("click", async function() {
					
					// Remove welcome messages if they exist
					const welcomeMessageLeft = document.getElementById("welcomeMessageLeft");
					const welcomeMessageRight = document.getElementById("welcomeMessageRight");
					if (welcomeMessageLeft) welcomeMessageLeft.remove();
					if (welcomeMessageRight) welcomeMessageRight.remove();

						const shape = createShape(shapeClass, placeholder, color, isBanner);
						rightColumn.appendChild(shape);

						if (shapeClass === "circle") {
							const firstPlaceholder = shape.querySelector(`#firstplaceholder${uniqueIdCounter}`);
							const secondPlaceholder = shape.querySelector(`#secondplaceholder${uniqueIdCounter}`);
							const textareaContainer = createTextarea(container, shape, firstPlaceholder, secondPlaceholder);
							textareaContainer.style.display = "block";
						} else if (isBanner) {
							const bannerPlaceholder = shape.querySelector('.banner-placeholder');
							const textareaContainer = createTextarea(container, shape, bannerPlaceholder, bannerPlaceholder, isBanner);
							textareaContainer.style.display = "block";
						} else if (shapeClass === "rich-editor") {
							const richEditorPlaceholder = shape.querySelector(`#richEditorPlaceholder${uniqueIdCounter}`);
							const textareaContainer = createTextarea(container, shape, richEditorPlaceholder, richEditorPlaceholder);
							textareaContainer.style.display = "block";								
						} else if (shapeClass === "square-blue"){
							const placeholderElement = shape.querySelector('.placeholderRedCircle');
							const textareaContainer = createTextarea(container, shape, placeholderElement, placeholderElement);
							textareaContainer.style.display = "block";
						} else if (shapeClass === "menu2") {
							const currentCodeCounter1 = codeCounter1;
							const currentCodeCounter2 = codeCounter2;
							const textareaContainer = createTextarea(container, shape, null, null, false, currentCodeCounter1, currentCodeCounter2);
							textareaContainer.style.display = "block";
						} else if (shapeClass === "menu3") {
							const currentCodeCounter1 = codeCounter1;
							const currentCodeCounter2 = codeCounter2;
							const currentCodeCounter3 = codeCounter3;
							const textareaContainer = createTextarea(container, shape, null, null, false, currentCodeCounter1, currentCodeCounter2, currentCodeCounter3);
							textareaContainer.style.display = "block";
						} else if (shapeClass === "imageUpload") {
							const firstPlaceholder = shape.querySelector(`#firstplaceholder${uniqueIdCounter}`);
							const textareaContainer = createTextarea(container, shape, firstPlaceholder);
							textareaContainer.style.display = "block";
						} else if (shapeClass === "accordion") {
							const firstPlaceholder = shape.querySelector(`#firstplaceholder${uniqueIdCounter}`);
							const secondPlaceholder = shape.querySelector(`#secondplaceholder${uniqueIdCounter}`);
							const textareaContainer = createTextarea(container, shape, firstPlaceholder, secondPlaceholder);
							textareaContainer.style.display = "block";
						} else if (shapeClass === "flashcardStack") {
							const firstPlaceholder = shape.querySelector(`#firstplaceholder${uniqueIdCounter}`);
							const secondPlaceholder = shape.querySelector(`#secondplaceholder${uniqueIdCounter}`);
							const textareaContainer = createTextarea(container, shape, firstPlaceholder, secondPlaceholder);
							textareaContainer.style.display = "block";
						} else if (shapeClass === "videoUpload") {
              const firstPlaceholder = shape.querySelector(`#firstplaceholder${uniqueIdCounter}`);
              const textareaContainer = createTextarea(container, shape, firstPlaceholder);
              textareaContainer.style.display = "block";
            } else if (shapeClass === "audioUpload") {
              const firstPlaceholder = shape.querySelector(`#firstplaceholder${uniqueIdCounter}`);
              const textareaContainer = createTextarea(container, shape, firstPlaceholder);
              textareaContainer.style.display = "block";
            } else if (shapeClass === "emptyLine") {
              const firstPlaceholder = shape.querySelector(`#firstplaceholder${uniqueIdCounter}`);
              const textareaContainer = createTextarea(container, shape, firstPlaceholder);
              textareaContainer.style.display = "block";
            } else if (shapeClass === "quizClass") {
							const firstPlaceholder = shape.querySelector(`#firstplaceholder${uniqueIdCounter}`);
							const textareaContainer = createTextarea(container, shape, firstPlaceholder);
							textareaContainer.style.display = "block";
						}
                // Append the new div to the column
    var columnLeft = document.getElementById("left-column");
    var columnRight = document.getElementById("right-column");
    columnLeft.scrollTop = columnLeft.scrollHeight;
    columnRight.scrollTop = columnRight.scrollHeight;



						uniqueIdCounter = Math.floor(Math.random() * 1000000000);
             if (!hasChanges) {
  hasChanges = true;
  updateSaveStatusToNo();
  console.log('hasChanges is set to TRUE');
}					
          }); 
				}
				const addRedButton = document.getElementById("addRedButton");
				const addBlueButton = document.getElementById("addBlueButton");
				const addBannerButton = document.getElementById("addBannerButton");
				const addRichEditorButton = document.getElementById("addRichEditorButton");
				const addMenu2Button = document.getElementById("addMenu2Button");
				const addMenu3Button = document.getElementById("addMenu3Button");
				const addImageButton = document.getElementById("addImageButton");
				const addAccordionButton = document.getElementById("addAccordionButton");
				const addFlashButton = document.getElementById("addFlashButton");
        const addVideoButton = document.getElementById("addVideoButton");      
        const addAudioButton = document.getElementById("addAudioButton");      
        const addBreakButton = document.getElementById("addBreakButton");
        const addQuizButton = document.getElementById("addQuizButton");

					// Now call the addButtonClickListener function with the correct parameters
				   addButtonClickListener(addRedButton, document.getElementById("left-column"), "circle", "Desc");
				   addButtonClickListener(addBlueButton, document.getElementById("left-column"), "square-blue", "SECTION TITLE", "#0066cc");
				   addButtonClickListener(addBannerButton, document.getElementById("left-column"), "banner", "", "#ffffff", true);
				   addButtonClickListener(addRichEditorButton, document.getElementById("left-column"), "rich-editor", "Your text will appear here..", "#ffffff");
				   addButtonClickListener(addMenu2Button, document.getElementById("left-column"), "menu2", "Desc", "#a80050");
				   addButtonClickListener(addMenu3Button, document.getElementById("left-column"), "menu3", "Desc", "#a80050");
				   addButtonClickListener(addImageButton, document.getElementById("left-column"), "imageUpload", "Desc", "#a80050");
				   addButtonClickListener(addAccordionButton, document.getElementById("left-column"), "accordion", "#e5e5e5");
				   addButtonClickListener(addFlashButton, document.getElementById("left-column"), "flashcardStack", "Desc", "#a80050");
           addButtonClickListener(addVideoButton, document.getElementById("left-column"), "videoUpload", "Desc", "#a80050");
           addButtonClickListener(addAudioButton, document.getElementById("left-column"), "audioUpload", "Desc", "#a80050");
           addButtonClickListener(addBreakButton, document.getElementById("left-column"), "emptyLine", "Desc", "#a80050");
				   addButtonClickListener(addQuizButton, document.getElementById("left-column"), "quizClass", "Desc", "#a80050");

           document.body.style.visibility = "visible";

				});
				
        function getMenu2Html(codeCounter1, codeCounter2) {
  return `<div style="margin-top: 10px; width: 100%; display: flex">
                <div class="customBootstrap1" style="width: 49%">
                    <div style="display: flex; text-align: center; align-items: center; margin-bottom: 10px; align-items: stretch; ">
                        <div class="menu2_1_border" style="text-align: center; align-items: center; display: flex; font-size: calc(0.5vw + 5pt); width: 100%; text-align: left; border: medium solid #171b70; border-left-width: 0; word-wrap: break-word;">                        
                          <div class="menu2_1_background" style="text-align: center; align-items: center; background-color: #171b70; width: 15%; flex-shrink: 0;"><img class="menu2_1_image" src="https://grahamandsergei.github.io/app/school_FILL0_wght400_GRAD200_opsz48.png" style="width:50%; height:auto; padding:5px 0;"></div>
<span style="color: #000000; padding-left: 0.8vw; flex-grow: 1; display: flex; align-items: center; max-width: 85%; overflow: hidden; text-overflow: ellipsis;"><a class="not_external" id="menuItemOne${codeCounter1}" href="https://universityofgalway.instructure.com" style="font-family: 'Arial', sans-serif; font-weight: semi-bold; color: #171b70 !important;">Topic / Week</a></span></div>
                    </div>
                </div>
                <div class="customBootstrap1" style="width: 49%; margin-left: 2%;">
                    <div style="display: flex; text-align: center; align-items: center; margin-bottom: 10px; align-items: stretch;">
                        <div class="menu2_2_border" style="text-align: center; align-items: center; display: flex; font-size: calc(0.5vw + 5pt); width: 100%; text-align: left; border: medium solid #171b70; border-left-width: 0; word-wrap: break-word;">                        
                          <div class="menu2_2_background" style="text-align: center; align-items: center; background-color: #171b70; width: 15%; flex-shrink: 0;"><img class="menu2_2_image" src="https://grahamandsergei.github.io/app/school_FILL0_wght400_GRAD200_opsz48.png" style="width:50%; height:auto; padding:5px 0;"></div>
<span style="color: #000000; padding-left: 0.8vw; flex-grow: 1; display: flex; align-items: center; max-width: 85%; overflow: hidden; text-overflow: ellipsis;"><a class="not_external" id="menuItemTwo${codeCounter2}" href="https://universityofgalway.instructure.com" style="font-family: 'Arial', sans-serif; font-weight: semi-bold; color: #171b70 !important;">Topic / Week</a></span></div>
                    </div>
                </div>
            </div>
        `;
}

function getMenu3Html(codeCounter1, codeCounter2, codeCounter3) {
	return `<div style="margin-top: 10px; width: 100%; display: flex">
    <div class="customBootstrap1" style="width: 32.33%">
                    <div style="display: flex; text-align: center; align-items: center; margin-bottom: 10px; align-items: stretch;">
                        <div class="menu2_1_border" style="text-align: center; align-items: center; display: flex; font-size: calc(0.5vw + 5pt); width: 100%; text-align: left; border: medium solid #171b70; border-left-width: 0; word-wrap: break-word;">                        
                          <div class="menu2_1_background" style="text-align: center; align-items: center; background-color: #171b70; width: 15%; flex-shrink: 0;"><img class="menu2_1_image" src="https://grahamandsergei.github.io/app/school_FILL0_wght400_GRAD200_opsz48.png" style="width:50%; height:auto; padding:5px 0;" /></div>
<span style="color: #000000; padding-left: 0.8vw; flex-grow: 1; display: flex; align-items: center; max-width: 85%; overflow: hidden; text-overflow: ellipsis;"><a class="not_external" id="menuItemOneE${codeCounter1}" href="https://universityofgalway.instructure.com" style="font-family: 'Arial', sans-serif; font-weight: semi-bold; color: #171b70 !important;">Topic / Week</a></span></div>
                    </div>
                </div>
                <div class="customBootstrap1" style="width: 32.33%; margin-left: 1.5%;">
                    <div style="display: flex; text-align: center; align-items: center; margin-bottom: 10px; align-items: stretch;">
                        <div class="menu2_2_border" style="text-align: center; align-items: center; display: flex; font-size: calc(0.5vw + 5pt); width: 100%; text-align: left; border: medium solid #171b70; border-left-width: 0; word-wrap: break-word;">                        
                          <div class="menu2_2_background" style="text-align: center; align-items: center; background-color: #171b70; width: 15%; flex-shrink: 0;"><img class="menu2_2_image" src="https://grahamandsergei.github.io/app/school_FILL0_wght400_GRAD200_opsz48.png" style="width:50%; height:auto; padding:5px 0;" /></div>
<span style="color: #000000; padding-left: 0.8vw; flex-grow: 1; display: flex; align-items: center; max-width: 85%; overflow: hidden; text-overflow: ellipsis;"><a class="not_external" id="menuItemTwoE${codeCounter2}" href="https://universityofgalway.instructure.com" style="font-family: 'Arial', sans-serif; font-weight: semi-bold; color: #171b70 !important;">Topic / Week</a></span></div>
                    </div>
                </div>
                <div class="customBootstrap1" style="width: 32.33%; margin-left: 1.5%;">
                    <div style="display: flex; text-align: center; align-items: center; margin-bottom: 10px; align-items: stretch;">
                        <div class="menu2_3_border" style="text-align: center; align-items: center; display: flex; font-size: calc(0.5vw + 5pt); width: 100%; text-align: left; border: medium solid #171b70; border-left-width: 0; word-wrap: break-word;">                        
                          <div class="menu2_3_background" style="text-align: center; align-items: center; background-color: #171b70; width: 15%; flex-shrink: 0;"><img class="menu2_3_image" src="https://grahamandsergei.github.io/app/school_FILL0_wght400_GRAD200_opsz48.png" style="width:50%; height:auto; padding:5px 0;" /></div>
<span style="color: #000000; padding-left: 0.8vw; flex-grow: 1; display: flex; align-items: center; max-width: 85%; overflow: hidden; text-overflow: ellipsis;"><a class="not_external" id="menuItemThreeE${codeCounter3}" href="https://universityofgalway.instructure.com" style="font-family: 'Arial', sans-serif; font-weight: semi-bold; color: #171b70 !important;">Topic / Week</a></span></div>
                    </div>
                </div>
            </div>
        `;
}			

// Example images - replace with actual images
var images = [
{ url: 'https://grahamandsergei.github.io/app/icons/menu_book_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/dictionary_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/local_library_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/forum_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://sergeimedvedev.com/modulesIcon.png', alt: 'Image 2' },
{ url: 'https://grahamandsergei.github.io/app/icons/article_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 7' },
{ url: 'https://grahamandsergei.github.io/app/icons/assignment_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/assignment_ind_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/assignment_late_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/quiz_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/assignment_turned_in_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/check_box_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/check_circle_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/task_alt_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/new_releases_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/check_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/priority_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/grading_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/fact_check_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/flag_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/home_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/folder_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/description_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/arrow_circle_right_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 6' },
{ url: 'https://grahamandsergei.github.io/app/icons/star_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/star_half_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/account_balance_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 3' },
{ url: 'https://grahamandsergei.github.io/app/icons/location_city_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/apartment_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 5' },
{ url: 'https://grahamandsergei.github.io/app/icons/monitoring_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/work_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/balance_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/gavel_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/alarm_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 4' },
{ url: 'https://grahamandsergei.github.io/app/icons/notifications_active_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/hourglass_top_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/history_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/calendar_month_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/event_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/pin_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/deployed_code_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/cognition_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/psychology_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/neurology_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/emoji_objects_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/eco_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/local_florist_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/diversity_3_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/group_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/hand_gesture_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/hail_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/thumb_up_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/mood_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/extension_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' }, 
{ url: 'https://grahamandsergei.github.io/app/icons/hub_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/share_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/list_alt_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/list_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/keyboard_alt_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/link_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/language_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/location_on_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/mail_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/send_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/sailing_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/sunny_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/imagesmode_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/library_music_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' },
{ url: 'https://grahamandsergei.github.io/app/icons/video_camera_front_FILL0_wght400_GRAD200_opsz48.png', alt: 'Image 1' }
];

var colors = [
    '#bf0a30',
    '#cc0000',
    '#e60000',
    '#ff0000',
    '#ff2c00',
    '#ff5800',
    '#ff8400',
    '#ffb000',
    '#ffdc00',
    '#f6fb00',
    '#cae500',
    '#9ecf00',
    '#72b900',
    '#46a300',
    '#1a8d00',
    '#007712',
    '#00613e',
    '#004b6a',
    '#003595',
    '#001fc1',
    '#0009ed',
    '#0d00f2',
    '#2300dc',
    '#3900c6',
    '#4f00b0',
    '#66009a',
    '#7c0084',
    '#8f128f',
    '#a228a2',
    '#b53fb5',
    '#c855c8',
    '#db6cdb',
    '#ee82ee',
    '#eb6cc0',
    '#E95793',
    '#DA0C81',
    '#CCCCCC',
    '#888888',
    '#666666',
    '#444444',
    '#222222',
    '#000000'
];		


    </script>


</head>
<body>

  <div class="navbar navbar-default" style="width:100%; margin-bottom: 0px; border-radius: 0px; border-bottom-width: 1px; border-bottom-color: #cbcbcb; min-height: 10vh;"> 
    <div class="navbar-header" style="position: absolute; top: 50%; transform: translateY(-50%); left: 0;">
        <a class="navbar-brand" style="color:#171b70d8 !important; font-family: Calibri; font-weight: bold;" href="https://www.sergeimedvedev.com">
            <img src="https://firebasestorage.googleapis.com/v0/b/authentication-app-21e51.appspot.com/o/assets%2FlogoSmall.png?alt=media&token=6075f9a0-c511-4534-938a-a97515bf01dc" 
                 style="line-height: 1; max-height: 30px; float: left; padding-right: 5px; margin: -5px 0 -5px 0">Pager
        </a>
    </div>
    <div style="position: absolute; top: 50%; transform: translateY(-50%); right: 2vw;">
        <ul class="nav navbar-nav navbar-right" style="display: flex; align-items: center;">
            <div style="display: flex; flex-direction: column; align-items: flex-end; position: relative;">
                <div id="account" style="margin-right: 10px;">Account</div>
            </div>
            <li><a href="#" id="logout" style="color:#171b70 !important;">Log Out</a></li>
        </ul>
    </div>
</div>
<div id="accountOverlay">
  <div id="userEmail"></div>
  <div id="deleteAccount">Delete Account</div>
</div>



<div id = "buttonsAndStorage" class="column">
  <div id="buttons-column">

  
  <div class="toolsDropdown">
    <div id="toolsButton">
      <div id = "tools" style="padding: 1vw 0 0.8vw 1vw; font-size: 1.4vw; font-family: Arial; cursor: default;">
        <span id = "toolsIcon" class="material-symbols-sharp"style="font-size: 1.6vw; padding-right: 4px; line-height: 1; vertical-align: middle;margin-top:-3px;">construction</span>Tools
      </div>
    </div>
    <div class="dropdown-content">
      <button class="button" id="addBannerButton" style="margin-top: 0px;"><i class="fa-solid fa-panorama" style="width: 20%; padding-left: 0.15vw;"></i>Banner</button>
      <button class="button" id="addRedButton" style="margin-top: 0px;"><span class="material-symbols-sharp"style="font-size: 1.5vw;line-height: 1; vertical-align: middle; width: 20%;">splitscreen_add</span>Title / Details</button><!--segment,text_fields-->
      <button class="button" id="addMenu2Button" style="margin-top: 0px;"><span class="material-symbols-outlined"style="font-size: 1.5vw;line-height: 1; vertical-align: middle; width: 20%">drag_handle</span>Menu of 2</button>
			<button class="button" id="addMenu3Button" style="margin-top: 0px;"><span class="material-symbols-outlined"style="font-size: 1.5vw;line-height: 1; vertical-align: middle; width: 20%">menu</span>Menu of 3</button>
      <button class="button" id="addBlueButton" style="margin-top: 0px;"><span class="material-symbols-outlined"style="font-size: 1.5vw;line-height: 1; vertical-align: middle; width: 20%">variable_add</span>Section</button><!--align_center-->
      <button class="button" id="addRichEditorButton" style="margin-top: 0px;"><span class="material-symbols-outlined"style="font-size: 1.5vw;line-height: 1; vertical-align: middle; width: 20%">abc</span>Text Editor</button>
      <button class="button" id="addQuizButton" style="margin-top: 0px;"><span class="material-symbols-sharp" style="font-variation-settings: 'FILL' 0, 'wght' 700, 'GRAD' 200, 'opsz' 40; padding-right: 7px; font-size: 1.5vw; line-height: 1; vertical-align: middle; width: 20%">sync_saved_locally</span>MCQ Quiz</button>
      <button class="button" id="addAccordionButton" style="margin-top: 0px;"><span class="material-symbols-outlined"style="font-size: 1.5vw;line-height: 1; vertical-align: middle; width: 20%">top_panel_open</span>Accordion</button>
      <button class="button" id="addFlashButton" style="margin-top: 0px;"><span class="material-symbols-outlined"style="font-size: 1.5vw;line-height: 1; vertical-align: middle; width: 20%">flip</span>Flashcard</button>
			<button class="button" id="addImageButton" style="margin-top: 0px;"><i class="fa-regular fa-image" style="width: 20%; padding-left: 0.25vw;"></i>Upload Image</button>
      <button class="button" id="addAudioButton" style="margin-top: 0px;"><i class="fa-solid fa-volume-high" style="width: 20%; padding-left: 0.2vw;"></i>Upload Audio</button>
      <button class="button" id="addVideoButton" style="margin-top: 0px;"><i class="fa-solid fa-video" style="width: 20%; padding-left: 0.2vw;"></i>Upload Video</button>
      <button class="button" id="addBreakButton" style="margin-top: 0px;"><span class="material-symbols-outlined"style="font-size: 1.5vw;line-height: 1; vertical-align: middle; width: 20%">insert_page_break</span>Empty Line</button>
    </div>
  </div>



  <div id="addPage" style="padding: 1.2vw 0 1.3vw 1vw; font-size: 1.4vw; font-family: Arial;">
    <button id="newTemplateButton" style="background-color: transparent;">
      <span id = "addTemplateIcon" class="material-symbols-sharp"style="font-size: 1.6vw; padding-right: 0px; line-height: 1; vertical-align: middle;margin-top:-3px;">add_box</span>
      Add Page
    </button>
  </div>




  <div id = "library" style="padding: 1vw 0 1vw 1vw; font-size: 1.4vw; font-family: Arial;">
    <span id="libraryIcon" class="material-symbols-sharp"style="font-size: 1.6vw; padding-right: 4px; line-height: 1; vertical-align: middle;margin-top:-3px;">two_pager</span>Library
  </div>

  

</div>
    <div class="storageAll">
      <div id="storageGeneral" class="storageGeneral" style="display: flex; align-items: center; cursor: pointer; padding: 0 1vw 1vw 0; align-self: center; font-size: 1.4vw; font-family: Arial;">
        <span id= "storageIcon" class="material-symbols-sharp" style="font-size: 1.6vw; padding-right: 4px; line-height: 1; vertical-align: middle;">settings_system_daydream</span>
        <div id="storage">Storage</div>
      </div>
      <div id="storageIndicator" class="storageIndicator" style="font-size: 0.8vw; padding: 0 1vw 1vw 0; align-self: center;"></div>
    </div>
</div>



<div class="two-columns" id="two-columns">

  <div class="columnOne" style="display: flex; flex-direction: column; width: 50%; background-color: #eee">
  
    

  <div class="column" style="height: auto; width: 100%; background-color: transparent; display: flex; flex-wrap: wrap; align-content: flex-end; flex-direction: row; justify-content: flex-end;">
    <div id="saveReport" style="padding: 0vw 0.5vw; color: #171b70; font-size: 0; display: flex; align-items: center;"><span id="cloudDone" class="material-symbols-sharp" style="font-size: 1.2vw; padding-top: 0.1vw;">cloud_done</span></div>
    <button class='button' id="button-save">SAVE CHANGES</button>
  </div>

	<div id="left-column" class="column" style="width: 100%; padding-top: 0; padding-bottom: 10vh;"></div>
  </div>

  <div class="video-storage-content" id="video-storage-content">
    <span class="video-close-storage" id="video-close-storage">&times;</span>
    <div style="font-size: 2vw; font-family: Arial; color: white; margin-bottom: 3vw;" id="storageFiles">Storage Videos</div>
  </div>

  <div class="audio-storage-content" id="audio-storage-content">
    <span class="audio-close-storage" id="audio-close-storage">&times;</span>
    <div id="storageFiles" style="font-size: 2vw; font-family: Arial; color: white; margin-bottom: 3vw;">Storage Audios</div>
  </div>

  <div class="image-storage-content" id="image-storage-content">
    <span class="image-close-storage" id="image-close-storage">&times;</span>
    <div id="storageFiles" style="font-size: 2vw; font-family: Arial; color: white; margin-bottom: 3vw;">Storage Images</div>
  </div>

  <div class="file-storage-content" id="file-storage-content">
    <span class="file-close-storage" id="file-close-storage">&times;</span>
    <div style="font-size: 2vw; font-family: Arial; color: white; margin-bottom: 3vw; display: flex; align-items: center; align-self: center;">
      <span id="storageIconSmall" class="material-symbols-sharp" style="font-size: 3vw; padding-right: 1vw; line-height: 1; vertical-align: middle;">settings_system_daydream</span>
      <div id="storageFiles">Storage Files</div>
    </div>
    
    <div id="videosInFiles" style="font-size: 1.5vw; font-family: Arial; color: white; margin-bottom: 3vw;">
      Videos
      <div id="strVideos" style="margin-top: 2vw;"></div>
    </div>
    <div id="audiosInFiles" style="font-size: 1.5vw; font-family: Arial; color: white; margin-bottom: 3vw;">
      Audios
      <div id="strAudios" style="margin-top: 2vw;"></div>
    </div>
    <div id="imagesInFiles" style="font-size: 1.5vw; font-family: Arial; color: white; margin-bottom: 3vw;">
      Images
      <div id="strImages" style="margin-top: 2vw;"></div>
    </div>

  </div>

  <div class="columnOne" style="display: flex; flex-direction: column; width: 50%;">
    <div class="column" style="height: auto; width: 100%;">
    <button class="button" id="copyTemplate">COPY PAGE</button>
  </div>

  <div id="right-column" class="column" style="width: 100%; padding-bottom: 10vh;"></div>
  </div>

</div>

<div id="myModal" class="modal">
  <div class="modal-content" style="font-family: Spectral; font-size: 1.2vw;">
    <span class="close" style="color:#171b70; font-size: 2vw;">&times;</span>
    <p>Are you sure you want to delete this page?</p>
    <button id="confirmDelete" style="background-color: #171b70; color: white; border-width: 0; padding: 0.5vw; font-size: 1vw;">Delete</button>
    <button id="cancelDelete" style="background-color: #a91a1a; color: white; border-width: 0; padding: 0.5vw; font-size: 1vw;">Cancel</button>
  </div>
</div>

<div id="renameModal" class="modal">
  <div class="modal-content" style="font-family: Spectral; font-size: 1.2vw;">
    <span class="close" style="color:#171b70; font-size: 2vw;">&times;</span>
    <p>Enter new page name:</p>
    <div style="display: flex; flex-wrap: wrap;">
    <input type="text" id="newTemplateName" placeholder="New name" style="height: 3vw;">
    <button id="confirmRename" style="background-color: #171b70; color: white; border-width: 0; padding: 0.5vw; height: 3vw; font-size: 1vw; padding: 0 1vw; margin-left: 0.5vw;">Save</button>
    <button id="cancelRename" style="background-color: #a91a1a; color: white; border-width: 0; padding: 0.5vw; height: 3vw; font-size: 1vw; margin-left: 0.5vw;">Cancel</button>
    </div>
  </div>
</div>

<div id="overlay">
  <div class="message">
    <div>Your account will be deleted in a moment.</div>
    <br>
    <div>You will be redirected to the login page.</div>
  </div>
</div>
<script>
// JavaScript to toggle the account overlay
document.getElementById('account').addEventListener('click', function() {
    var accountOverlay = document.getElementById('accountOverlay');
    if (accountOverlay.style.display === 'flex') {
        accountOverlay.style.display = 'none';
    } else {
        accountOverlay.style.display = 'flex';
    }
});

// Optional: Hide the account overlay when clicking outside the deleteAccount div
document.getElementById('accountOverlay').addEventListener('click', function(event) {
    if (event.target === this) {
        this.style.display = 'none';
    }
});
</script>
    <script src="js/bootstrap.min.js"></script>
	
    <!-- Slick JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>



</body>
</html>
